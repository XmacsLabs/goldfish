# 200_14 能够检查括号是否匹配的 linter
## What
新建 (liii lint) 模块，实现检查括号是否匹配的功能，并能明确提出在第几行，第几列添加或者删除括号以修复未匹配的括号。

## How
仅读取的文件：
+ goldfish/liii/sys.scm
+ tests/goldfish/liii/sys-test.scm
+ tests/goldfish/liii/stack-test.scm

修改或者新赠的文件：
+ tools/lint.scm
+ goldfish/liii/lint.scm

### 如何测试
测试前先构建
```
xmake config --yes
xmake b goldfish
bin/goldfish -m r7rs tests/goldfish/liii/lint-test.scm
```
### 如何运行
```
bin/goldfish tools/lint.scm path/to/file.scm
```

### 测试用例
tests/resources目录下有多个以200_14开头的测试文件。查看所有文件：
```
ls tests/resources/200_14*
```

然后逐个测试所有200_14开头的文件：
```
for f in tests/resources/200_14*.scm; do
    echo "=== $f ==="
    bin/goldfish tools/lint.scm "$f"
done
```

主要包含以下类型的测试：
- `200_14_valid.scm`          # 平衡括号
- `200_14_unmatched_open.scm`    # 未闭合括号
- `200_14_unmatched_close.scm`   # 多余闭括号
- `200_14_mismatched.scm`        # 不匹配括号
- `200_14_bad.scm`              # 复杂的错误情况
- `200_14_test1.scm`            # 基础测试
- `200_14_nested_constants.scm`  # 嵌套常量
- `200_14_with_strings.scm`     # 字符串中的括号
- `200_14_hash_valid.scm`       # 哈希表有效情况
- `200_14_hash_unmatched.scm`   # 哈希表无效情况

## Task 1: 2025/08/09 实现 tools/lint.scm 这个入口
### How
用 (liii sys) 的 argv 来获取命令行参数，假定只有一个命令行参数，就是要检查的文件路径。
用 (liii path) 的 path-read-text 来读取文件内容。

新建 (liii lint) 模块，实现检查括号是否匹配的功能。第一个版本我们只做括号是否匹配的检查。

在 tests/resources 目录新建一些用于测试的资源文件，这些资源文件以 200_14开头，以.scm结尾，包含匹配和不匹配等多种情况。

## Task 2: 2025/08/09 在检测结果中显示出错位置的行号和列号
### How
为了代码的可读性，先重构代码：
在 (liii lint) 中使用 (liii stack) 来实现括号匹配检查，提高代码可维护性。

实现显示括号不匹配的准确行号和列号：
- 当存在未闭合的括号时，显示最后一个未闭合括号的位置（行号, 列号）
- 当存在不匹配的闭括号时，显示该括号的位置（行号, 列号）

输出格式示例：
```
filename.scm: unmatched parenthesis at line 5, column 12
filename.scm: unclosed parenthesis at line 3, column 8
```

## Task 3: 2025/08/10 考虑 define 的位置，然后显示更好的错误信息
### What
参考如下命令行输出，现在无法正确识别括号未匹配的位置。
```
> bin/goldfish tools/lint.scm tests/resources/200_14_begin_define.scm 
tests/resources/200_14_begin_define.scm: 
  ERROR: unclosed parenthesis at line 4, column 3
  FIX: add closing parenthesis ')'
```

## Task 4: 2025/08/12 不需要提供FIX信息
### How
直接改 tools/lint.scm