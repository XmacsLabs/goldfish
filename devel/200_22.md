# [200_22] 将 floor 在 s7.c 中的实现迁移到 s7_scheme_base.c

## 任务相关的代码文件
- src/s7.c
- src/s7_scheme_base.c
- src/s7_scheme_base.h
- devel/200_22.md

## 如何测试
```
xmake config --yes -vD
xmake b goldfish
bin/goldfish tests/goldfish/liii/base-test.scm
bin/goldfish tests/test_all.scm
```

## 2026/02/18 将 zero?、positive?、negative? 从 s7.c 迁移到 s7_scheme_base.c
### What
将 zero?、positive?、negative? 函数从 s7.c 迁移到 s7_scheme_base.c，包括：
1. 迁移 zero_b_7p、positive_b_7p、negative_b_7p 函数实现，移除 WITH_GMP 条件编译代码
2. 迁移 g_zero、g_positive、g_negative 函数实现
3. 迁移 zero_p_p、positive_p_p、negative_p_p、zero_i、zero_d、positive_i、positive_d、negative_i、negative_d 函数实现
4. 在 s7_scheme_base.h 中添加函数声明
5. 在 s7.c 中移除迁移的代码
6. 在 s7.c 中更新函数注册，将 defun 宏调用改为直接调用 s7_define_typed_function
7. 修复 zero? 函数对复数的支持（原实现未处理复数类型错误）

### Why
作为 s7.c 代码拆分的一部分，将基础谓词函数迁移到独立的模块中，提高代码可维护性。

### How
1. 参考 even? 和 odd? 迁移模式，使用 s7_is_integer、s7_is_real 等辅助函数重写 zero?、positive?、negative? 函数
2. 移除 WITH_GMP 相关条件编译代码，因为项目不依赖 GMP 库
3. 保持函数签名和错误处理与原实现一致
4. 更新 s7.c 中的函数注册和设置调用
5. 为 zero? 添加复数支持，检查实部和虚部是否都为零

## 2026/02/18 将 even? 和 odd? 从 s7.c 迁移到 s7_scheme_base.c
### What
将 even? 和 odd? 函数从 s7.c 迁移到 s7_scheme_base.c，包括：
1. 迁移 even_b_7p 和 odd_b_7p 函数实现，移除 WITH_GMP 条件编译代码
2. 迁移 g_even 和 g_odd 函数实现
3. 迁移 even_p_p、odd_p_p、even_i、odd_i 函数实现
4. 在 s7_scheme_base.h 中添加函数声明
5. 在 s7.c 中移除迁移的代码
6. 在 s7.c 中更新函数注册，将 defun 宏调用改为直接调用 s7_define_typed_function

### Why
作为 s7.c 代码拆分的一部分，将基础谓词函数迁移到独立的模块中，提高代码可维护性。

### How
1. 参考 floor、ceiling 和 abs 迁移模式，使用 s7_is_integer 等辅助函数重写 even? 和 odd? 函数
2. 移除 WITH_GMP 相关条件编译代码，因为项目不依赖 GMP 库
3. 保持函数签名和错误处理与原实现一致
4. 更新 s7.c 中的函数注册和设置调用

## 2026/02/18 将 abs 从 s7.c 迁移到 s7_scheme_base.c
### What
将 abs 函数从 s7.c 迁移到 s7_scheme_base.c，包括：
1. 迁移 abs_p_p 函数实现，移除 WITH_GMP 条件编译代码
2. 迁移 g_abs 函数实现
3. 迁移 abs_i_i、abs_d_d、abs_p_i、abs_i_7d、abs_i_7p、abs_p_d 函数实现
4. 在 s7_scheme_base.h 中添加函数声明
5. 在 s7.c 中移除迁移的代码
6. 在 s7.c 中更新函数注册，将 defun 宏调用改为直接调用 s7_define_typed_function

### Why
作为 s7.c 代码拆分的一部分，将基础数学函数（绝对值函数）迁移到独立的模块中，提高代码可维护性。

### How
1. 参考 floor 和 ceiling 迁移模式，使用 s7_is_integer、s7_is_real 等辅助函数重写 abs 函数
2. 移除 WITH_GMP 相关条件编译代码，因为项目不依赖 GMP 库
3. 保持函数签名和错误处理与原实现一致
4. 处理 S7_INT64_MIN 边界情况，避免溢出

## 2026/02/18 将 ceiling 从 s7.c 迁移到 s7_scheme_base.c
### What
将 ceiling 函数从 s7.c 迁移到 s7_scheme_base.c，包括：
1. 迁移 ceiling_p_p 函数实现，移除 WITH_GMP 条件编译代码
2. 迁移 g_ceiling 函数实现
3. 迁移 ceiling_i_i、ceiling_p_i、ceiling_i_7d、ceiling_i_7p、ceiling_p_d 函数实现
4. 在 s7_scheme_base.h 中添加函数声明
5. 在 s7.c 中移除迁移的代码
6. 在 s7.c 中更新函数注册，将 defun 宏调用改为直接调用 s7_define_typed_function

### Why
作为 s7.c 代码拆分的一部分，将基础数学函数（舍入函数）迁移到独立的模块中，提高代码可维护性。

### How
1. 参考 floor 迁移模式，使用 s7_is_integer、s7_is_real 等辅助函数重写 ceiling 函数
2. 移除 WITH_GMP 相关条件编译代码，因为项目不依赖 GMP 库
3. 保持函数签名和错误处理与原实现一致

## 2026/02/18 将 floor 从 s7.c 迁移到 s7_scheme_base.c
### What
将 floor 函数从 s7.c 迁移到 s7_scheme_base.c，包括：
1. 创建新的基础函数文件 s7_scheme_base.c 和 s7_scheme_base.h
2. 迁移 floor_p_p 函数实现，移除 WITH_GMP 条件编译代码
3. 迁移 g_floor 函数实现
4. 迁移 floor_i_i、floor_p_i、floor_i_7d、floor_i_7p、floor_p_d 函数实现
5. 在 s7_scheme_base.h 中添加函数声明
6. 在 s7.c 中移除迁移的代码
7. 在 s7.c 中更新函数注册，将 defun 宏调用改为直接调用 s7_define_typed_function

### Why
作为 s7.c 代码拆分的一部分，将基础数学函数（舍入函数）迁移到独立的模块中，提高代码可维护性。

### How
1. 参考 devel/200_21.md 中的迁移模式，使用 s7_is_integer、s7_is_real 等辅助函数重写 floor 函数
2. 移除 WITH_GMP 相关条件编译代码，因为项目不依赖 GMP 库
3. 在 xmake.lua 中添加新源文件以确保参与构建
4. 保持函数签名和错误处理与原实现一致