# [212_4] 完善 SRFI 113 边界测试与修复 bag-product

## 任务相关的代码文件
- `tests/goldfish/liii/set-test.scm` - 添加边界测试
- `goldfish/liii/set.scm` - 修复 bag-product bug

## 如何测试
```bash
bin/goldfish tests/goldfish/liii/set-test.scm
```

## 2025/01/22 完善边界测试与修复 bug

### What
为 SRFI 113 Sets 和 Bags 添加边界测试，修复了 `bag-product` 在乘以 0 时的 bug。

- `bag-product` 乘以 0 时应返回空 bag，但原实现只是将计数设为 0 而不删除元素


### Why
**边界测试的重要性：**
1. **Bug 发现**：边界测试发现了 `bag-product` 的实现问题
2. **健壮性保证**：确保空集/空 bag、单元素、自身操作等特殊情况正确处理
3. **规范遵守**：验证 SRFI 113 规范中的特殊情况要求（如空集的 every? 返回 #t）
4. **防止回归**：未来修改代码时能及时发现问题

**发现的问题：**
`bag-product` 将所有元素计数乘以 n，但当 n=0 时：
- 原实现：计数变为 0，但元素仍在 alist 中，导致 `bag-empty?` 返回 #f
- 正确行为：应过滤掉计数为 0 的元素，返回空 bag

### How

**1. 修复 bag-product bug**

修改前：
```scheme
(define (bag-product n b)
  (%make-bag (%bag-comparator b)
             (map (lambda (pair)
                    (cons (car pair) (* n (cdr pair))))
                  (%bag-alist b))))
```

修改后（添加过滤）：
```scheme
(define (bag-product n b)
  (%make-bag (%bag-comparator b)
             (filter (lambda (pair) (> (cdr pair) 0))
                     (map (lambda (pair)
                            (cons (car pair) (* n (cdr pair))))
                          (%bag-alist b)))))
```
