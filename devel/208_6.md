# [208_6] 新增 codepoint->utf8, utf8->codepoint 函数

## 任务相关的代码文件
- `goldfish/liii/unicode.scm` - unicode 模块实现文件
- `tests/goldfish/liii/unicode-test.scm` - unicode 模块测试文件
- `goldfish/liii/rich-char.scm` - rich-char 模块实现文件

## 如何测试
一般先构建，再lint，最后运行测试用例。

```bash
# 构建项目
xmake config --yes
xmake b goldfish

# 代码检查
bin/lint goldfish/liii/unicode.scm
bin/lint tests/goldfish/liii/unicode-test.scm
bin/lint goldfish/liii/rich-char.scm

# 运行测试
bin/goldfish -m r7rs tests/goldfish/liii/unicode-test.scm

# 验证 rich-char 功能
bin/goldfish -m r7rs tests/goldfish/liii/lang-test.scm
```

## 2025-10-19 使用 unicode 模块优化 rich-char

### What
使用新实现的 `codepoint->utf8` 和 `utf8->codepoint` 函数优化 rich-char 模块：

1. 重构 `rich-char` 模块，导入 `(liii unicode)` 模块
2. 简化 `%to-bytevector` 方法，使用 `codepoint->utf8` 函数
3. 简化 `@from-bytevector` 方法，使用 `utf8->codepoint` 函数
4. 验证优化后的 rich-char 功能保持不变

### Why
- 代码简化：将复杂的位运算逻辑替换为简单的函数调用
- 维护性：统一使用经过测试的 Unicode 处理函数
- 正确性：复用已经验证过的 UTF-8 编码/解码逻辑
- 一致性：确保整个项目使用相同的 Unicode 处理逻辑

### How
- 在 rich-char 模块中导入 unicode 模块
- 将手动实现的 UTF-8 编码/解码逻辑替换为对应的函数调用
- 保持原有的错误处理和边界条件检查
- 通过现有测试验证功能正确性

## 2025-10-19 新增 utf8->codepoint 函数

### What
完成 Unicode 码点与 UTF-8 编码之间的转换函数：

1. 实现 `utf8->codepoint` 函数，将 UTF-8 编码的字节列表转换为 Unicode 码点
2. 添加完整的单元测试用例，覆盖各种编码长度和边界情况
3. 实现与 `codepoint->utf8` 函数的互逆操作验证

### Why
这些函数是 Unicode 处理的基础功能，为后续的字符串编码转换和字符处理提供支持。

### How
- `utf8->codepoint` 根据字节序列的第一个字节确定编码长度，并解码为码点
- 实现 UTF-8 编码的验证和错误处理，包括不完整序列和无效字节检查
- 添加码点有效性检查，避免代理对和过编码问题
- 使用测试驱动开发方法，先写测试用例再实现功能

## 2025-10-19 新增 codepoint->utf8 函数

### What
实现 Unicode 码点与 UTF-8 编码之间的转换函数：

1. 实现 `codepoint->utf8` 函数，将 Unicode 码点转换为 UTF-8 编码的字节列表
2. 添加相应的单元测试用例

### Why
这些函数是 Unicode 处理的基础功能，为后续的字符串编码转换和字符处理提供支持。

### How
- `codepoint->utf8` 根据码点大小决定 UTF-8 编码长度（1-4字节）
- 实现 UTF-8 编码的验证和错误处理
- 使用测试驱动开发方法，先写测试用例再实现功能