# [210_21] `(liii hashlib)` 文件哈希能力补充

## 任务相关的代码文件
- `src/goldfish.hpp`
- `goldfish/liii/hashlib.scm`
- `tests/goldfish/liii/hashlib-test.scm`

## 如何测试

```shell
xmake f -c
xmake
./bin/goldfish tests/goldfish/liii/hashlib-test.scm
```

## 2026/2/13 修复 Windows 栈溢出

### What
将 `hash_bytes_to_hex` 中的 `tb_snprintf` 替换为位运算实现，修复 Windows x64 上的栈缓冲区溢出问题。

### Why
`tb_snprintf("%02x", unsigned_char)` 在 Windows 上因整数提升和 CRT 实现差异（`_snprintf` 不保证 null 终止及可能的 8 位十六进制输出），向 33 字节缓冲区写入超过 32 字符的数据，覆盖了相邻的 Scheme 闭包变量，导致 OOP 测试失败。

### How
改用查表法：`hex_output[i*2] = hex_digits[byte>>4]`，避免可变参数调用，确保跨平台精确写入 2n+1 字节。


## 2026/2/12 新增文件哈希

### What

1. 在 `(liii hashlib)` 中新增文件哈希接口：
   - `md5-by-file`
   - `sha1-by-file`
   - `sha256-by-file`
2. 在 C++ glue 层新增对应底层函数：
   - `g_md5-by-file`
   - `g_sha1-by-file`
   - `g_sha256-by-file`
3. 更新 `hashlib-test.scm`，补充文件哈希测试（普通内容与空文件与200mb文件）。

### Why

1. 提供对文件内容直接计算哈希的能力，避免业务侧自行读文件再哈希。
2. 底层符号名与用途对齐，避免将“字符串哈希”和“文件哈希”语义混淆。
