# [210_6] (liii http)

## 任务相关的代码文件
- `src/goldfish.hpp`
- `tests/goldfish/liii/http-test.scm`
- `goldfish/liii/http.scm`
- `xmake.lua`
- `xmake/packages/c/cpr/`
- `3rdparty/cpr/`

## 如何测试

```shell
# 可能需要清除缓存
# rm .xmake/ build/ -r
xmake f -vyD
xmake b goldfish
./bin/goldfish tests/goldfish/liii/http-test.scm
```

## 2026/1/22 正规化 HTTP Header 的大小写

### What

1. 在 `response2hashtable()` 中将 HTTP 头部键统一转为小写
2. 修改测试用例，放宽对 `reason` 字段的检查（接受 "OK" 或空字符串）
3. 更新测试中的头部键引用为小写形式（如 "content-type" 替代 "Content-Type"）

### Why

1. httpbin.org 使用负载均衡，导致：
   - HTTP 头部键大小写不一致（Content-Type vs content-type）
   - reason 字段有时为空（HTTP/2+ 规范允许省略 reason phrase）
2. 测试不稳定，取决于请求被路由到哪个后端实例
3. HTTP 规范规定头部键名不区分大小写，但实际实现有差异

### How

在 `goldfish.hpp` 标准化头部键名为小写。

## 2026/1/22 开源 `(liii http)`

### What

1. 将原 liiischeme 的 `(liii http)` 开源，迁移至 goldfish 代码库。
2. 更新了一下测试文件，其中 header 是大小写敏感的，原测试使用小写的，没有取得预期的值。
3. 将 `CRLF` 重规范为 `LF`。
4. 由于依赖库 CPR 的需要，将 goldfish 语言从 C++ 11 提高至 C++ 17。

### Why

移入 goldfish 主线开发。

### How

简单迁移。
