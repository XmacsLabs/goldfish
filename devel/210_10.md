# [210_10] 实现 bag 基础能力（SRFI-113）

## 任务相关的代码文件
- goldfish/srfi/srfi-113.scm
- goldfish/liii/bag.scm
- tests/goldfish/liii/bag-test.scm

## 如何测试
```bash
bin/goldfish tests/goldfish/liii/bag-test.scm
```


## 2026/01/30 实现 bag 更新/子集/集合运算接口
### What
补齐 SRFI-113 的 bag 更新、删除、搜索、子集关系与集合运算接口，并在 (liii bag) 中导出与补齐测试。

1. 在 goldfish/srfi/srfi-113.scm 中实现 bag-adjoin / bag-adjoin! / bag-replace / bag-replace! / bag-delete / bag-delete! / bag-delete-all / bag-delete-all! / bag-search!，以及 bag=? / bag<? / bag>? / bag<=? / bag>=? 与 bag-union / bag-intersection / bag-difference / bag-xor 及其线性更新版本，并添加到导出列表
2. 在 goldfish/liii/bag.scm 中导出以上函数
3. 在 tests/goldfish/liii/bag-test.scm 中添加详细注释与覆盖测试

### Why
提供多重集的增删改、搜索、包含关系与集合运算能力，覆盖 SRFI-113 对 bag 的核心语义。

### How
1. bag-adjoin!/bag-adjoin 对元素逐个计数 +1，前者就地修改，后者基于副本
2. bag-replace!/bag-replace 替换等价元素的代表值并保持计数不变
3. bag-delete!/bag-delete 逐个删除一个元素实例，前者就地修改，后者基于副本
4. bag-delete-all!/bag-delete-all 根据列表删除元素实例，列表含重复则多次删除
5. bag-search! 按 comparator 等价查找，命中/未命中分别调用 success/failure 并提供 insert/update/remove 操作
6. 子集关系按“计数包含”判断：每个元素计数满足 <= 或严格 < 关系
7. 相等性要求各元素计数一致
8. union 取计数最大值；intersection 取最小值；difference 按计数相减并截断为 0；xor 取计数绝对差

## 2026/01/29 实现 bag 查询与转换接口
### What
补齐 SRFI-113 的 bag 查询能力与复制/列表转换接口，并在 (liii bag) 中导出与补齐测试。

1. 在 goldfish/srfi/srfi-113.scm 中实现 bag-size / bag-find / bag-count / bag-any? / bag-every? / bag-copy / list->bag / list->bag! 并添加到导出列表
2. 在 goldfish/liii/bag.scm 中导出以上函数，并提供默认比较器的 list->bag
3. 在 tests/goldfish/liii/bag-test.scm 中添加注释与覆盖测试（含空 bag、空列表与类型错误分支）

### Why
提供多重集的基础查询能力与列表互操作接口，支持按条件计数与搜索，并符合 SRFI-113 语义。

### How
1. bag-size 汇总 entries 的计数，返回元素总数（含重复）
2. bag-find 遍历 entries，找到满足 predicate 的元素立即返回，否则调用 failure
3. bag-count 统计满足 predicate 的元素出现次数（含重复）
4. bag-any? / bag-every? 使用短路遍历判断是否存在/是否全部满足
5. bag-copy 复制 entries 的计数并保持 comparator
6. list->bag 使用 comparator 构造 bag，保留重复元素
7. list->bag! 将列表元素累加到现有 bag
8. 关键路径与类型错误通过测试覆盖

## 2026/01/29 实现 bag 构造器、访问器与谓词
### What
实现 SRFI-113 的 bag 基础构造、访问与谓词函数，并在 (liii bag) 中提供默认比较器封装与测试用例。

1. 在 goldfish/srfi/srfi-113.scm 中实现 bag / bag-unfold / bag-member / bag-element-comparator / bag->list，并添加到导出列表
2. 在 goldfish/liii/bag.scm 中提供默认比较器版本的 bag，并导出上述函数
3. 在 tests/goldfish/liii/bag-test.scm 中添加文档注释与覆盖测试（含错误分支）
4. 在 goldfish/srfi/srfi-113.scm 中实现 bag? / bag-contains? / bag-empty? / bag-disjoint? 并添加到导出列表
5. 在 goldfish/liii/bag.scm 中导出以上谓词
6. 在 tests/goldfish/liii/bag-test.scm 中添加注释与测试（含类型错误分支）

### Why
提供多重集（bag）的最小可用接口，用于存储重复元素并支持基础查询与遍历输出。

### How
1. bag 使用 comparator 构造，插入时按 comparator 相等性累加计数
2. bag-unfold 使用 unfold 模式生成 bag
3. bag-member 返回 bag 中等价元素，未命中返回默认值
4. bag->list 将元素按计数展开为列表
5. bag? 使用 record-type 生成的谓词
6. bag-contains? 使用 comparator 相等性在线性扫描 entries
7. bag-empty? 检查 entries 是否为空
8. bag-disjoint? 逐元素比对，找到相等元素立即返回 #f
9. 关键路径与类型错误通过测试覆盖
