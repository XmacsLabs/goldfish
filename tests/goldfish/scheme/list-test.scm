;
; Copyright (C) 2024 The Goldfish Scheme Authors
;
; Licensed under the Apache License, Version 2.0 (the "License");
; you may not use this file except in compliance with the License.
; You may obtain a copy of the License at
;
; http://www.apache.org/licenses/LICENSE-2.0
;
; Unless required by applicable law or agreed to in writing, software
; distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
; WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
; License for the specific language governing permissions and limitations
; under the License.
;

(import (liii check)
        (scheme base)
        (liii list))

(check-set-mode! 'report-failed)

#|
pair?
åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºåºå¯¹ï¼ˆpairï¼‰ç»“æ„ã€‚

è¯­æ³•
----
(pair? obj)

å‚æ•°
----
obj : any
ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬åŸå­ã€åºå¯¹ã€åˆ—è¡¨ã€å‘é‡ã€å­—èŠ‚å‘é‡ã€å­—ç¬¦ã€å­—ç¬¦ä¸²ã€ç¬¦å·ã€è¿‡ç¨‹ç­‰ã€‚

è¿”å›å€¼
-----
boolean?
å¦‚æœ obj æ˜¯åºå¯¹ç±»å‹åˆ™è¿”å› #tï¼Œå¦åˆ™è¿”å› #fã€‚

è¯´æ˜
----
åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºåºå¯¹çš„åŸºæœ¬è°“è¯å‡½æ•°ã€‚åºå¯¹æ˜¯ Scheme ä¸­æœ€åŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œ
ç”±ä¸¤ä¸ªå…ƒç´ ç»„æˆï¼Œå½¢æˆä¸€ä¸ªåŒå‘çš„å•å…ƒç»“æ„ã€‚åºå¯¹å¯ä»¥æ˜¯æ˜¾å¼çš„ç‚¹å¯¹å½¢å¼ï¼Œ
å¦‚ (a . b)ï¼Œä¹Ÿå¯ä»¥æ˜¯éç©ºåˆ—è¡¨ï¼Œå› ä¸ºæ‰€æœ‰éç©ºåˆ—è¡¨æœ¬è´¨ä¸Šéƒ½æ˜¯ç”±åºå¯¹é“¾ç»„æˆçš„ã€‚

è¾¹ç•Œæ¡ä»¶
--------
- ç©ºåˆ—è¡¨ '() è¿”å› #f
- å•å…ƒç´ åˆ—è¡¨ '(a) è¿”å› #tï¼ˆåˆ—è¡¨ç”±ä¸€ä¸ªåºå¯¹æ„æˆï¼‰
- æ˜¾å¼ç‚¹å¯¹ (a . b) è¿”å› #t
- åµŒå¥—æ·±åº¦ä¸å½±å“ç»“æœï¼šæ·±åº¦åµŒå¥—åˆ—è¡¨éƒ½è¿”å› #t
- ä»»æ„ç±»å‹çš„ car/cdr å€¼ä¸å½±å“è¿”å›å€¼åˆ¤æ–­

æ€§èƒ½ç‰¹å¾
--------
- æ—¶é—´å¤æ‚åº¦ï¼šO(1) æ’å®šæ—¶é—´å®Œæˆç±»å‹æ£€æŸ¥
- ç©ºé—´å¤æ‚åº¦ï¼šO(1) ä¸æ¶ˆè€—é¢å¤–æ ˆç©ºé—´
- é€’å½’æ·±åº¦ï¼š0ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºæœ¬è°“è¯ä¸ä¼šè§¦å‘é€’å½’

æ•°æ®ç±»å‹å…¼å®¹æ€§
-------------
- æ•°å€¼ç±»å‹ï¼šæ•´æ•°ã€å®æ•°ã€å¤æ•°éƒ½è¿”å› #f
- ç¬¦å·ç±»å‹ï¼šæ™®é€šç¬¦å·å’Œå…³é”®å­—ç¬¦å·éƒ½è¿”å› #f  
- å­—ç¬¦ä¸²ï¼šæ‰€æœ‰å­—ç¬¦ä¸²ç±»å‹è¿”å› #f
- å­—ç¬¦ï¼šæ‰€æœ‰å­—ç¬¦ç±»å‹è¿”å› #f
- å¸ƒå°”å€¼ï¼š#t å’Œ #f éƒ½è¿”å› #f
- è¿‡ç¨‹ï¼šæ‰€æœ‰è¿‡ç¨‹å¯¹è±¡è¿”å› #f
- å‘é‡å’Œå­—èŠ‚å‘é‡ï¼šè¿”å› #f
- ç©ºåˆ—è¡¨ï¼šè¿”å› #f
- éç©ºåˆ—è¡¨ï¼šè¿”å› #t
- ç‚¹å¯¹ç»“æ„ï¼šè¿”å› #t

æ³¨æ„
----
- ç©ºåˆ—è¡¨ '() ä¸æ˜¯åºå¯¹
- å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰åŸå­ç±»å‹éƒ½ä¸æ˜¯åºå¯¹
- æ‰€æœ‰éç©ºåˆ—è¡¨éƒ½è¢«è®¤ä¸ºæ˜¯åºå¯¹ï¼Œå› ä¸ºåˆ—è¡¨æœ¬è´¨ä¸Šæ˜¯ç”±åºå¯¹é“¾æ„æˆçš„
- è¿™ä¸€è¿‡ç¨‹å¯¹å­˜å‚¨çš„ car/cdr å€¼å†…å®¹ä¸åšä»»ä½•éªŒè¯

|#

;; æµ‹è¯• pair? å¯¹å„ç§åºå¯¹ç»“æ„çš„åˆ¤æ–­
(check-true (pair? '(a . b)))             ; æ˜¾å¼ç‚¹å¯¹å½¢å¼çš„åºå¯¹
(check-true (pair? '(a b c)))             ; åˆ—è¡¨å†…éƒ¨ç”±åºå¯¹æ„æˆ
(check-true (pair? (cons 1 2)))           ; ä½¿ç”¨ cons åˆ›å»ºçš„åºå¯¹
(check-true (pair? (cons 'a (cons 'b 'c))))  ; åµŒå¥—åºå¯¹ç»“æ„

(check-false (pair? 'a))
(check-false (pair? 123))
(check-false (pair? "string"))
(check-false (pair? #t))
(check-false (pair? #f))

;; pair? è¾¹ç•Œæ¡ä»¶æµ‹è¯•è¡¥å……
;; åŸºæœ¬è¾¹ç•Œå€¼éªŒè¯
(check-false (pair? '()))                                ; ç©ºåˆ—è¡¨è¾¹ç•Œ
(check-true (pair? '(single)))                           ; å•å…ƒç´ åˆ—è¡¨è¾¹ç•Œ
(check-true (pair? (cons 1 '())))                        ; å•å…ƒç´ consæ„å»º
(check-true (pair? '(())))                               ; ç©ºåˆ—è¡¨ä½œä¸ºå”¯ä¸€å…ƒç´ 

;; åµŒå¥—æ·±åº¦è¾¹ç•Œæµ‹è¯•
(check-true (pair? '((((a))))) )                         ; æ·±åº¦åµŒå¥—åˆ—è¡¨
(check-true (pair? (cons 'a (cons 'b (cons 'c '())))))   ; æ·±å±‚consé“¾
(check-true (pair? '(a b (c d (e)))))                    ; ä¸­åº¦åµŒå¥—ç»‘å®š

;; æ•°æ®ç±»å‹å…¼å®¹æ€§è¾¹ç•Œæµ‹è¯•
(check-false (pair? 42))                                ; æ•´æ•°ç±»å‹
(check-false (pair? 3.14))                              ; å®æ•°ç±»å‹
(check-false (pair? 1+2i))                              ; å¤æ•°ç±»å‹
(check-false (pair? #t))                                ; å¸ƒå°”çœŸ
(check-false (pair? #f))                                ; å¸ƒå°”å‡  
(check-false (pair? "hello"))                           ; å­—ç¬¦ä¸²
(check-false (pair? #\a))                               ; å­—ç¬¦
(check-false (pair? 'symbol))                           ; ç¬¦å·
(check-false (pair? 'quote))                            ; ç‰¹æ®Šç¬¦å·
(check-false (pair? +))                                 ; è¿‡ç¨‹å¯¹è±¡
(check-false (pair? length))                            ; è¿‡ç¨‹å¯¹è±¡

;; å¤æ‚å¯¹è±¡è¾¹ç•Œæµ‹è¯•
(check-false (pair? #(1 2 3)))                          ; å‘é‡å¯¹è±¡
(check-false (pair? #u8(1 2 3)))                        ; å­—èŠ‚å‘é‡
(check-false (pair? (lambda (x) x)))                    ; lambdaè¿‡ç¨‹
(check-false (pair? #<eof>))                            ; ç‰¹æ®Šå¯¹è±¡

;; æç«¯è¾¹ç•Œæµ‹è¯•
(check-true (pair? (cons '() '())))                      ; ç©ºåˆ—è¡¨ç»„æˆçš„åºå¯¹
(check-true (pair? (cons #t #f)))                        ; å¸ƒå°”å€¼ç»„æˆåºå¯¹
(check-true (pair? (cons 42 "string")))                  ; æ··åˆç±»å‹åºå¯¹
(check-true (pair? (cons (cons 1 2) (cons 3 4))))        ; åµŒå¥—åºå¯¹ç»„åˆ

;; æ„é€ å™¨å¤šæ ·åŒ–æµ‹è¯•
(check-true (pair? (list 1 2)))                          ; listæ„é€ å™¨
(check-true (pair? (append '(1) '(2))))                  ; appendç»“æœ
(check-true (pair? (cons 'a (list 'b 'c))))               ; æ··åˆæ„é€ å™¨

;; ç»“æ„æ€§è¾¹ç•ŒéªŒè¯
(check-false (pair? 'a))                                 ; åŸå­ç¬¦å·
(check-false (pair? 1000000))                            ; æå¤§æ•´æ•°è¾¹ç•Œ
(check-false (pair? "ä¸­æ–‡æµ‹è¯•"))                            ; å¤šå­—èŠ‚å­—ç¬¦ä¸²
(check-false (pair? #\newline))                          ; ç‰¹æ®Šå­—ç¬¦

;; Improper list è¾¹ç•ŒéªŒè¯
(check-true (pair? '(a . b)))                            ; åŸºç¡€ç‚¹å¯¹å½¢å¼
(check-true (pair? '(a b . c)))                          ; æ‰©å±•ç‚¹å¯¹å½¢å¼
(check-true (pair? '(a b c . d)))                        ; å¤šç‚¹ç»“æ„

#|
car
car æ˜¯ Scheme å†…ç½®å‡½æ•°ï¼Œç”¨äºè·å–åºå¯¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆç¬¬ä¸€ä¸ªåˆ†é‡ï¼‰ã€‚è¯¥å‡½æ•°æ˜¯ R7RS æ ‡å‡†çš„åŸºæœ¬åˆ—è¡¨æ“ä½œå‡½æ•°ä¹‹ä¸€ã€‚

è¯­æ³•
----
(car pair)

å‚æ•°
----
pair : pair?
å¯ä»¥æ˜¯åºå¯¹ï¼ˆå³éç©ºåˆ—è¡¨æˆ–æ˜¾å¼ç‚¹å¯¹ï¼‰ï¼Œä¸èƒ½æ˜¯ç©ºåˆ—è¡¨æˆ–å…¶ä»–å¯¹è±¡ã€‚

è¿”å›å€¼
------
ä»»æ„ç±»å‹
è¿”å›åºå¯¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆcaréƒ¨åˆ†ï¼‰ã€‚æ ¹æ®ä¸åŒçš„åºå¯¹å†…å®¹ï¼Œè¿”å›ç±»å‹å¯ä»¥æ˜¯
ç¬¦å·ã€æ•°å­—ã€åˆ—è¡¨ã€ç‚¹å¯¹ç­‰ä»»ä½•å¯¹è±¡ã€‚

è¯´æ˜
----
1. car æ˜¯ pair? è°“è¯çš„åŸºæœ¬æ“ä½œä¹‹ä¸€ï¼Œä¸ cdr é…åˆä½¿ç”¨å¤„ç†åºå¯¹æ•°æ®
2. å½“åº”ç”¨äºåˆ—è¡¨æ—¶ï¼Œè¿”å›åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
3. é€‚ç”¨äºæ‰€æœ‰åºå¯¹æ•°æ®ï¼šä¸è®ºæ˜¯ç‚¹å¯¹ (a . b) è¿˜æ˜¯éç©ºåˆ—è¡¨ (a b c ...)

é”™è¯¯å¤„ç†
--------
wrong-type-arg
å½“å‚æ•°ä¸æ˜¯åºå¯¹ï¼ˆå¦‚ç©ºåˆ—è¡¨ '()ã€æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰æ—¶æŠ›å‡ºé”™è¯¯ã€‚

|#

(check (car '(a b c . d)) => 'a)
(check (car '(a b c)) => 'a)
;; car è¾¹ç•Œæ¡ä»¶æµ‹è¯•
(check (car '(a)) => 'a)                       ; å•å…ƒç´ åˆ—è¡¨æµ‹è¯•
(check (car '(1)) => 1)                        ; å•å…ƒç´ æ•°å­—æµ‹è¯•
(check (car '(#t)) => #t)                      ; å•å…ƒç´ å¸ƒå°”å€¼æµ‹è¯•  
(check (car '("hello")) => "hello")            ; å•å…ƒç´ å­—ç¬¦ä¸²æµ‹è¯•
(check (car '(42)) => 42)                      ; å•å…ƒç´ æ•´æ•°æµ‹è¯•
(check (car '(() b c)) => '())                  ; ç©ºåˆ—è¡¨ä½œä¸ºé¦–å…ƒç´ è¾¹ç•Œ

;; å„ç§æ•°æ®ç±»å‹ä½œä¸ºcarå€¼æµ‹è¯•
(check (car '(123 "text" symbol)) => 123)                     ; å¤šç±»å‹æ··åˆï¼Œcaræ˜¯æ•´æ•°
(check (car '(#\a #\b #\c)) => #\a)                         ; å­—ç¬¦åˆ—è¡¨
(check (car '((a b) c d)) => '(a b))                          ; å­åˆ—è¡¨ä½œä¸ºcar
(check (car '((((a))))) => '(((a))))                          ; æ·±åº¦åµŒå¥—åˆ—è¡¨
(check (car '("nested" (list) "structure")) => "nested")      ; å­—ç¬¦ä¸²åµŒå¥—ç»“æ„

;; ç‚¹å¯¹ç»“æ„boundaryæµ‹è¯•
(check (car '(a . b)) => 'a)                   ; æ™®é€šç‚¹å¯¹
(check (car (cons 1 2)) => 1)                  ; consç»“æ„
(check (car (cons 'a (cons 'b 'c))) => 'a)     ; åµŒå¥—consç»“æ„

(check-catch 'wrong-type-arg (car '()))

;; car å¼‚å¸¸è¾¹ç•Œæµ‹è¯•
(check-catch 'wrong-type-arg (car 123))                    ; æ•°å­—ä¸æ˜¯pair
(check-catch 'wrong-type-arg (car "hello"))                ; å­—ç¬¦ä¸²ä¸æ˜¯pair
(check-catch 'wrong-type-arg (car #t))                     ; å¸ƒå°”å€¼ä¸æ˜¯pair
(check-catch 'wrong-type-arg (car #\a))                   ; å­—ç¬¦ä¸æ˜¯pair
(check-catch 'wrong-type-arg (car #(a b c)))               ; å‘é‡ä¸æ˜¯pair
(check-catch 'wrong-number-of-args (car))                  ; å‚æ•°ä¸è¶³
(check-catch 'wrong-number-of-args (car '(1 2) '(3 4)))    ; å‚æ•°è¿‡å¤š

;; è¡¥å……è¾¹ç•Œæ¡ä»¶æµ‹è¯• - å®Œå–„carè¾¹ç•Œæ¡ä»¶

;; å„ç§æ•°æ®ç»“æ„è¾¹ç•Œæµ‹è¯•
(check (car '(symbol)) => 'symbol)
(check (car '(#t #f)) => #t)
(check (car '(42 24)) => 42)
(check (car '(3.14 2.71)) => 3.14)
(check (car '(1/2 2/3)) => 1/2)
(check (car '(1+2i 3+4i)) => 1+2i)
(check (car '(#	ab #\newline)) => #	ab)

;; åµŒå¥—ç»“æ„å’Œç‰¹æ®Šè¾¹ç•Œå€¼æµ‹è¯•
(check (car '((a (b (c))))) => '(a (b (c))))
(check (car '(((1 2) 3) 4)) => '((1 2) 3))
(check (car '(() b c)) => '())
(check (car '('(a b) '(c d))) => ''(a b))
(check (car '(`(a b) `(c d))) => ''(a b))

;; å‘é‡å’Œå­—èŠ‚å‘é‡ä½œä¸ºcarå€¼æµ‹è¯•
(check (car '(#(1 2 3) #(4 5))) => #(1 2 3))
(check (car '(#u8(255 128) #u8(1 2))) => #u8(255 128))

;; Schemeç¬¦å·å’Œè¿‡ç¨‹è¾¹ç•Œæµ‹è¯•
(check (car '(procedure? symbol?)) => `procedure?)
(check (car '(+ - * /)) => '+)
(check (car '(sqrt abs) ) => `sqrt)

;; è¿ç»­ç©ºåˆ—è¡¨åµŒå¥—è¾¹ç•Œæµ‹è¯•
(check (car '((((()))))) => '(((()))))
(check (car '((a (()) b) c)) => '(a (()) b))

;; Unicodeå’Œç‰¹æ®Šå­—ç¬¦è¾¹ç•Œæµ‹è¯•
(check (car '("ä¸­æ–‡" "world")) => "ä¸­æ–‡")
(check (car '("ğŸ™‚" "ğŸš€")) => "ğŸ™‚")
(check (car '((list 'a 'b) 'c)) => '(list 'a 'b))

;; å‡½æ•°å’Œè¿‡ç¨‹å¯¹è±¡ä½œä¸ºcarå€¼æµ‹è¯•
(check (car '((lambda (x) (* x x)) (lambda (y) (+ y 1)))) => 
       `(lambda (x) (* x x)))

;; æç«¯è¾¹ç•Œï¼šç°å­˜è¡¨è¾¾å¼åµŒå¥—
(check (car '((begin 1 2 3) (begin 4 5))) => '(begin 1 2 3))
(check (car '((let ((x 10)) x) (let ((y 20)) y))) => '(let ((x 10)) x))

;; ç¡®ä¿å¯¹carå‡½æ•°çš„ç²¾ç¡®æ•°æ®ç±»å‹è¾¹ç•ŒéªŒè¯
(check (car '((define f (lambda (x) x)) (define g (lambda (x) x)))) => 
       '(define f (lambda (x) x)))

(check-catch 'wrong-type-arg (car #f))
(check-catch 'wrong-type-arg (car '[]))
(check-catch 'wrong-type-arg (car '()))
(check-catch 'wrong-number-of-args (car 42 84))
(check-catch 'wrong-type-arg (car '*))

#|
cdr
cdr æ˜¯ Scheme å†…ç½®å‡½æ•°ï¼Œç”¨äºè·å–åºå¯¹çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆç¬¬äºŒä¸ªåˆ†é‡ï¼‰ã€‚è¯¥å‡½æ•°ä¸ car é…åˆä½¿ç”¨ï¼Œæ˜¯ R7RS æ ‡å‡†çš„åŸºæœ¬åˆ—è¡¨æ“ä½œå‡½æ•°ä¹‹ä¸€ã€‚

è¯­æ³•
----
(cdr pair)

å‚æ•°
----
pair : pair?
å¯ä»¥æ˜¯åºå¯¹ï¼ˆå³éç©ºåˆ—è¡¨æˆ–æ˜¾å¼ç‚¹å¯¹ï¼‰ï¼Œä¸èƒ½æ˜¯ç©ºåˆ—è¡¨æˆ–å…¶ä»–å¯¹è±¡ã€‚

è¿”å›å€¼
------
ä»»æ„ç±»å‹
è¿”å›åºå¯¹çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆcdréƒ¨åˆ†ï¼‰ã€‚æ ¹æ®ä¸åŒçš„åºå¯¹å†…å®¹ï¼Œè¿”å›ç±»å‹å¯ä»¥æ˜¯
åˆ—è¡¨ã€ç¬¦å·ã€æ•°å­—ã€ç‚¹å¯¹ã€å¸ƒå°”å€¼ç­‰ä»»ä½•å¯¹è±¡ã€‚

è¯´æ˜
----
1. cdr æ˜¯ pair? è°“è¯çš„åŸºæœ¬æ“ä½œä¹‹ä¸€ï¼Œä¸ car é…åˆä½¿ç”¨å¤„ç†åºå¯¹æ•°æ®
2. å½“åº”ç”¨äºåˆ—è¡¨æ—¶ï¼Œè¿”å›åˆ—è¡¨é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å¤–çš„å­åˆ—è¡¨
3. é€‚ç”¨äºæ‰€æœ‰åºå¯¹æ•°æ®ï¼šä¸è®ºæ˜¯ç‚¹å¯¹ (a . b) è¿˜æ˜¯éç©ºåˆ—è¡¨ (a b c ...)

é”™è¯¯å¤„ç†
--------
wrong-type-arg
å½“å‚æ•°ä¸æ˜¯åºå¯¹ï¼ˆå¦‚ç©ºåˆ—è¡¨ '()ã€æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰æ—¶æŠ›å‡ºé”™è¯¯ã€‚

|#

(check (cdr '(a b c . d)) => '(b c . d))
(check (cdr '(a b c)) => '(b c))

(check (cdr '(1 . 2)) => 2)
(check (cdr '((a b) . c)) => 'c)

(check (cdr (cons 1 2)) => 2)
(check (cdr (cons 'a 'b)) => 'b)

; é”™è¯¯æµ‹è¯•
(check-catch 'wrong-type-arg (cdr '()))
(check-catch 'wrong-type-arg (cdr 123))
(check-catch 'wrong-type-arg (cdr "hello"))
(check-catch 'wrong-type-arg (cdr #t))
(check-catch 'wrong-number-of-args (cdr))
(check-catch 'wrong-number-of-args (cdr '(1 2) '(3 4)))

;; cdrè¾¹ç•Œæ¡ä»¶æµ‹è¯•è¡¥å……
(check (cdr '(a)) => '())                       ; å•å…ƒç´ åˆ—è¡¨cdrè¾¹ç•Œ
(check (cdr '(1)) => '())                       ; å•å…ƒç´ æ•°å­—åˆ—è¡¨cdrè¾¹ç•Œ
(check (cdr '(#t)) => '())                      ; å•å…ƒç´ å¸ƒå°”åˆ—è¡¨cdrè¾¹ç•Œ
(check (cdr '("hello")) => '())                 ; å•å…ƒç´ å­—ç¬¦ä¸²åˆ—è¡¨cdrè¾¹ç•Œ
(check (cdr '(() b c)) => '(b c))               ; ç©ºåˆ—è¡¨ä½œä¸ºé¦–å…ƒç´ çš„cdr
(check (cdr '((a b))) => '())                   ; å•å…ƒç´ å­åˆ—è¡¨cdrè¾¹ç•Œ
(check (cdr '((((a))))) => '())                 ; æ·±åº¦åµŒå¥—å•å…ƒç´ cdr

;; å„ç§æ•°æ®ç±»å‹cdrè¾¹ç•Œæµ‹è¯•
(check (cdr '(123 "text" symbol)) => '("text" symbol))
(check (cdr '(#
ewline #	ab #\space)) => '(#	ab #\space))
(check (cdr '((a b) c d)) => '(c d))
(check (cdr '(#(1 2) #(3 4))) => '(#(3 4)))
(check (cdr '(+ - * /)) => '(- * /))
(check (cdr '('(a b) '(c d))) => '('(c d)))

;; æç«¯è¾¹ç•Œæ¡ä»¶æµ‹è¯•
(check (cdr '((lambda (x) x) (lambda (y) y))) => '((lambda (y) y)))
(check (cdr '((begin 1 2 3) (begin 4 5))) => '((begin 4 5)))

(check (cdr '(a b.c d)) => '(b.c d))
(check (cdr '("ä¸­æ–‡" "æµ‹è¯•")) => '("æµ‹è¯•"))

#|
set-car!
æ›¿æ¢åºå¯¹ï¼ˆpairï¼‰çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆcaréƒ¨åˆ†ï¼‰ä¸ºæ–°å€¼ï¼Œè¯¥æ“ä½œä¼šç›´æ¥ä¿®æ”¹åŸå§‹åºå¯¹å¯¹è±¡ã€‚

è¯­æ³•
----
(set-car! pair obj)

å‚æ•°
----
pair : pair?
    è¦è¢«ä¿®æ”¹çš„åºå¯¹ï¼Œå¯ä»¥æ˜¯ç‚¹å¯¹æˆ–ä»»ä½•éç©ºåˆ—è¡¨ã€‚å¿…é¡»æ˜¯ä¸€ä¸ªå¯ä»¥ä¿®æ”¹çš„åºå¯¹å¯¹è±¡ã€‚
    
obj : any
    è¦è®¾ç½®çš„æ–°å€¼ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ç¬¦å·ã€æ•°å­—ã€åˆ—è¡¨ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ç­‰ã€‚

è¿”å›å€¼
------
unspecified
    æ ¹æ®R7RSè§„èŒƒï¼Œè¿”å›æœªæŒ‡å®šçš„å€¼ã€‚

è¯´æ˜
----
1. set-car!æ˜¯ä¸€ä¸ªå˜å¼‚æ“ä½œï¼Œä¼šç›´æ¥ä¿®æ”¹åŸå§‹åºå¯¹å¯¹è±¡çš„å†…å­˜å†…å®¹
2. ç´¢å¼•ä»0å¼€å§‹ï¼Œæ›¿æ¢çš„æ˜¯åºå¯¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆcaréƒ¨åˆ†ï¼‰
3. å½“åº”ç”¨äºåˆ—è¡¨æ—¶ï¼Œä¿®æ”¹çš„æ˜¯åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
4. ä¿®æ”¹ååŸå§‹å¯¹è±¡çš„å¼•ç”¨ä»ç„¶æŒ‡å‘åŒä¸€ä¸ªå†…å­˜ä½ç½®
5. é€‚ç”¨äºæ‰€æœ‰åºå¯¹æ•°æ®ï¼šä¸è®ºæ˜¯æ˜¾å¼ç‚¹å¯¹ (a . b) è¿˜æ˜¯éç©ºåˆ—è¡¨ (a b c ...)

é”™è¯¯å¤„ç†
--------
wrong-type-arg
    å½“ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯åºå¯¹ï¼ˆå¦‚ç©ºåˆ—è¡¨ã€æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰æ—¶æŠ›å‡ºé”™è¯¯ã€‚
wrong-number-of-args
    å½“å‚æ•°æ•°é‡ä¸ç­‰äº2æ—¶æŠ›å‡ºé”™è¯¯ã€‚

å½±å“èŒƒå›´
--------
- è¯¥æ“ä½œä¼šç›´æ¥å½±å“ä½¿ç”¨åŒä¸€å¼•ç”¨çš„æ‰€æœ‰ä»£ç ä½ç½®
- ä¿®æ”¹ååŸå§‹å¯¹è±¡çš„å†…å®¹ç«‹å³å‘ç”Ÿå˜åŒ–
- ä¸èƒ½ç”¨äºæ‰©å±•æˆ–ç¼©çŸ­åˆ—è¡¨é•¿åº¦ï¼Œä»…ç”¨äºæ›¿æ¢ç°æœ‰å…ƒç´ 
- è°¨æ…ä½¿ç”¨ï¼Œé¿å…ç ´åä¸å˜é‡æˆ–å¯¼è‡´ä¸å¯é¢„æœŸçš„å‰¯ä½œç”¨
|#

;; set-car!åŸºæœ¬åŠŸèƒ½æµ‹è¯•
(let ((p (cons 1 2)))
  (set-car! p 100)
  (check p => '(100 . 2)))

;; set-car!ç”¨äºåˆ—è¡¨çš„é¦–å…ƒç´ ä¿®æ”¹
(let ((lst (list 'a 'b 'c)))
  (set-car! lst 'x)
  (check lst => '(x b c)))

;; set-car!æµ‹è¯•ä¸åŒç±»å‹çš„å€¼
(let ((p (cons 'old 'value)))
  (set-car! p "new string")
  (check (car p) => "new string")
  (set-car! p 42)
  (check (car p) => 42)
  (set-car! p #t)
  (check (car p) => #t))

;; ä½¿ç”¨set-car!ä¿®æ”¹åµŒå¥—ç»“æ„
(let ((nested (list (list 1 2) (list 3 4))))
  (set-car! (car nested) 'first)
  (check nested => '((first 2) (3 4))))

;; set-car!ä¸consæ„é€ å™¨ç»“åˆæµ‹è¯•
(let ((p (cons 'initial 'cdr-value)))
  (check (car p) => 'initial)
  (set-car! p 'modified)
  (check (car p) => 'modified)
  (check (cdr p) => 'cdr-value))

;; å¤šæ¬¡set-car!è°ƒç”¨æµ‹è¯•
(let ((lst (list 1 2 3 4 5)))
  (set-car! lst 'first)
  (check lst => '(first 2 3 4 5))
  (set-car! lst 'changed)
  (check lst => '(changed 2 3 4 5)))

;; æµ‹è¯•set-car!çš„å‰¯ä½œç”¨ï¼ˆå˜é‡å¼•ç”¨ä¸€è‡´æ€§ï¼‰
(let ((lst1 (list 'a 'b 'c)))
  (let ((lst2 lst1))
    (set-car! lst1 'X)
    (check lst1 => '(X b c))  ; åŸåˆ—è¡¨å·²è¢«ä¿®æ”¹
    (check lst2 => '(X b c)))) ; lst2æŒ‡å‘åŒä¸€å¯¹è±¡ï¼Œä¹Ÿè¢«ä¿®æ”¹

;; æµ‹è¯•set-car!å¯¹ä¸åŒæ•°æ®ç»“æ„çš„å½±å“
(let ((pair (cons 'head 'tail))
      (alist (list 'a 'b 'c 'd 'e)))
  
  ;; ä¿®æ”¹ç‚¹å¯¹ç»“æ„
  (set-car! pair 'new-head)
  (check pair => '(new-head . tail))
  
  ;; ä¿®æ”¹åˆ—è¡¨çš„å„ä¸ªä½ç½®ï¼ˆé€šè¿‡è®¿é—®ä¸åŒcaræ“ä½œï¼‰
  (set-car! alist 'first)
  (check alist => '(first b c d e))
  
  ;; éªŒè¯åˆ—è¡¨ç»“æ„ä¿æŒæ­£ç¡®
  (check (length alist) => 5)
  (check (cdr alist) => '(b c d e)))

;; set-car!é”™è¯¯å¤„ç†æµ‹è¯•
(check-catch 'wrong-type-arg (set-car! 123 'value)); æ•°å­—ä¸æ˜¯pair
(check-catch 'wrong-type-arg (set-car! '() 'value)); ç©ºåˆ—è¡¨ä¸æ˜¯pair
(check-catch 'wrong-type-arg (set-car! "string" 'value)); å­—ç¬¦ä¸²ä¸æ˜¯pair
(check-catch 'wrong-type-arg (set-car! #t 'value)); å¸ƒå°”å€¼ä¸æ˜¯pair

;; æµ‹è¯•å‚æ•°æ•°é‡é”™è¯¯
(check-catch 'wrong-number-of-args (set-car! (cons 1 2)))
(check-catch 'wrong-number-of-args (set-car! (cons 1 2) 'a 'b))
(check-catch 'wrong-number-of-args (set-car!))

;; æµ‹è¯•å¤æ‚å¯¹è±¡çš„set-car!ä¿®æ”¹
(let ((complex-pair (cons (list 'old-structure 'with-values) 'remaining-cdr)))
  (set-car! complex-pair 'simplified)
  (check complex-pair => '(simplified . remaining-cdr)))

#|
set-cdr!
æ›¿æ¢åºå¯¹ï¼ˆpairï¼‰çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆcdréƒ¨åˆ†ï¼‰ä¸ºæ–°å€¼ï¼Œè¯¥æ“ä½œä¼šç›´æ¥ä¿®æ”¹åŸå§‹åºå¯¹å¯¹è±¡ã€‚

è¯­æ³•
----
(set-cdr! pair obj)

å‚æ•°
----
pair : pair?
    è¦è¢«ä¿®æ”¹çš„åºå¯¹ï¼Œå¯ä»¥æ˜¯ç‚¹å¯¹æˆ–ä»»ä½•éç©ºåˆ—è¡¨ã€‚å¿…é¡»æ˜¯ä¸€ä¸ªå¯ä»¥ä¿®æ”¹çš„åºå¯¹å¯¹è±¡ã€‚
    
obj : any
    è¦è®¾ç½®çš„æ–°å€¼ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ç¬¦å·ã€æ•°å­—ã€åˆ—è¡¨ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ç­‰ã€‚

è¿”å›å€¼
------
unspecified
    æ ¹æ®R7RSè§„èŒƒï¼Œè¿”å›æœªæŒ‡å®šçš„å€¼ã€‚

è¯´æ˜
----
1. set-cdr!æ˜¯ä¸€ä¸ªå˜å¼‚æ“ä½œï¼Œä¼šç›´æ¥ä¿®æ”¹åŸå§‹åºå¯¹å¯¹è±¡çš„å†…å­˜å†…å®¹
2. æ›¿æ¢çš„æ˜¯åºå¯¹çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆcdréƒ¨åˆ†ï¼‰
3. å½“åº”ç”¨äºåˆ—è¡¨æ—¶ï¼Œå¯ä»¥ä¿®æ”¹åˆ—è¡¨çš„å°¾éƒ¨ç»“æ„ï¼ŒåŒ…æ‹¬åˆ›å»ºå¾ªç¯ç»“æ„
4. ä¿®æ”¹ååŸå§‹å¯¹è±¡çš„å¼•ç”¨ä»ç„¶æŒ‡å‘åŒä¸€ä¸ªå†…å­˜ä½ç½®
5. é€‚ç”¨äºæ‰€æœ‰åºå¯¹æ•°æ®ï¼šä¸è®ºæ˜¯æ˜¾å¼ç‚¹å¯¹ (a . b) è¿˜æ˜¯éç©ºåˆ—è¡¨ (a b c ...)

é”™è¯¯å¤„ç†
--------
wrong-type-arg
    å½“ç¬¬ä¸€ä¸ªå‚æ•°ä¸æ˜¯åºå¯¹ï¼ˆå¦‚ç©ºåˆ—è¡¨ã€æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰æ—¶æŠ›å‡ºé”™è¯¯ã€‚
wrong-number-of-args
    å½“å‚æ•°æ•°é‡ä¸ç­‰äº2æ—¶æŠ›å‡ºé”™è¯¯ã€‚

å½±å“èŒƒå›´
--------
- è¯¥æ“ä½œä¼šç›´æ¥å½±å“ä½¿ç”¨åŒä¸€å¼•ç”¨çš„æ‰€æœ‰ä»£ç ä½ç½®
- ä¿®æ”¹ååŸå§‹å¯¹è±¡çš„å†…å®¹ç«‹å³å‘ç”Ÿå˜åŒ–
- å¯ä»¥ç”¨äºæ„å»ºå¾ªç¯åˆ—è¡¨ç»“æ„æˆ–æ‰©å±•åˆ—è¡¨å°¾éƒ¨
- è°¨æ…ä½¿ç”¨ï¼Œé¿å…ç ´åä¸å˜é‡æˆ–å¯¼è‡´ä¸å¯é¢„æœŸçš„å‰¯ä½œç”¨

ç¤ºä¾‹åº”ç”¨åœºæ™¯
------------
- æ„å»ºå¾ªç¯åˆ—è¡¨ï¼šé€šè¿‡set-cdr!å°†åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ çš„cdræŒ‡å‘åˆ—è¡¨è‡ªèº«
- åŠ¨æ€ä¿®æ”¹åˆ—è¡¨å°¾éƒ¨ï¼šå¯ä»¥æ›¿æ¢æ•´ä¸ªåˆ—è¡¨çš„å°¾éƒ¨ä¸ºä¸€ä¸ªæ–°åˆ—è¡¨
- é“¾è¡¨æ“ä½œï¼šåœ¨é“¾è¡¨æ•°æ®ç»“æ„ä¸­æ’å…¥æˆ–åˆ é™¤èŠ‚ç‚¹
|#

;; set-cdr!åŸºæœ¬åŠŸèƒ½æµ‹è¯•
(let ((p (cons 1 2)))
  (set-cdr! p 100)
  (check p => '(1 . 100)))

;; set-cdr!ç”¨äºåˆ—è¡¨å°¾å…ƒç´ ä¿®æ”¹
(let ((lst (list 'a 'b 'c)))
  (set-cdr! (cdr lst) '(x y)) 
  (check lst => '(a b x y)))

;; set-cdr!æµ‹è¯•ä¸åŒç±»å‹çš„å€¼
(let ((p (cons 'head 'old)))
  (set-cdr! p "new string")
  (check (cdr p) => "new string")
  (set-cdr! p 42)
  (check (cdr p) => 42)
  (set-cdr! p #t)
  (check (cdr p) => #t))

;; ä½¿ç”¨set-cdr!ä¿®æ”¹åµŒå¥—ç»“æ„
(let ((nested (list (list 1 2) (list 3 4))))
  (set-cdr! (car nested) 'tail)
  (check nested => '((1 . tail) (3 4))))

;; set-cdr!ä¸consæ„é€ å™¨ç»“åˆæµ‹è¯•
(let ((p (cons 'head 'cdr-value)))
  (check (cdr p) => 'cdr-value)
  (set-cdr! p 'modified)
  (check (cdr p) => 'modified)
  (check (car p) => 'head))

;; ä½¿ç”¨set-cdr!æ„å»ºå¾ªç¯ç»“æ„
(let ((lst (list 'a 'b 'c)))
  (set-cdr! (last-pair lst) lst)  ; åˆ›å»ºå¾ªç¯åˆ—è¡¨
  (check lst => lst)  ; å¾ªç¯å¼•ç”¨ï¼Œè‡ªèº«æŒ‡å‘
  (check (list-ref lst 3) => 'a)  ; ç¬¬å››ä¸ªå…ƒç´ å›åˆ°ç¬¬ä¸€ä¸ª
  (check (list-ref lst 4) => 'b))

;; set-cdr!æµ‹è¯•å¤šæ¬¡è°ƒç”¨
(let ((lst (list 1 2 3)))
  (let ((tail (list 'new-tail)))
    (set-cdr! (cdr lst) tail)
    (check lst => '(1 2 new-tail))))

;; æµ‹è¯•set-cdr!çš„å‰¯ä½œç”¨ï¼ˆå˜é‡å¼•ç”¨ä¸€è‡´æ€§ï¼‰
(let ((lst1 (list 'a 'b 'c)))
  (let ((lst2 lst1))
    (set-cdr! lst1 '(x))  ; å°†æ•´ä¸ªåˆ—è¡¨å°¾éƒ¨æ›¿æ¢ä¸º(x)
    (check lst1 => '(a x))  ; åŸåˆ—è¡¨å·²è¢«ä¿®æ”¹
    (check lst2 => '(a x)))) ; lst2æŒ‡å‘åŒä¸€å¯¹è±¡ï¼Œä¹Ÿè¢«ä¿®æ”¹

;; æµ‹è¯•set-cdr!å¯¹ä¸åŒæ•°æ®ç»“æ„çš„å½±å“
(let ((pair (cons 'first 'second))
      (lst (list 'a 'b 'c 'd)))
  
  ;; ä¿®æ”¹ç‚¹å¯¹ç»“æ„
  (set-cdr! pair 'new-tail)
  (check pair => '(first . new-tail))
  
  ;; å°†åˆ—è¡¨å°¾éƒ¨æ›¿æ¢ä¸ºå•ä¸ªå…ƒç´ 
  (set-cdr! (cdr (cdr lst)) '() )
  (check lst => '(a b c)))

;; æµ‹è¯•set-cdr!ä¸consç»“åˆæ„å»ºåŠ¨æ€ç»“æ„
(let ((lst (cons 'head 'tail)))
  (set-cdr! lst (cons 'second-element 'final))
  (check lst => '(head second-element . final)))

;; set-cdr!é”™è¯¯å¤„ç†æµ‹è¯•
(check-catch 'wrong-type-arg (set-cdr! 123 'value)); æ•°å­—ä¸æ˜¯pair
(check-catch 'wrong-type-arg (set-cdr! '() 'value)); ç©ºåˆ—è¡¨ä¸æ˜¯pair
(check-catch 'wrong-type-arg (set-cdr! "string" 'value)); å­—ç¬¦ä¸²ä¸æ˜¯pair
(check-catch 'wrong-type-arg (set-cdr! #t 'value)); å¸ƒå°”å€¼ä¸æ˜¯pair

;; æµ‹è¯•å‚æ•°æ•°é‡é”™è¯¯
(check-catch 'wrong-number-of-args (set-cdr! (cons 1 2)))
(check-catch 'wrong-number-of-args (set-cdr! (cons 1 2) 'a 'b))
(check-catch 'wrong-number-of-args (set-cdr!))

;; æµ‹è¯•å¤æ‚å¯¹è±¡çš„set-cdr!ä¿®æ”¹
(let ((complex-pair (cons (list 'head-structure) '(tail-structure remaining))))
  (set-cdr! complex-pair 'simple-tail)
  (check complex-pair => '((head-structure) . simple-tail)))

(check (caar '((a . b) . c)) => 'a)

#|
caar
caar æ˜¯ Scheme å†…ç½®å‡½æ•°ï¼Œç”¨äºè·å–åµŒå¥—åºå¯¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç¬¬ä¸€ä¸ªåˆ†é‡ã€‚è¯¥å‡½æ•°æ˜¯ R7RS æ ‡å‡†çš„åŸºæœ¬åˆ—è¡¨æ“ä½œå‡½æ•°ä¹‹ä¸€ã€‚æ­¤å‡½æ•°ç­‰ä»·äº (car (car pair))ã€‚

è¯­æ³•
----
(caar pair)

å‚æ•°
----
pair : pair?
å¿…é¡»æ˜¯åºå¯¹æˆ–åˆ—è¡¨ã€‚ä¸€èˆ¬ä¸ºä¸€ä¸ªåŒ…å«ç‚¹å¯¹æˆ–åˆ—è¡¨çš„åˆ—è¡¨ï¼Œå¦‚ ((a . b) . c) æˆ– ((a b c) ...)ã€‚

è¿”å›å€¼
------
ä»»æ„ç±»å‹
è¿”å›åµŒå¥—åºå¯¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç¬¬ä¸€ä¸ªåˆ†é‡ã€‚æ ¹æ®ä¸åŒåºå¯¹å’ŒåµŒå¥—ç»“æ„çš„æ€§è´¨ï¼Œè¿”å›ç±»å‹å¯ä»¥æ˜¯ç¬¦å·ã€æ•°å­—ã€åˆ—è¡¨ã€ç‚¹å¯¹ã€å¸ƒå°”å€¼ç­‰ä»»ä½•å¯¹è±¡ã€‚

è¯´æ˜
----
1. caar æ˜¯ pair? è°“è¯çš„é‡è¦æ“ä½œä¹‹ä¸€ï¼Œå¸¸ä¸ cdrã€cdarã€cadr ç­‰é…åˆä½¿ç”¨å¤„ç†åµŒå¥—åºå¯¹æ•°æ®
2. å½“åº”ç”¨äºåˆ—è¡¨æ—¶ï¼Œç›¸å½“äº (car (car list))ï¼Œéœ€è¦ä¿è¯åµŒå¥—ç»“æ„æœ‰æ•ˆä¸”éç©º
3. é€‚ç”¨äºæ‰€æœ‰åµŒå¥—åºå¯¹æ•°æ®ï¼šåŒ…æ‹¬ç‚¹å¯¹ç»“æ„ ((a . b) . c) å’ŒåµŒå¥—åˆ—è¡¨ ((a b c) d e f)
4. å½“åµŒå¥—ç»“æ„ä¸ºåˆ—è¡¨æ—¶ï¼Œcaar è¿”å›ç¬¬ä¸€ä¸ªåˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ 

é”™è¯¯å¤„ç†
--------
wrong-type-arg
å‡ºç°ä»¥ä¸‹æƒ…å†µæ—¶æŠ›å‡ºé”™è¯¯ï¼š
1. å‚æ•°ä¸æ˜¯åºå¯¹æˆ–åˆ—è¡¨ç±»å‹ï¼ˆå¦‚ç©ºåˆ—è¡¨ '()ã€æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰
2. åºå¯¹ç»“æ„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æœ¬èº«ä¸æ˜¯åºå¯¹æˆ–åˆ—è¡¨ï¼ˆå¦‚åŸå­æˆ–ç©ºåˆ—è¡¨ï¼‰
|#

;; åŸºç¡€æµ‹è¯•ï¼šæ˜¾å¼ç‚¹å¯¹ç»“æ„
(check (caar '((a . b) . c)) => 'a)
(check (caar '((1 . 2) . 3)) => 1)
(check (caar '((#t . #f) . nil)) => #t)

;; åŸºç¡€æµ‹è¯•ï¼šåˆ—è¡¨ç»“æ„
(check (caar '((a b c) d e)) => 'a)
(check (caar '((1 2 3) 4 5)) => 1)
(check (caar '((#t #f) x y z)) => #t)

;; åµŒå¥—åˆ—è¡¨ç»“æ„
(check (caar '(((a b) c) d e)) => '(a b))
(check (caar '(((() a) b) c)) => '(() a))
(check (caar '(((1 2) 3) 4)) => '(1 2))

;; æ··åˆç»“æ„æµ‹è¯•
(check (caar '(("hello" . 123) . "world")) => "hello")
(check (caar '((42 . "forty-two") . 99)) => 42)
(check (caar '((#\a . #\b) . nil)) => #\a)

;; æ„é€ å™¨åˆ›å»ºçš„ç»“æ„
(check (caar (cons (cons 1 2) (cons 3 4))) => 1)
(check (caar (cons (cons 'x 'y) (cons 'z 'w))) => 'x)
(check (caar (cons (list 1 2 3) (list 4 5 6))) => 1)

;; å¤æ‚åµŒå¥—æ„é€ 
(let ((nested (cons (cons (cons 1 2) (cons 3 4)) (cons 5 6))))
  (check (caar nested) => (cons 1 2)))

;; æ¶‰åŠç©ºåˆ—è¡¨çš„æµ‹è¯•
(check-catch 'wrong-type-arg (caar '(() . c)))
(check-catch 'wrong-type-arg (caar '((). ())))

;; éæ³•å‚æ•°ç±»å‹é”™è¯¯
(check-catch 'wrong-type-arg (caar 'a))
(check-catch 'wrong-type-arg (caar 123))
(check-catch 'wrong-type-arg (caar "hello"))
(check-catch 'wrong-type-arg (caar #f))
(check-catch 'wrong-type-arg (caar '()))
(check-catch 'wrong-type-arg (caar '(a b . c)))

;; è¿”å›ä¸åŒç±»å‹æµ‹è¯•
(check (caar '(("string" "another") 42)) => "string")
(check (caar '((123 456) 789)) => 123)
(check (caar '(((1 2 3)) 4 5 6)) => (list 1 2 3))
(check (caar '((#f nil "test") x y z)) => #f)

;; edge cases for nested structure
(check (caar '((((a))))) => '((a)))
(check (caar '((((1 2))) 3 4 5)) => '((1 2)))

#|
cadr
cadr æ˜¯ Scheme å†…ç½®å‡½æ•°ï¼Œç”¨äºè·å–åºå¯¹çš„ç¬¬äºŒä¸ªå…ƒç´ çš„ç¬¬ä¸€ä¸ªåˆ†é‡ã€‚è¯¥å‡½æ•°æ˜¯ R7RS æ ‡å‡†çš„åŸºæœ¬åˆ—è¡¨æ“ä½œå‡½æ•°ä¹‹ä¸€ï¼Œç­‰ä»·äº (car (cdr pair))ã€‚

è¯­æ³•
----
(cadr pair)

å‚æ•°
----
pair : pair?
å¯ä»¥æ˜¯åºå¯¹ï¼ˆå³éç©ºåˆ—è¡¨æˆ–æ˜¾å¼ç‚¹å¯¹ï¼‰ï¼Œä¸èƒ½æ˜¯ç©ºåˆ—è¡¨æˆ–å…¶ä»–å¯¹è±¡ã€‚

è¿”å›å€¼
------
ä»»æ„ç±»å‹
è¿”å›åºå¯¹çš„ç¬¬äºŒä¸ªå…ƒç´ çš„ç¬¬ä¸€ä¸ªåˆ†é‡ã€‚æ ¹æ®ä¸åŒçš„åºå¯¹å†…å®¹ï¼Œè¿”å›ç±»å‹å¯ä»¥æ˜¯
ç¬¦å·ã€æ•°å­—ã€åˆ—è¡¨ã€ç‚¹å¯¹ã€å¸ƒå°”å€¼ç­‰ä»»ä½•å¯¹è±¡ã€‚

è¯´æ˜
----
1. cadr æ˜¯ pair? è°“è¯çš„åŸºæœ¬æ“ä½œä¹‹ä¸€ï¼Œä¸ carã€cdr å’Œ caar é…åˆä½¿ç”¨å¤„ç†åºå¯¹æ•°æ®
2. å½“åº”ç”¨äºåˆ—è¡¨æ—¶ï¼Œè¿”å›åˆ—è¡¨çš„ç¬¬äºŒä¸ªå…ƒç´ 
3. é€‚ç”¨äºæ‰€æœ‰åºå¯¹æ•°æ®ï¼šä¸è®ºæ˜¯ç‚¹å¯¹ (a b . c) è¿˜æ˜¯éç©ºåˆ—è¡¨ (a b c ...)
4. ç­‰ä»·äº (car (cdr pair))ï¼Œæ‰§è¡Œé¡ºåºä»å³åˆ°å·¦è§£æ
5. æ˜¯ R7RS æ ‡å‡† car/cdr ç»„åˆå‡½æ•°çš„ä¹‹ä¸€

é”™è¯¯å¤„ç†
--------
wrong-type-arg
å½“å‚æ•°ä¸æ˜¯åºå¯¹ï¼ˆå¦‚ç©ºåˆ—è¡¨ '()ã€æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰æˆ–åºå¯¹çš„cadrä¸æ˜¯åºå¯¹æ—¶æŠ›å‡ºé”™è¯¯ã€‚

è¾¹ç•Œæ¡ä»¶
--------
- å½“åºå¯¹é•¿åº¦ä¸º1æ—¶ï¼Œcadr å¯èƒ½ä¸æ˜¯åºå¯¹ï¼Œéœ€è¦æŠ›å‡ºå¼‚å¸¸
- å•å…ƒç´ åˆ—è¡¨å› æ²¡æœ‰cadrä¼šå¼•å‘é”™è¯¯
- æ­£ç¡®æ”¯æŒä¸¤å…ƒç´ åŠä»¥ä¸Šåˆ—è¡¨çš„è®¿é—®

æ€§èƒ½ç‰¹å¾
--------
- æ—¶é—´å¤æ‚åº¦ï¼šO(1) æ’å®šæ—¶é—´å®Œæˆæ“ä½œ
- ç©ºé—´å¤æ‚åº¦ï¼šO(1) ä¸æ¶ˆè€—é¢å¤–æ ˆç©ºé—´
- å†…å­˜åˆ†é…ï¼šç›´æ¥è®¿é—®ç°æœ‰åºå¯¹ç»“æ„ï¼Œæ— æ–°å¯¹è±¡åˆ›å»º

æ•°æ®ç±»å‹å…¼å®¹æ€§
-------------
- æ”¯æŒæ‰€æœ‰ç±»å‹çš„åˆ—è¡¨å’Œåºå¯¹ç»“æ„
- å„å…ƒç´ å¯ä»¥æ˜¯ä»»æ„ Scheme å¯¹è±¡
- æ­£ç¡®å¤„ç†åµŒå¥—åˆ—è¡¨å’Œå¤æ‚ç»“æ„
|#

;; cadr åŸºç¡€æµ‹è¯• - å„ç§å…¸å‹åœºæ™¯
(check (cadr '(a b)) => 'b)
(check (cadr '(a b c)) => 'b)
(check (cadr '(1 2 3 4 5)) => 2)
(check-catch 'wrong-type-arg (cadr '(a . b)))  ; ç‚¹å¯¹ç»“æ„ï¼Œcadrä¸æ˜¯pair
(check (cadr '(a b . rest)) => 'b)
(check (cadr '((a . b) c)) => 'c)              ; æœ‰æ•ˆç‚¹å¯¹ç»“æ„

;; cadr è¾¹ç•Œæµ‹è¯•
(check (cadr '(a b)) => 'b)                     ; ä¸¤å…ƒç´ åˆ—è¡¨è¾¹ç•Œ
(check-catch 'wrong-type-arg (cadr '(only)))    ; å•å…ƒç´ åˆ—è¡¨å¼‚å¸¸
(check (cadr '(pair single)) => 'single)        ; ä¸¤å…ƒç´ ä»»æ„å€¼
(check-catch 'wrong-type-arg (cadr '(a . b)))         ; ç‚¹å¯¹ç»“æ„

;; æ•°æ®ç±»å‹è¾¹ç•Œæµ‹è¯•
(check (cadr '(42 string symbol #t)) => 'string)           ; æ··åˆç±»å‹è®¿é—®
(check (cadr '("hello" "world" "test")) => "world")      ; å­—ç¬¦ä¸²åˆ—è¡¨
(check (cadr '(#t #f #t)) => #f)                           ; å¸ƒå°”å€¼åˆ—è¡¨
(check (cadr '(list vector string)) => 'vector)             ; ç±»å‹å¯¹è±¡åˆ—è¡¨
(check (cadr '((a b) (c d) (e f))) => '(c d))              ; å­åˆ—è¡¨ç»“æ„

;; æ•°å€¼è¾¹ç•Œæµ‹è¯•
(check (cadr '(100 200 300 400 500)) => 200)                 ; æ•´æ•°æ•°å€¼
(check (cadr '(1.1 2.2 3.3 4.4 5.5)) => 2.2)                 ; æµ®ç‚¹æ•°å€¼
(check (cadr '(1/2 2/3 3/4)) => 2/3)                           ; æœ‰ç†æ•°
(check (cadr '(1+2i 3+4i 5+6i)) => 3+4i)                       ; å¤æ•°

;; ä»»æ„å¯¹è±¡ç±»å‹æµ‹è¯•
(check (cadr '( #a "string" 42 )) => "string")             ; å­—ç¬¦å¯¹è±¡
(check (cadr '(if-cond then-block else-block)) => 'then-block) ; Schemeå…³é”®å­—
(check (cadr '((lambda (x) x) (lambda (y) y) (lambda (z) z))) => '(lambda (y) y)) ; lambdaè¿‡ç¨‹

;; æ„é€ å™¨åˆ›å»ºçš„ç»“æ„æµ‹è¯•
(check (cadr (list 'a 'b 'c 'd)) => 'b)                       ; listæ„é€ å™¨
(check (cadr (cons 'a (cons 'b (cons 'c '())))) => 'b)        ; consæ„é€ å™¨
(check (cadr (append '() '(a b c))) => 'b)                   ; appendç»“æœ
(check (cadr (reverse '(c b a))) => 'b)                      ; reverseç»“æœ

;; Unicodeå’Œå­—ç¬¦ä¸²è¾¹ç•Œæµ‹è¯•
(check (cadr '("ä¸­æ–‡" "æµ‹è¯•" "éªŒè¯")) => "æµ‹è¯•")              ; Unicodeå­—ç¬¦ä¸²
(check (cadr '(#\ä¸­ #\æ–‡ #\å­—)) => #\æ–‡)               ; Unicodeå­—ç¬¦

(check-catch 'wrong-type-arg (cadr '()))                      ; ç©ºåˆ—è¡¨é”™è¯¯
(check-catch 'wrong-type-arg (cadr 123))                      ; æ•°å­—é”™è¯¯
(check-catch 'wrong-type-arg (cadr "string"))                 ; å­—ç¬¦ä¸²é”™è¯¯
(check-catch 'wrong-type-arg (cadr #t))                       ; å¸ƒå°”å€¼é”™è¯¯
(check-catch 'wrong-type-arg (cadr #\a))                       ; å­—ç¬¦é”™è¯¯
(check-catch 'wrong-type-arg (cadr #(a b)))                   ; å‘é‡é”™è¯¯

;; å•å…ƒç´ è¾¹ç•Œå¼‚å¸¸æµ‹è¯•
(check-catch 'wrong-type-arg (cadr '(single)))                ; å•å…ƒç´ åˆ—è¡¨é”™è¯¯
(check-catch 'wrong-type-arg (cadr '(all)))                   ; å•å…ƒç´ ä»»æ„å€¼é”™è¯¯

;; æ„é€ å™¨ä¸æ“ä½œå‡½æ•°é“¾å¼æµ‹è¯•
(check (cadr (list 'car 'cdr 'cons 'append)) => 'cdr)         ; å†…éƒ¨è¿‡ç¨‹å¯¹è±¡

;; =======================================
;; [201_12] cadr è¡¥å……è¾¹ç•Œæµ‹è¯•å’Œæ–‡æ¡£å®Œå–„
;; æ ¹æ® 201_12.md è¦æ±‚è¡¥å……è¾¹ç•Œå€¼å’Œæ•°æ®å…¼å®¹æ€§æµ‹è¯•
;; =======================================

;; è¾¹ç•Œæµ‹è¯•é›†1ï¼šç©ºç»“æ„è¾¹ç•Œ
(check-catch 'wrong-type-arg (cadr (cons 'a 'b)))          ; å•ç‚¹å¯¹ç»“æ„
(check-catch 'wrong-type-arg (cadr (cons 'a '())))         ; ç‚¹å¯¹ä¸ç©ºåˆ—è¡¨

;; è¾¹ç•Œæµ‹è¯•é›†2ï¼šæé™é•¿åº¦è¾¹ç•Œ  
(check (cadr (make-list 1000 'x)) => 'x)                   ; æå¤§é•¿åº¦éªŒè¯
(check (cadr (append '(a) (make-list 999 'x))) => 'x)      ; é•¿åˆ—è¡¨æ€§èƒ½è¾¹ç•Œ

;; è¾¹ç•Œæµ‹è¯•é›†3ï¼šç‰¹æ®Šå¯¹è±¡ç±»å‹è¾¹ç•Œ
(check (cadr '(#t + #f)) => '+)                             ; è¿‡ç¨‹å¯¹è±¡è®¿é—®
(check (cadr '(#t #(1 2 3) #f)) => #(1 2 3))                ; å‘é‡ä½œä¸ºå…ƒç´ 
(check (cadr '(#t #u8(255 128) #f)) => #u8(255 128))        ; å­—èŠ‚å‘é‡è®¿é—®

;; è¾¹ç•Œæµ‹è¯•é›†4ï¼šUnicodeè¾¹ç•Œæµ‹è¯•
(check (cadr '("ç‰¹æ®Š&ç¬¦å·" "æ­£å¸¸å­—ç¬¦ä¸²")) => "æ­£å¸¸å­—ç¬¦ä¸²")       ; å¤æ‚UTF-8è¾¹ç•Œ

;; è¾¹ç•Œæµ‹è¯•é›†5ï¼šå¤åˆç»“æ„å¼‚å¸¸è¾¹ç•Œ
(check-catch 'wrong-type-arg (cadr (vector 'a 'b)))          ; å‘é‡ç±»å‹é”™è¯¯
(check-catch 'wrong-number-of-args (cadr))                   ; é›¶å‚æ•°é”™è¯¯  
(check-catch 'wrong-number-of-args (cadr '(a b) '(c d)))     ; å¤šå‚æ•°é”™è¯¯

#|
cddr
cddr æ˜¯ Scheme å†…ç½®å‡½æ•°ï¼Œç”¨äºè·å–åºå¯¹ä»ç¬¬ä¸‰ä¸ªå…ƒç´ å¼€å§‹çš„æ‰€æœ‰åˆ†é‡ï¼ˆç§»é™¤ç¬¬1ã€ç¬¬2ä¸ªå…ƒç´ ï¼‰ã€‚è¯¥å‡½æ•°æ˜¯ R7RS æ ‡å‡†çš„åŸºæœ¬åˆ—è¡¨æ“ä½œå‡½æ•°ä¹‹ä¸€ã€‚æ­¤å‡½æ•°ç­‰ä»·äº (cdr (cdr pair))ã€‚

è¯­æ³•
----
(cddr pair)

å‚æ•°
----
pair : pair?
å¯ä»¥æ˜¯åºå¯¹ï¼ˆå³éç©ºåˆ—è¡¨æˆ–æ˜¾å¼ç‚¹å¯¹ï¼‰ï¼Œä¸èƒ½æ˜¯ç©ºåˆ—è¡¨æˆ–å…¶ä»–å¯¹è±¡ã€‚

è¿”å›å€¼
------
ä»»æ„ç±»å‹
è¿”å›åºå¯¹ç¬¬ä¸‰ä¸ªå…ƒç´ å¼€å§‹çš„æ‰€æœ‰åˆ†é‡ã€‚æ ¹æ®ä¸åŒçš„åºå¯¹å†…å®¹ï¼Œè¿”å›ç±»å‹å¯ä»¥æ˜¯
åˆ—è¡¨ã€ç¬¦å·ã€æ•°å­—ã€ç‚¹å¯¹ã€å¸ƒå°”å€¼ç­‰ä»»ä½•å¯¹è±¡ã€‚

è¯´æ˜
----
1. cddr æ˜¯ pair? è°“è¯çš„åŸºæœ¬æ“ä½œä¹‹ä¸€.
2. å½“åº”ç”¨äºåˆ—è¡¨æ—¶ï¼Œç›¸å½“äº(cdr(cdr list))ï¼Œéœ€è¦ä¿è¯åµŒå¥—ç»“æ„æœ‰æ•ˆä¸”éç©º
3. é€‚ç”¨äºæ‰€æœ‰åºå¯¹æ•°æ®ï¼šä¸è®ºæ˜¯ç‚¹å¯¹ (a . b) è¿˜æ˜¯éç©ºåˆ—è¡¨ (a b c ...)

é”™è¯¯å¤„ç†
--------
wrong-type-arg
1.å½“å‚æ•°ä¸æ˜¯åºå¯¹ï¼ˆå¦‚ç©ºåˆ—è¡¨ '()ã€æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰æ—¶æŠ›å‡ºé”™è¯¯ã€‚
2.åºé˜Ÿç»“æ„ä¸­çš„å…ƒç´ æ•°é‡å°‘äºä¸‰ä¸ªå…ƒç´ 

|#
(check (cddr '(a b c . d)) => '(c . d))
(check (cddr '(a b c)) => '(c))
(check (cddr '(1 2 . 3)) => 3)
(check (cddr '((a b) c . d)) => 'd)
(check (cddr (cons 'a (cons 'b (cons 'c 'd)))) => '(c . d))

; é”™è¯¯æµ‹è¯•
(check-catch 'wrong-type-arg (cddr '()))
(check-catch 'wrong-type-arg (cddr 123))
(check-catch 'wrong-type-arg (cddr "hello"))
(check-catch 'wrong-type-arg (cddr #t))
(check-catch 'wrong-number-of-args (cddr))
(check-catch 'wrong-number-of-args (cddr '(1 2) '(3 4)))

;; cddrè¾¹ç•Œæ¡ä»¶æµ‹è¯•è¡¥å……
(check (cddr '(a b)) => '())                       ; å•å…ƒç´ åˆ—è¡¨cddrè¾¹ç•Œ
(check (cddr '(1 2)) => '())                       ; å•å…ƒç´ æ•°å­—åˆ—è¡¨cddrè¾¹ç•Œ
(check (cddr '(#t #f)) => '())                      ; å•å…ƒç´ å¸ƒå°”åˆ—è¡¨cddrè¾¹ç•Œ
(check (cddr '("hello" "world")) => '())                 ; å•å…ƒç´ å­—ç¬¦ä¸²åˆ—è¡¨cddrè¾¹ç•Œ
(check (cddr '(() b c)) => '(c))               ; ç©ºåˆ—è¡¨ä½œä¸ºé¦–å…ƒç´ çš„cddr
;; å„ç§æ•°æ®ç±»å‹cddrè¾¹ç•Œæµ‹è¯•
(check (cddr '(123 "text" symbol)) => '(symbol))
(check (cddr '(#ewline #ab #\space)) => '(#\space))
(check (cddr '((a b) c d)) => '(d))
(check (cddr '(#(1 2) #(3 4) #(5 6))) => '(#(5 6)))
(check (cddr '(+ - * /)) => '(* /))
(check (cddr '('(a b) '(c d) '(e f))) => '('(e f)))

;; æç«¯è¾¹ç•Œæ¡ä»¶æµ‹è¯•
(check (cddr '((lambda (x) x) (lambda (y) y) (lambda (z) z))) => '((lambda (z) z)))
(check (cddr '((begin 1 2 3) (begin 4 5) (begin 6 7))) => '((begin 6 7)))
(check (cddr '(a b c.d)) => '(c.d))
(check (cddr '("ä¸­æ–‡" "æµ‹è¯•" "ç¨‹åº")) => '("ç¨‹åº"))

#|
null?
åˆ¤æ–­ç»™å®šçš„å¯¹è±¡æ˜¯å¦ä¸ºç©ºåˆ—è¡¨ã€‚

è¯­æ³•
----
(null? obj)

å‚æ•°
----
obj : any
ä»»æ„ç±»å‹çš„å¯¹è±¡

è¿”å›å€¼
------
boolean?
å¦‚æœobjæ˜¯ç©ºåˆ—è¡¨åˆ™è¿”å›#tï¼Œå¦åˆ™è¿”å›#f

è¯´æ˜
----
1. ç”¨äºæ£€æŸ¥å¯¹è±¡æ˜¯å¦ä¸ºç©ºåˆ—è¡¨'()
2. å¯¹å…¶ä»–ä»»ä½•ç±»å‹çš„å¯¹è±¡éƒ½è¿”å›#f
3. é€šå¸¸åœ¨åˆ—è¡¨å¤„ç†ä¸­ä½¿ç”¨ï¼Œç”¨äºåˆ¤æ–­åˆ—è¡¨æ˜¯å¦ä¸ºç©º

ç‰¹æ®Šè§„åˆ™
---------
- ä»…å½“å‚æ•°ä¸ºç²¾ç¡®çš„ç©ºåˆ—è¡¨ '() æ—¶è¿”å› #t
- æ‰€æœ‰å…¶ä»–å¯¹è±¡ï¼ŒåŒ…æ‹¬å‘é‡ã€å­—ç¬¦ä¸²ã€æ•°å­—ç­‰éƒ½è¿”å› #f
- éåˆ—è¡¨ç»“æ„ä¹Ÿè¿”å› #fï¼ˆå¦‚ç‚¹å¯¹ã€ç¬¦å·ç­‰ï¼‰

é”™è¯¯å¤„ç†
---------
wrong-number-of-args
å½“å‚æ•°æ•°é‡ä¸ä¸º1æ—¶æŠ›å‡ºé”™è¯¯ã€‚
|#

;; null? åŸºæœ¬æµ‹è¯•ï¼šç©ºåˆ—è¡¨å’Œéç©ºåˆ—è¡¨
(check (null? '()) => #t)                   ; ç©ºåˆ—è¡¨
(check (null? '(1)) => #f)                  ; å•å…ƒç´ åˆ—è¡¨
(check (null? '(a)) => #f)                  ; å•å…ƒç´ ç¬¦å·åˆ—è¡¨
(check (null? '(a b c)) => #f)              ; å¤šå…ƒç´ åˆ—è¡¨
(check (null? '(1 2 3 4 5)) => #f)          ; é•¿åˆ—è¡¨

;; null? ç‰¹æ®Šç»“æ„å’Œè¾¹ç•Œæƒ…å†µ
(check (null? '(())) => #f)                 ; åŒ…å«ç©ºåˆ—è¡¨çš„åˆ—è¡¨
(check (null? '(() () ())) => #f)           ; ç©ºåˆ—è¡¨åµŒå¥—
(check (null? '((a b) (c d))) => #f)        ; åµŒå¥—åˆ—è¡¨

;; null? éåˆ—è¡¨ç±»å‹æµ‹è¯• - å…¨é¢è¦†ç›–
(check (null? #t) => #f)                    ; å¸ƒå°”å€¼
(check (null? #f) => #f)                    ; å¸ƒå°”å€¼
(check (null? 0) => #f)                     ; é›¶
(check (null? 123) => #f)                   ; æ•´æ•°
(check (null? -456) => #f)                  ; è´Ÿæ•´æ•°
(check (null? 3.14) => #f)                  ; æµ®ç‚¹æ•°
(check (null? "") => #f)                   ; ç©ºå­—ç¬¦ä¸²
(check (null? "hello") => #f)               ; å­—ç¬¦ä¸²
(check (null? '#()) => #f)                  ; ç©ºå‘é‡
(check (null? '#(1 2 3)) => #f)             ; å‘é‡
(check (null? 'symbol) => #f)               ; ç¬¦å·
(check (null? '123) => #f)                  ; æ•°å­—ç¬¦å·
(check (null? #\a) => #f)                  ; å­—ç¬¦

;; null? ç‚¹å¯¹ç»“æ„æµ‹è¯•
(check (null? '(a . b)) => #f)              ; ç‚¹å¯¹ä¸æ˜¯ç©ºåˆ—è¡¨
(check (null? (cons 1 2)) => #f)            ; cons åˆ›å»ºçš„ç‚¹å¯¹

;; null? å¤æ‚è¡¨è¾¾å¼æµ‹è¯•
(check (null? (list)) => #t)                ; ç”±liståˆ›å»ºçš„ç©ºåˆ—è¡¨
(check (null? (append '() '())) => #t)      ; appendç»“æœ
(check (null? (cdr '(a))) => #t)            ; cdrç»“æœ
(check (null? (cdr '(a b))) => #f)          ; cdrç»“æœ

;; null? ä¸åˆ—è¡¨æ“ä½œç»“åˆæµ‹è¯•
(check (null? (reverse '())) => #t)
(check (null? (reverse '(1))) => #f)

;; null? é”™è¯¯å¤„ç†æµ‹è¯•
(check-catch 'wrong-number-of-args (null?))
(check-catch 'wrong-number-of-args (null? '() '()))
(check-catch 'wrong-number-of-args (null? 1 2))


#|
list?
åˆ¤æ–­ç»™å®šçš„å¯¹è±¡æ˜¯å¦ä¸ºåˆ—è¡¨ç±»å‹ã€‚

è¯­æ³•
----
(list? obj)

å‚æ•°
----
obj : any
ä»»æ„ç±»å‹çš„å¯¹è±¡

è¿”å›å€¼
------
boolean?
å¦‚æœobjæ˜¯åˆ—è¡¨ç±»å‹åˆ™è¿”å›#tï¼Œå¦åˆ™è¿”å›#f

è¯´æ˜
----
1. ç”¨äºæ£€æŸ¥å¯¹è±¡æ˜¯å¦ä¸ºåˆ—è¡¨ç±»å‹
2. èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«ç©ºåˆ—è¡¨ '() å’Œéç©ºåˆ—è¡¨
3. èƒ½å¤Ÿå¤„ç†åµŒå¥—åˆ—è¡¨å’Œç‚¹å¯¹ç»“æ„
4. èƒ½å¤Ÿå¤„ç†å¾ªç¯åˆ—è¡¨ç­‰ç‰¹æ®Šç»“æ„

ç‰¹æ®Šè§„åˆ™
---------
- ç©ºåˆ—è¡¨ '() è¢«è®¤ä¸ºæ˜¯åˆ—è¡¨
- ç‚¹å¯¹ç»“æ„å¦‚æœå½¢æˆå®Œæ•´åˆ—è¡¨åˆ™ä¹Ÿè®¤ä¸ºæ˜¯åˆ—è¡¨
- å…¶ä»–ç±»å‹å¦‚æ•°å­—ã€å­—ç¬¦ä¸²ã€å‘é‡ã€å¸ƒå°”å€¼ç­‰éƒ½è¿”å›#f
  

é”™è¯¯å¤„ç†
---------
wrong-number-of-args
å½“å‚æ•°æ•°é‡ä¸ä¸º1æ—¶æŠ›å‡ºé”™è¯¯ã€‚
|#

;; list? åŸºæœ¬æµ‹è¯•ï¼šç©ºåˆ—è¡¨å’Œå„ç§ç®€å•åˆ—è¡¨
(check-true (list? '()))                        ; ç©ºåˆ—è¡¨
(check-true (list? '(a)))                       ; å•å…ƒç´ 
(check-true (list? '(a b c)))                   ; å¤šå…ƒç´ æ™®é€šåˆ—è¡¨
(check-true (list? '(1 2 3 4 5)))               ; æ•°å­—é•¿åˆ—è¡¨

;; list? åµŒå¥—å’Œå¤æ‚ç»“æ„æµ‹è¯•
(check-true (list? '(a (b) c)))                 ; åµŒå¥—åˆ—è¡¨  
(check-true (list? '((a) (b) (c))))             ; å¤šå±‚åµŒå¥—
(check-true (list? '((a b) (c d))))             ; æ·±åº¦åµŒå¥—
(check-true (list? '(1 (2 (3 (4))))))           ; å¤šçº§åµŒå¥—

;; list? æ··åˆç±»å‹å…ƒç´ æµ‹è¯•
(check-true (list? '(a 1 "string" #t)))         ; æ··åˆç±»å‹
(check-true (list? '((list 1 2) (vector 3 4)))) ; åŒ…å«å¤æ‚å¯¹è±¡

;; list? ç‚¹å’Œè¾¹ç•Œæƒ…å†µ
(check-true (list? '(1 . 2)))                   ; ç‚¹å¯¹ç»“æ„
(check-true (list? '(a b . c)))                 ; éå®Œæ•´åˆ—è¡¨è¾¹ç¼˜æƒ…å†µ

;; list? ç‰¹æ®Šç»“æ„æµ‹è¯•
(check-true (list? (let ((x '(1 2 3)))          ; å¾ªç¯åˆ—è¡¨
                    (set-cdr! (cddr x) x) x)))

;; list? éåˆ—è¡¨ç±»å‹æµ‹è¯• - å…¨é¢è¦†ç›–
(check-false (list? #t))                        ; å¸ƒå°”å€¼
(check-false (list? #f))                        ; å¸ƒå°”å€¼
(check-false (list? 123))                       ; æ•´æ•°
(check-false (list? -456))                      ; è´Ÿæ•´æ•°
(check-false (list? 0))                         ; é›¶
(check-false (list? 3.14))                      ; æµ®ç‚¹æ•°
(check-false (list? "Hello"))                   ; å­—ç¬¦ä¸²
(check-false (list? ""))                        ; ç©ºå­—ç¬¦ä¸²
(check-false (list? '#()))                       ; ç©ºå‘é‡
(check-false (list? '#(1 2 3)))                  ; å‘é‡
(check-false (list? '12345))                    ; æ•°å­—ç¬¦å·
(check-false (list? 'symbol))                   ; ç¬¦å·
(check-false (list? #\a))                       ; å­—ç¬¦

;; list? é”™è¯¯å¤„ç†æµ‹è¯•
(check-catch 'wrong-number-of-args (list?))
(check-catch 'wrong-number-of-args (list? #t #f))

#|
make-list
åˆ›å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šæ•°é‡æŒ‡å®šå…ƒç´ çš„åˆ—è¡¨ã€‚

è¯­æ³•
----
(make-list n fill)
(make-list n)

å‚æ•°
----
n : exact?
    ç²¾ç¡®çš„éè´Ÿæ•´æ•°ï¼Œè¡¨ç¤ºè¦åˆ›å»ºçš„åˆ—è¡¨é•¿åº¦ã€‚
    å¿…é¡»æ»¡è¶³ 0 <= n < (expt 2 32) æˆ–å®ç°å®šä¹‰çš„æœ€å¤§å…è®¸åˆ—è¡¨é•¿åº¦ã€‚

fill : any (å¯é€‰)
    å¡«å……åˆ°åˆ—è¡¨ä¸­çš„å…ƒç´ å€¼ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º #fã€‚
    å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„ Scheme å¯¹è±¡ã€‚

è¿”å›å€¼
------
list?
    ä¸€ä¸ªé•¿åº¦ä¸º n çš„åˆ—è¡¨ï¼Œæ‰€æœ‰å…ƒç´ éƒ½ä¸º fill å€¼ã€‚
    å½“ n ä¸º 0 æ—¶è¿”å›ç©ºåˆ—è¡¨ '()ã€‚

è¯´æ˜
----
1. è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šå½¢å¼çš„åˆ—è¡¨æ„é€ å™¨ï¼Œç”¨äºå¿«é€Ÿåˆ›å»ºåŒ…å«é‡å¤å…ƒç´ çš„åˆ—è¡¨
2. å¯ä¸ºä»»ä½•éè´Ÿæ•´æ•°é•¿åº¦åˆ›å»ºåˆ—è¡¨ï¼ŒåŒ…æ‹¬ç©ºåˆ—è¡¨
3. å¡«å……å…ƒç´ å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼ŒåŒ…æ‹¬å¤æ‚å¯¹è±¡
4. ä½¿ç”¨ make-list æ„é€ çš„åˆ—è¡¨æ˜¯å…¨æ–°çš„å•ä¸ªå¯¹è±¡ï¼Œä¸ä¼šä¸å…¶ä»–å¯¹è±¡å…±äº«ç»“æ„
5. ä¸»è¦ç”¨äºåˆå§‹åŒ–æ•°æ®ç»“æ„ã€ç”Ÿæˆæµ‹è¯•æ•°æ®ç­‰åœºæ™¯

è¾¹ç•Œæ¡ä»¶
--------
- n = 0 è¿”å›ç©ºåˆ—è¡¨ '()
- n = 1 è¿”å›å•å…ƒç´ åˆ—è¡¨ '(fill)
- æ”¯æŒæå¤§ n å€¼ï¼ˆå—å®ç°æœ€å¤§å…è®¸åˆ—è¡¨é•¿åº¦é™åˆ¶ï¼‰
- fill å€¼å¯ä»¥æ˜¯å„ç§æ•°æ®ç±»å‹å’Œå¤æ‚å¯¹è±¡
- å…è®¸åˆ—è¡¨å†…å®¹ä¸ºåµŒå¥—ç»“æ„æˆ–å‡½æ•°å¯¹è±¡

æ€§èƒ½ç‰¹å¾
--------
- æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œçº¿æ€§æ—¶é—´æ„å»ºåˆ—è¡¨
- ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œéœ€è¦ä¸ºnä¸ªæ–°åºå¯¹åˆ†é…å†…å­˜
- é€’å½’æ·±åº¦ï¼šæ— é€’å½’ï¼Œä½¿ç”¨å¾ªç¯æ„é€ 
- å†…å­˜åˆ†é…ï¼šåˆ›å»ºnä¸ªæ–°çš„åºå¯¹å¯¹è±¡

æ•°æ®ç±»å‹å…¼å®¹æ€§
-------------
- fillå€¼æ”¯æŒï¼šæ•°å€¼ã€å¸ƒå°”ã€å­—ç¬¦ã€å­—ç¬¦ä¸²ã€ç¬¦å·ã€è¿‡ç¨‹ã€åˆ—è¡¨ã€å‘é‡ã€å­—èŠ‚å‘é‡ç­‰æ‰€æœ‰ç±»å‹
- nå€¼çº¦æŸï¼šæ•´æ•°ç±»å‹ï¼Œå»ºè®®ä¸ºæ­£æ•´æ•°å’Œ0
- è¿”å›å€¼ï¼šç»Ÿä¸€çš„åˆ—è¡¨ç±»å‹

é™åˆ¶è¯´æ˜
--------
- fillå‚æ•°æ˜¯å€¼ä¼ é€’ï¼Œå¤æ‚å¯¹è±¡ä¼šå¤åˆ¶å¼•ç”¨ï¼Œä¸ä¼šåˆ›å»ºæ–°å¯¹è±¡
- æå¤§nå€¼å¯èƒ½å¯¼è‡´å†…å­˜ä¸è¶³
- ä¸é€‚åˆåŠ¨æ€å¢é•¿çš„åˆ—è¡¨æ„å»º

ç¤ºä¾‹
----
(make-list 3 'x) => '(x x x)
(make-list 0 'x) => '()
(make-list 2 42) => '(42 42)
(make-list 4 #\a) => '(#\a #\a #\a #\a)
|#

;; make-list åŸºæœ¬åŠŸèƒ½æµ‹è¯•
(check (make-list 0) => '())                                   ; ç©ºåˆ—è¡¨è¾¹ç•Œ
(check (make-list 0 'x) => '())                               ; æŒ‡å®šå¡«å……å€¼çš„ç©ºåˆ—è¡¨
(check (make-list 1) => '(#f))                                ; é»˜è®¤å¡«å……å€¼å•å…ƒç´ 
(check (make-list 1 'singleton) => '(singleton))             ; è‡ªå®šä¹‰å¡«å……å€¼å•å…ƒç´ 
(check (make-list 3) => '(#f #f #f))                          ; é»˜è®¤å¡«å……å€¼å¤šå…ƒç´ 
(check (make-list 3 'repeat) => '(repeat repeat repeat))      ; è‡ªå®šä¹‰å¡«å……å€¼å¤šå…ƒç´ 

;; make-list è¾¹ç•Œå€¼æµ‹è¯•
(check (make-list 10 'a) => '(a a a a a a a a a a))           ; åˆ°é•¿åº¦è¾¹ç•Œ
(check (make-list 100 'X) => (make-list 100 'X))             ; å¤§é•¿åº¦éªŒè¯ä¸€è‡´æ€§

;; make-list æ•°æ®ç±»å‹å…¼å®¹æ€§æµ‹è¯•
(check (make-list 4 42) => '(42 42 42 42))                    ; æ•´æ•°ç±»å‹
(check (make-list 3 3.14) => '(3.14 3.14 3.14))               ; å®æ•°ç±»å‹
(check (make-list 2 #t) => '(#t #t))                          ; å¸ƒå°”å€¼
(check (make-list 2 #\a) => '(#\a #\a))                      ; å­—ç¬¦ç±»å‹
(check (make-list 2 "hello") => '("hello" "hello"))           ; å­—ç¬¦ä¸²ç±»å‹
(check (make-list 3 'symbol) => '(symbol symbol symbol))      ; ç¬¦å·ç±»å‹
(check (make-list 2 #(1 2 3)) => `(#(1 2 3) #(1 2 3)))      ; å‘é‡å¯¹è±¡
(check (make-list 2 #u8(255 128)) => `(#u8(255 128) #u8(255 128))) ; å­—èŠ‚å‘é‡

;; make-list å¤æ‚æ•°æ®ç±»å‹æµ‹è¯•
(check (make-list 3 '()) => '(() () ()))                      ; ç©ºåˆ—è¡¨ä½œä¸ºå¡«å……å€¼
(check (make-list 2 '(a b c)) => '((a b c) (a b c)))          ; åˆ—è¡¨ä½œä¸ºå¡«å……å€¼
(check (make-list 2 (list 1 2 3)) => '((1 2 3) (1 2 3)))      ; åˆ—è¡¨ä½œä¸ºå¡«å……å€¼

;; make-list æç«¯è¾¹ç•Œæµ‹è¯•
(check (make-list 2 (cons 'a 'b)) => '((a . b) (a . b)))      ; ç‚¹å¯¹ç»“æ„ä½œä¸ºå¡«å……å€¼
(check (make-list 1 (make-list 3 'x)) => '((x x x)))          ; åµŒå¥—make-listè°ƒç”¨
(check (make-list 3 (make-list 0)) => '(() () ()))            ; ç©ºåˆ—è¡¨åµŒå¥—

;; make-list å‡½æ•°å’Œè¿‡ç¨‹å¯¹è±¡çš„åŸºæœ¬éªŒè¯
(check (length (make-list 3 car)) => 3)                      ; éªŒè¯é•¿åº¦
(check (list? (make-list 2 car)) => #t)                      ; éªŒè¯ç±»å‹
(check (procedure? (car (make-list 2 car))) => #t)           ; éªŒè¯è¿‡ç¨‹å¯¹è±¡æ­£ç¡®æ€§

;; make-list åŠ¨æ€è¾¹ç•ŒéªŒè¯
(let ((n 5))
  (let ((result (make-list n 'test)))
    (check (length result) => n)
    (check (list? result) => #t)
    (check (car result) => 'test))) ; ç®€å•çš„å…ƒç´ éªŒè¯

;; make-list å†…å­˜ç»“æ„éªŒè¯  
(let ((lst1 (make-list 3 'same))
      (lst2 (make-list 3 'same)))
  (check (equal? lst1 lst2) => #t)                          ; å†…å®¹ç›¸åŒ
  (check (eq? lst1 lst2) => #f))                             ; ä¸æ˜¯åŒä¸€å¯¹è±¡

;; é”™è¯¯å‚æ•°ç±»å‹æµ‹è¯•
(check-catch 'wrong-number-of-args (make-list))               ; å‚æ•°ä¸è¶³
(check-catch 'wrong-number-of-args (make-list 3 'x 'extra))   ; å‚æ•°è¿‡å¤š
(check-catch 'out-of-range (make-list -1 'x))                ; è´Ÿæ•°é•¿åº¦é”™è¯¯

#|
list
é€šè¿‡ç»™å®šå…ƒç´ æ„å»ºä¸€ä¸ªæ–°çš„åˆ—è¡¨ã€‚è¯¥å‡½æ•°æ˜¯R7RSæ ‡å‡†çš„åŸºæœ¬åˆ—è¡¨æ„é€ å‡½æ•°ä¹‹ä¸€ã€‚

è¯­æ³•
----
(list obj ...)

å‚æ•°
----
obj ... : any
ä»»æ„æ•°é‡å’Œç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ç¬¦å·ã€æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€åˆ—è¡¨ã€å‘é‡ã€å­—èŠ‚å‘é‡ã€å­—ç¬¦ã€è¿‡ç¨‹ç­‰ã€‚

è¿”å›å€¼
------
list?
è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼ŒåŒ…å«æ‰€æœ‰å‚æ•°objæŒ‰é¡ºåºæ’åˆ—ã€‚ç©ºå‚æ•°è¿”å›ç©ºåˆ—è¡¨'()ã€‚

è¯´æ˜
----
1. listæ˜¯æ„å»ºæ–°åˆ—è¡¨çš„é¦–é€‰æ„é€ å‡½æ•°ï¼Œå°†ä»»æ„æ•°é‡å’Œç±»å‹çš„å‚æ•°ç»„åˆæˆåˆ—è¡¨
2. è¿”å›çš„æ˜¯æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œä¸è¾“å…¥å‚æ•°ä¸ä¼šå…±äº«å†…å­˜ç»“æ„
3. æ¥å—ä»»æ„ç±»å‹çš„å‚æ•°ï¼ŒåŒ…æ‹¬åµŒå¥—åˆ—è¡¨ã€å¤æ‚å¯¹è±¡ç­‰ç‰¹æ®Šç±»å‹
4. ç©ºå‚æ•°è°ƒç”¨è¿”å›ç©ºåˆ—è¡¨'()ï¼Œå•å‚æ•°åˆ›å»ºå•å…ƒç´ åˆ—è¡¨
5. ä¸consä¸åŒï¼Œlistæ„é€ çš„æ˜¯ç»Ÿä¸€ç»“æ„çš„åˆ—è¡¨

è¾¹ç•Œæ¡ä»¶
--------
- ç©ºå‚æ•°ï¼šè¿”å›ç©ºåˆ—è¡¨'()
- å•å‚æ•°ï¼šè¿”å›å•å…ƒç´ åˆ—è¡¨
- åŒç±»å‹å‚æ•°ï¼šä¿æŒç±»å‹ä¸€è‡´æ€§
- å¤šç±»å‹æ··åˆï¼šå…è®¸ä»»æ„ç±»å‹ç»„åˆ
- åµŒå¥—ç»“æ„ï¼šæ­£ç¡®å¤„ç†å­åˆ—è¡¨åµŒå¥—
- æå¤§å‚æ•°æ•°é‡ï¼šæ”¯æŒå¤§é‡å‚æ•°æ„é€ 
- é‡å¤å…ƒç´ ï¼šä¿ç•™æ¯ä¸ªå®ä¾‹

æ€§èƒ½ç‰¹å¾
--------
- æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œä¸å‚æ•°æ•°é‡æˆæ­£æ¯”
- ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œæ–°åˆ—è¡¨æ¶ˆè€—å†…å­˜ä¸å‚æ•°æ•°é‡æˆæ­£æ¯”
- å†…å­˜åˆ†é…ï¼šåˆ›å»ºæ–°çš„åºå¯¹å¯¹è±¡ï¼Œä¸å…±äº«è¾“å…¥å‚æ•°
- æ·±å±‚åµŒå¥—ï¼šæ”¯æŒæ·±å±‚ç»“æ„ä¸å½±å“æ€§èƒ½

æ•°æ®ç±»å‹å…¼å®¹æ€§
-------------
- æ•°å€¼ç±»å‹ï¼šæ•´æ•°ã€å®æ•°ã€å¤æ•°ã€æœ‰ç†æ•°
- å­—ç¬¦ä¸²ï¼šä»»æ„é•¿åº¦å’Œå†…å®¹å­—ç¬¦ä¸²
- å­—ç¬¦ï¼šä»»æ„å­—ç¬¦åŒ…æ‹¬Unicode
- ç¬¦å·ï¼šæ™®é€šç¬¦å·åŠå…³é”®å­—ç¬¦å·
- å¸ƒå°”å€¼ï¼š#tå’Œ#fæ”¯æŒ
- åˆ—è¡¨ï¼šç©ºåˆ—è¡¨å’Œä»»æ„åµŒå¥—åˆ—è¡¨
- å‘é‡ï¼šä»»æ„ç»´åº¦å’Œå†…å®¹çš„å‘é‡
- å­—èŠ‚å‘é‡ï¼šä»»æ„å­—èŠ‚åºåˆ—
- è¿‡ç¨‹ï¼šå†…ç½®è¿‡ç¨‹å’Œè‡ªå®šä¹‰è¿‡ç¨‹
- å¤åˆå¯¹è±¡ï¼šå¯¹è±¡ç»„åˆçš„ä»»æ„åµŒå¥—

é™åˆ¶è¯´æ˜
--------
- å‚æ•°ä¼ é€’æ˜¯å€¼ä¼ é€’ï¼Œå¤æ‚å¯¹è±¡ä¼šå¤åˆ¶å¼•ç”¨
- æå¤§å‚æ•°åˆ—è¡¨å¯èƒ½å¯¼è‡´å†…å­˜ä¸è¶³
- ä¸æ”¯æŒå•ç‹¬è®¾ç½®å…ƒç´ å€¼ï¼Œå¦‚éœ€ç²¾ç¡®æ§åˆ¶éœ€ä½¿ç”¨cons

ç¤ºä¾‹
----
(list) => '()
(list 'a) => '(a)
(list 1 2 3) => '(1 2 3)
(list "hello" "world") => '("hello" "world")
(list 'a 42 #t 'b) => '(a 42 #t b)
|#

;; list åŸºæœ¬æ„é€ åŠŸèƒ½æµ‹è¯•
(check (list) => '())                    ; ç©ºå‚æ•°æ„é€ 
(check (list 'a) => '(a))               ; å•å…ƒç´ æ„é€ 
(check (list 1 2 3) => '(1 2 3))        ; å¤šå…ƒç´ æ„é€ 
(check (list "hello") => '("hello"))   ; å•å…ƒç´ å­—ç¬¦ä¸²

;; è¾¹ç•Œæ¡ä»¶æµ‹è¯•
(check (list) => '())                   ; è¾¹ç•Œï¼šç©ºåˆ—è¡¨æ„é€ 
(check (list 'single) => '(single))     ; è¾¹ç•Œï¼šå•å…ƒç´ åˆ—è¡¨
(check (list 'a 'b 'c 'd) => '(a b c d))  ; è¾¹ç•Œï¼šå››å…ƒç´ åˆ—è¡¨

;; æ•°æ®ç±»å‹å…¼å®¹æ€§æµ‹è¯•
(check (list 42 3.14 1/2 1+2i) => '(42 3.14 1/2 1+2i))  ; æ•°å€¼ç±»å‹
(check (list #t #f) => '(#t #f))        ; å¸ƒå°”å€¼
(check (list #\a #\b #\c) => '(#\a #\b #\c))   ; å­—ç¬¦
(check (list "hello" "world") => '("hello" "world"))  ; å­—ç¬¦ä¸²
(check (list 'symbol1 'symbol2 'keyword:) => '(symbol1 symbol2 keyword:)) ; ç¬¦å·

;; åµŒå¥—ç»“æ„æµ‹è¯•
(check (list '() '() '()) => '(() () ()))   ; ç©ºåˆ—è¡¨åµŒå¥—
(check (list '(a b) '(c d)) => '((a b) (c d)))  ; å­åˆ—è¡¨åµŒå¥—
(check (list (list 1 2) (list 3 4)) => '((1 2) (3 4)))  ; åˆ—è¡¨æ„é€ å‡½æ•°åµŒå¥—

;; å¤æ‚å¯¹è±¡æµ‹è¯•
(check (list #(1 2 3) #u8(255 128)) => `(#(1 2 3) #u8(255 128)))  ; å‘é‡/å­—èŠ‚å‘é‡
(check (list #t #f) => `(#t #f))  ; ç®€å•ç±»å‹éªŒè¯
(check (list 1 2 3) => `(1 2 3))  ; æ•°å€¼ç±»å‹éªŒè¯

;; æ··åˆç±»å‹æµ‹è¯•
(check (list 'symbol 42 "text" #\c #t #(1 2)) => '(symbol 42 "text" #\c #t #(1 2)))  ; å…¨ç±»å‹æ··åˆ
(check (list 'a 1 "hello" '(sub list) #t 3.14) => '(a 1 "hello" (sub list) #t 3.14))  ; å¤åˆæ··åˆ

;; æå¤§å‚æ•°æ•°é‡æµ‹è¯•
(check (list 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20) => '(1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20))  ; è¾¹ç•Œï¼šå¤§é‡å‚æ•°

;; é‡å¤å…ƒç´ æµ‹è¯•
(check (list 'a 'a 'a) => '(a a a))     ; é‡å¤ç¬¦å·
(check (list 1 1 1 1) => '(1 1 1 1))     ; é‡å¤æ•°å­—
(check (list "test" "test") => '("test" "test"))  ; é‡å¤å­—ç¬¦ä¸²

;; Unicodeå’Œç‰¹æ®Šå­—ç¬¦æµ‹è¯•
(check (list "ä¸­æ–‡" "æµ‹è¯•" "å­—ç¬¦ä¸²") => '("ä¸­æ–‡" "æµ‹è¯•" "å­—ç¬¦ä¸²"))  ; Unicodeå­—ç¬¦ä¸²
(check (list #\ä¸­ #\æ–‡) => '(#\ä¸­ #\æ–‡))   ; Unicodeå­—ç¬¦

;; æ·±å±‚åµŒå¥—ç»“æ„æµ‹è¯•
(check (list (list (list 'a)) (list 'b)) => '(((a)) (b)))  ; ä¸‰å±‚åµŒå¥—
(check (list '() (list '() (list 'a))) => '(() (() (a))))   ; å¤æ‚åµŒå¥—

;; æ€§èƒ½éªŒè¯ï¼šå¤§åˆ—è¡¨æ„é€ 
(check (length (list 'a 'b 'c 'd 'e 'f 'g 'h 'i 'j 'k 'l 'm 'n 'o 'p 'q 'r 's 't 'u 'v 'w 'x 'y 'z)) => 26)  ; éªŒè¯å®Œæ•´æ„é€ 

;; é”™è¯¯æµ‹è¯• - å‚æ•°ç±»å‹éªŒè¯
(check (list 123) => '(123))  ; è¯å®æ•°å­—å¯ä»¥ä½œä¸ºå‚æ•°
(check (list "string") => '("string"))  ; è¯å®å­—ç¬¦ä¸²å¯ä»¥ä½œä¸ºå‚æ•°
(check (list #t) => '(#t))   ; è¯å®å¸ƒå°”å€¼å¯ä»¥ä½œä¸ºå‚æ•°

;; æ„é€ åæ“ä½œéªŒè¯
(let ((constructed (list 1 2 3 4 5)))
  (check (length constructed) => 5)      ; éªŒè¯é•¿åº¦
  (check (list? constructed) => #t)      ; éªŒè¯ç±»å‹
  (check (list-ref constructed 2) => 3))  ; éªŒè¯ç´¢å¼•è®¿é—®

;; ç‹¬ç«‹å¯¹è±¡éªŒè¯ - ç¡®è®¤ä¸ä¸å‚æ•°å…±äº«
(let ((a 'original)
      (b "test")
      (c #t))
  (let ((result (list a b c)))
    (check (equal? result '(original "test" #t)) => #t)  ; å€¼æ­£ç¡®
    (check (not (eq? result a)) => #t)  ; ç‹¬ç«‹å¯¹è±¡éªŒè¯
    (check (not (eq? result b)) => #t)))

;; å‚æ•°ä¼ é€’éªŒè¯æµ‹è¯•
(define (test-list-wrapper . args)
  (apply list args))

(check (test-list-wrapper 1 2 3) => '(1 2 3))
(check (test-list-wrapper 'a 'b 'c 'd) => '(a b c d))
(check (test-list-wrapper) => '())


#|
length
è¿”å›åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°ã€‚

è¯­æ³•
----
(length list)

å‚æ•°
----
list : any
ä»»æ„ç±»å‹çš„å¯¹è±¡ã€‚

è¿”å›å€¼
------
integer?
å¦‚æœlistæ˜¯åˆ—è¡¨ï¼Œè¿”å›è¯¥åˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°ã€‚
å¦‚æœå‚æ•°ä¸æ˜¯åˆ—è¡¨ï¼Œè¿”å›#fã€‚

è¯´æ˜
----
1. ç”¨äºè®¡ç®—åˆ—è¡¨çš„é•¿åº¦ï¼Œå³åˆ—è¡¨ä¸­åŒ…å«çš„å…ƒç´ ä¸ªæ•°
2. ç©ºåˆ—è¡¨'()çš„é•¿åº¦ä¸º0
3. å¯¹äºç‚¹å¯¹ç»“æ„ï¼ˆéæ­£è§„åˆ—è¡¨ï¼‰ï¼Œæ ¹æ®å®ç°è¡Œä¸ºè¿”å›ç»“æœ
4. åˆ—è¡¨å¯ä»¥æ˜¯æ™®é€šåˆ—è¡¨ã€åµŒå¥—åˆ—è¡¨æˆ–åŒ…å«ä»»æ„ç±»å‹å…ƒç´ çš„åˆ—è¡¨

é”™è¯¯å¤„ç†
--------
wrong-type-arg
å½“å‚æ•°ä¸æ˜¯åˆ—è¡¨æ—¶ï¼Œæ ¹æ®å®ç°è¿”å›ç‰¹å®šå€¼æˆ–æŠ›å‡ºé”™è¯¯ã€‚

ç¤ºä¾‹
----
(length '()) => 0
(length '(1 2 3)) => 3
(length '((a b) c d)) => 3
|#

;; length åŸºæœ¬æµ‹è¯•ï¼šç©ºåˆ—è¡¨å’Œéç©ºåˆ—è¡¨
(check (length '()) => 0)
(check (length '(a)) => 1)
(check (length '(a b)) => 2)
(check (length '(a b c)) => 3)
(check (length '(1 2 3 4 5)) => 5)

;; length åµŒå¥—åˆ—è¡¨æµ‹è¯•
(check (length '((a) b c)) => 3)
(check (length '((a b) (c d) e)) => 3)
(check (length '((a) (b) (c))) => 3)
(check (length '(((a b) c) d e)) => 3)
(check (length '((1 2 3 4) (5 6 7 8))) => 2)

;; length å¤æ‚æ•°æ®ç»“æ„æµ‹è¯•
(check (length '((first 1) (second 2) (third 3))) => 3)
(check (length '("hello" "world" "test")) => 3)
(check (length '(#t #f 'symbol)) => 3)
(check (length '(42 3.14 "string" #t)) => 4)

;; length è¾¹ç•Œæµ‹è¯•ï¼šå„ç§è§„æ¨¡åˆ—è¡¨
(check (length '(a)) => 1)
(check (length '(a b)) => 2)
(check (length '(a b c d e f g h i j)) => 10)
(check (length '(long list with many elements potentially spanning multiple lines)) => 9)

;; length ç©ºåˆ—è¡¨å’Œå•å…ƒç´ åˆ—è¡¨æµ‹è¯•
(check (length '()) => 0)
(check (length (list)) => 0)
(check (length (cons 'a '())) => 1)
(check (length '(single)) => 1)

;; length å­—ç¬¦å’Œæ•°å­—åˆ—è¡¨æµ‹è¯•
(check (length '(#\a #\b #\c #\d)) => 4)
(check (length '(0 1 2 3 4 5 6 7 8 9)) => 10)
(check (length '("zero" "one" "two" "three" "four")) => 5)

;; length åˆ—è¡¨æ„é€ å‡½æ•°æµ‹è¯•
(check (length (make-list 3 #\a)) => 3)
(check (length (make-list 0)) => 0)
(check (length (make-list 5 'value)) => 5)

;; length åˆ—è¡¨æ“ä½œå‡½æ•°ç»“æœæµ‹è¯•
(check (length (append '(1 2) '(3 4 5))) => 5)
(check (length (append '() '(a b c))) => 3)
(check (length (append '(x y) '())) => 2)
(check (length (reverse '(a b c d))) => 4)
(check (length (reverse '())) => 0)

;; length ç‰¹æ®Šæµ‹è¯•ï¼šå­—ç¬¦ä¸²å’Œå‘é‡ç­‰
(check (length "string") => 6)
(check (length '#(1 2 3)) => 3)
(check (length 123) => #f)
(check (length 3.14) => #f)
(check (length #\a) => #f)
(check (length 'symbol) => #f)

;; length ç‚¹å¯¹ç»“æ„ï¼ˆimproper listsï¼‰
(check (length '(a . b)) => -1)
(check (length (cons 1 2)) => -1)
(check (length (cons 'a 'b)) => -1)
(check (length '(a b . c)) => -2)
(check (length '(x (a) . y)) => -2)
(check (length '(a b c . d)) => -3)

;; length ç‰¹æ®Šè¾¹ç•Œæµ‹è¯•
(check (length '(())) => 1)  ; ç©ºåˆ—è¡¨ä½œä¸ºå…ƒç´ 
(check (length '(() () ())) => 3)  ; å¤šä¸ªç©ºåˆ—è¡¨ä½œä¸ºå…ƒç´ 
(check (length '(() a b 3 c)) => 5)  ; æ··åˆç©ºç»“æ„

;; length Unicodeå­—ç¬¦ä¸²åˆ—è¡¨æµ‹è¯•
(check (length '("ä¸­å›½" "ç¾å›½" "æ—¥æœ¬")) => 3)
(check (length '("hello" "ä¸–ç•Œ" "123")) => 3)

;; length ç¨‹åºæ„é€ æµ‹è¯•
(check (length (let ((lst '(a b c))) lst)) => 3)
(check (length (map square '(1 2 3 4))) => 4)
(check (length (filter symbol? '(a 1 b 2 c 3))) => 3)

;; length URLåˆ—è¡¨æµ‹è¯•
(check (length '("http://example.com" "https://test.org")) => 2)
(check (length '(user admin guest moderator)) => 4)

#|
append
åˆ›å»ºæ–°çš„åˆ—è¡¨ï¼Œå°†0ä¸ªæˆ–å¤šä¸ªåˆ—è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°åˆ—è¡¨ã€‚

è¯­æ³•
-----
(append list ...)

å‚æ•°
-----
list ... : list?
ä»»æ„æ•°é‡çš„åˆ—è¡¨ã€‚å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œè¿”å›ç©ºåˆ—è¡¨ï¼›å¦‚æœæœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¿”å›è¯¥å‚æ•°æœ¬èº«ï¼›
å¦‚æœæœ‰å¤šä¸ªå‚æ•°ï¼Œè¿”å›å°†é™¤æœ€åä¸€ä¸ªå‚æ•°å¤–æ‰€æœ‰å‚æ•°çš„å…ƒç´ å¤åˆ¶åˆ°æ–°åˆ—è¡¨åï¼Œæœ€åä¸€ä¸ªå‚æ•°æˆä¸ºæœ€åä¸€ä¸ªåˆ—è¡¨ã€‚

è¿”å›å€¼
------
list?
è¿”å›å°†æ‰€æœ‰å‚ä¸åˆ—è¡¨åˆå¹¶çš„æ–°åˆ—è¡¨ã€‚å¦‚æœæ²¡æœ‰å‚æ•°è¿”å›ç©ºåˆ—è¡¨ï¼Œå¦‚æœæœ‰å¤šä¸ªå‚æ•°åˆ™è¿”å›
deep-structureåˆå¹¶åˆ—è¡¨ï¼ˆå³å…±äº«æœ€åä¸€ä¸ªåˆ—è¡¨çš„ç»“æ„ï¼‰ã€‚

è¯´æ˜
----
1. å¯¹äºå•å‚æ•°ï¼Œappendè¿”å›è¯¥åˆ—è¡¨æœ¬èº«
2. å¯¹äºå¤šå‚æ•°ï¼Œå‰é¢çš„listä¼šè¢«å¤åˆ¶ï¼Œæœ€åä¸€ä¸ªlistè¢«å…±äº«
3. å…è®¸éåˆ—è¡¨çš„æœ€åä¸€ä¸ªå‚æ•°ï¼ˆå½¢æˆç‚¹å¯¹ç»“æ„ï¼‰ï¼Œè¿™ç§è¡Œä¸ºç¬¦åˆR7RSè§„èŒƒ
4. å¯¹äºç©ºåˆ—è¡¨å‚æ•°ï¼Œappendèµ·åˆ°å¿½ç•¥ç©ºåˆ—è¡¨çš„ä½œç”¨
5. å®é™…æ•ˆç‡ï¼šé™¤æœ€åä¸€ä¸ªå‚æ•°å¤–ï¼Œå…¶ä»–åˆ—è¡¨ä¼šè¢«å¤åˆ¶

é”™è¯¯
---
è¯¥è¡Œæ— é”™è¯¯æƒ…å†µã€‚æ‰€æœ‰å‚æ•°å¯ä»¥æ˜¯åˆ—è¡¨ï¼Œæˆ–è€…æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯éåˆ—è¡¨ã€‚
|#

;; åŸºç¡€æµ‹è¯•ç”¨ä¾‹ - ç©ºåˆ—è¡¨åˆå¹¶
(check (append '() '()) => '())
(check (append '() '() '()) => '())
(check (append '() '() '() '()) => '())
(check (append) => '())

;; å•å‚æ•°æµ‹è¯•ï¼ˆç‰¹åŒ–æƒ…å†µï¼šç›´æ¥è¿”å›åŸå‚æ•°ï¼‰
(check (append '(a b c)) => '(a b c))
(check (append '()) => '())
(check (append '(1 2 3 4 5)) => '(1 2 3 4 5))
(check (append (list 1 2 3)) => (list 1 2 3))

;; åŒåˆ—è¡¨åˆå¹¶æµ‹è¯•
(check (append '(a) '(b)) => '(a b))
(check (append '(a b) '(c d)) => '(a b c d))
(check (append '(1 2) '(3 4 5)) => '(1 2 3 4 5))
(check (append '(a b c) '(d e)) => '(a b c d e))
(check (append '() '(a b c)) => '(a b c))
(check (append '(a b c) '()) => '(a b c))

;; ä¸‰åˆ—è¡¨åˆå¹¶æµ‹è¯•
(check (append '(a) '(b) '(c)) => '(a b c))
(check (append '(1 2) '(3 4) '(5 6)) => '(1 2 3 4 5 6))
(check (append '(a b) '(c d e) '(f g)) => '(a b c d e f g))
(check (append '(x y) '(n) '(a b c)) => '(x y n a b c))

;; å¤šåˆ—è¡¨åˆå¹¶æµ‹è¯•ï¼ˆå¤æ‚æƒ…å†µï¼‰
(check (append '(a) '(b) '(c) '(d)) => '(a b c d))
(check (append '(1) '(2 3) '(4 5 6) '(7)) => '(1 2 3 4 5 6 7))
(check (append '(a) '() '(b) '() '(c)) => '(a b c))

;; å±‚æ¬¡ç»“æ„æ€§è´¨éªŒè¯æµ‹è¯•
(check (list? (append '(a) '())) => #t)
(check (list? (append '() '(a))) => #t)
(check (list? (append '(a b) '(c d))) => #t)
(check (pair? (append '(a) 'b)) => #t)  ; ç‚¹å¯¹ç»“æ„

;; é•¿åº¦éªŒè¯æµ‹è¯•
(check (length (append '() '())) => 0)
(check (length (append '(a) '())) => 1)
(check (length (append '() '(b))) => 1)
(check (length (append '(a) '(b))) => 2)
(check (length (append '(a b) '(c d))) => 4)
(check (length (append '(1 2) '(3 4 5))) => 5)
(check (length (append '(1 2 3) '(4 5 6 7))) => 7)

;; å¤æ‚åµŒå¥—ç»“æ„æµ‹è¯•
(check (append '((a b) (c d)) '(e f)) => '((a b) (c d) e f))
(check (append '(a b) '((c d) (e f))) => '(a b (c d) (e f)))
(check (append '((a) (b)) '((c) (d))) => '((a) (b) (c) (d)))
(check (append '((a b) c) '(d (e f))) => '((a b) c d (e f)))

;; æ·±å±‚æ¬¡ç»“æ„æµ‹è¯•
(check (append '(1 (2 (3))) '(((4) 5) 6)) => '(1 (2 (3)) ((4) 5) 6))
(check (append '(a (b (c))) '(d (e (f)))) => '(a (b (c)) d (e (f))))
(check (append '(() a ()) '(b)) => '(() a () b))

;; ç‚¹å¯¹ç»“æ„æµ‹è¯•ï¼ˆæ ¸å¿ƒç‰¹æ€§ï¼‰
(check (append '(a b) 'c) => '(a b . c))
(check (append '(a) 'b) => '(a . b))
(check (append '(a b c) 'd) => '(a b c . d))
(check (append '(a b) '(c d) 'e) => '(a b c d . e))
(check (append '() 'a) => 'a)
(check (append '(a) '() 'b) => '(a . b))

;; å¤æ‚ç‚¹å¯¹ç»“æ„æµ‹è¯•
(check (append '((a) b) 'c) => '((a) b . c))
(check (append '(1 2 3) '(a . b)) => '(1 2 3 a . b))
(check (append '(a (b (c))) 'd) => '(a (b (c)) . d))
(check (append '(a b) '((c d) . e)) => '(a b (c d) . e))

;; åå‘è¿æ¥æµ‹è¯•ï¼ˆéªŒè¯æ–¹å‘æ€§ï¼‰
(check (append '(z y x) '(c b a)) => '(z y x c b a))
(check (append '(3 2 1) '(0 -1 -2)) => '(3 2 1 0 -1 -2))

;; å¤§è§„æ¨¡åˆå¹¶æµ‹è¯•
(check (length (append '(1 2 3 4 5))) => 5)
(check (length (append '(1 2 3) '(4 5 6))) => 6)
(check (length (append '(1 2) '(3 4) '(5 6))) => 6)

;; å­—ç¬¦åˆ—è¡¨æµ‹è¯•
(check (append '(#\t #\e) '(#\s #\t)) => '(#\t #\e #\s #\t))
(check (append '(#\t) '(#\t) '(#\n)) => '(#\t #\t #\n))

;; å­—ç¬¦ä¸²åˆ—è¡¨æµ‹è¯•ï¼ˆå¤åˆæ•°æ®ç±»å‹ï¼‰
(check (append '("hello") '("world")) => '("hello" "world"))
(check (append '("a" "b") '("c" "d" "e")) => '("a" "b" "c" "d" "e"))
(check (append '("ä¸­æ–‡" "æµ‹è¯•") '("ç»§ç»­")) => '("ä¸­æ–‡" "æµ‹è¯•" "ç»§ç»­"))

;; ç¬¦å·åˆ—è¡¨æµ‹è¯•
(check (append '(a b c) '(d e f)) => '(a b c d e f))
(check (append '(quote define) '(lambda procedure)) => '(quote define lambda procedure))
(check (append '(if cond) '(else)) => '(if cond else))

;; æ··åˆæ•°æ®ç±»å‹æµ‹è¯•
(check (append '(1 "hello" #t) '(2 "world" #f)) => '(1 "hello" #t 2 "world" #f))
(check (append '(a 1 "test" #\x) '(b 2 c)) => '(a 1 "test" #\x b 2 c))
(check (append '(1.0 2.5) '(3.5 4.0)) => '(1.0 2.5 3.5 4.0))

;; æ•°å­—åˆ—è¡¨æµ‹è¯•
(check (append '(1 2 3 4) '(5 6 7 8)) => '(1 2 3 4 5 6 7 8))
(check (append '(1 2 3) '(a b c)) => '(1 2 3 a b c))

;; booleanåˆ—è¡¨æµ‹è¯•
(check (append '(#t #f) '(#t #f)) => '(#t #f #t #f))
(check (append '(#true) '(#false #t)) => '(#true #false #t))

;; éªŒè¯ä½¿ç”¨listæ„é€ å‡½æ•°
(check (append (list 1 2) (list 3 4)) => '(1 2 3 4))
(check (append (list 'a 'b) (list 'c 'd)) => '(a b c d))
(check (append (list) (list 'x 'y)) => '(x y))

;; è¾¹ç•Œæµ‹è¯•
(check (append '() '() '(a) '() '(b)) => '(a b))
(check (append '(a) '() '(b) '() '(c)) => '(a b c))
(check (append '(a) '(b) '() '(c) '(d)) => '(a b c d))

;; é“¾å¼æ“ä½œéªŒè¯æµ‹è¯•
(check (append (append '(1) '(2)) '(3)) => '(1 2 3))
(check (append '(1) (append '(2) '(3))) => '(1 2 3))
(check (append (append '(a b) '(c)) '(d e)) => '(a b c d e))

;; ç»“æ„å¯¹ç­‰æ€§éªŒè¯ï¼ˆé€šè¿‡elementsæ£€æŸ¥ï¼‰
(check (equal? (append '(1 2 3) '(4 5)) '(1 2 3 4 5)) => #t)
(check (equal? (append '(a) '(b) '(c d)) '(a b c d)) => #t)
(check (equal? (append '() '(first second) '()) '(first second)) => #t)

;; å‡½æ•°ç»“æœä½œä¸ºappendå‚æ•°æµ‹è¯•
(check (append (map (lambda (x) (* x 2)) '(1 2 3)) '(7 8 9)) => '(2 4 6 7 8 9))
(check (append (filter (lambda (x) (> x 2)) '(1 2 3 4)) '(5 6 7)) => '(3 4 5 6 7))

;; éªŒè¯ç»“æ„å…±äº«æ€§ï¼ˆéå¤åˆ¶æ€§æµ‹è¯•ï¼‰
(let ((lst-last '(last list)))
  (let ((result (append '(copy list) lst-last)))
    (check (equal? result '(copy list last list)) => #t)
    (check (eq? (cdr (cdr result)) lst-last) => #t)))  ; éªŒè¯ç»“æ„å…±äº«

;; ç©ºåˆ—è¡¨å’Œå¤æ‚ç»“æ„ç»„åˆæµ‹è¯•
(check (append '() '(a (b c) d) '()) => '(a (b c) d))
(check (append '((a b) c) '() '(d)) => '((a b) c d))

;; æ·±åº¦éªŒè¯æµ‹è¯•ï¼ˆç¡®ä¿appendæ­£ç¡®æ€§ï¼‰
(check (length (append '(a b c d) '(e f g h))) => 8)
(check (length (append '(1 2) '(3 4) '(5 6) '(7 8))) => 8)
(check (list-ref (append '(1 2 3) '(4 5 6)) 5) => 6)
(check (list-ref (append '(1) '(2 3 4)) 3) => 4)


#|
reverse
è¿”å›ä¸€ä¸ªæ–°åˆ—è¡¨ï¼ŒåŒ…å«åŸå§‹åˆ—è¡¨ä¸­çš„å…ƒç´ ä½†é¡ºåºç›¸åã€‚

è¯­æ³•
----
(reverse list)

å‚æ•°
----
list : list?
    è¦åè½¬çš„åˆ—è¡¨ã€‚

è¿”å›å€¼
------
list?
    åŒ…å«åŸå§‹åˆ—è¡¨å…ƒç´ çš„åè½¬é¡ºåºæ–°åˆ—è¡¨ã€‚

è¯´æ˜
----
1. è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œå…ƒç´ é¡ºåºä¸åŸå§‹åˆ—è¡¨ç›¸å
2. é€‚ç”¨äºæ‰€æœ‰ç±»å‹çš„åˆ—è¡¨ï¼šç©ºåˆ—è¡¨ã€éç©ºåˆ—è¡¨ã€åµŒå¥—åˆ—è¡¨
3. ä¸ä¼šæ”¹å˜åŸå§‹åˆ—è¡¨çš„å†…å®¹
4. å¯¹åˆ—è¡¨ä¸­çš„å…ƒç´ ç±»å‹æ²¡æœ‰é™åˆ¶
5. å½“å‚æ•°æ˜¯éåˆ—è¡¨æ—¶ï¼Œè¡Œä¸ºä¾èµ–äºå…·ä½“å®ç°

é”™è¯¯å¤„ç†
--------
ä¾èµ–å…·ä½“å®ç°è¡Œä¸º
|#

(check (reverse '()) => '())
(check (reverse '(a)) => '(a))
(check (reverse '(a b)) => '(b a))
(check (reverse '(a b c)) => '(c b a))
(check (reverse '(1 2 3 4 5)) => '(5 4 3 2 1))
(check (reverse '(x y z)) => '(z y x))

;; æµ‹è¯•ç©ºåˆ—è¡¨
(check (reverse '()) => '())
(check (equal? (reverse '()) '()) => #t)

;; æµ‹è¯•å•å…ƒç´ åˆ—è¡¨
(check (reverse '(a)) => '(a))
(check (reverse '(1)) => '(1))
(check (reverse '("hello")) => '("hello"))
(check (reverse '(#t)) => '(#t))

;; æµ‹è¯•åŒå…ƒç´ åˆ—è¡¨
(check (reverse '(a b)) => '(b a))
(check (reverse '(1 2)) => '(2 1))
(check (reverse '("first" "second")) => '("second" "first"))
(check (reverse '(#t #f)) => '(#f #t))

;; æµ‹è¯•ä¸‰å…ƒç´ åˆ—è¡¨
(check (reverse '(a b c)) => '(c b a))
(check (reverse '(1 2 3)) => '(3 2 1))
(check (reverse '("A" "B" "C")) => '("C" "B" "A"))

;; æµ‹è¯•é•¿åˆ—è¡¨
(check (reverse '(1 2 3 4 5 6 7 8 9 10)) => '(10 9 8 7 6 5 4 3 2 1))
(check (reverse '(a b c d e f g h i j)) => '(j i h g f e d c b a))

;; æµ‹è¯•åµŒå¥—åˆ—è¡¨
(check (reverse '((a b) (c d) (e f))) => '((e f) (c d) (a b)))
(check (reverse '((1 (2 3)) 4 (5 6))) => '((5 6) 4 (1 (2 3))))
(check (reverse '("apple" ("banana" "cherry") "date")) => '("date" ("banana" "cherry") "apple"))

;; æµ‹è¯•æ··åˆç±»å‹åˆ—è¡¨
(check (reverse '(1 "two" #t 4.5 symbol)) => '(symbol 4.5 #t "two" 1))
(check (reverse '(#\newline "string" 42 #t)) => '(#t 42 "string" #\newline))

;; æµ‹è¯•ç‰¹æ®Šå…ƒç´ 
(check (reverse '(#\tab #\newline #\space)) => '(#\space #\newline #\tab))

;; æµ‹è¯•ç”±æ„é€ å‡½æ•°åˆ›å»ºçš„åˆ—è¡¨
(check (reverse (list 1 2 3 4 5)) => '(5 4 3 2 1))
(check (reverse (cons 'a (cons 'b (cons 'c '())))) => '(c b a))

;; æµ‹è¯•å¤æ‚åµŒå¥—ç»“æ„
(check (reverse '((a . b) (c . d) (e . f))) => '((e . f) (c . d) (a . b)))
(check (reverse '(a (b) (c (d)))) => '((c (d)) (b) a))

;; æµ‹è¯•åˆ—è¡¨æ“ä½œç»“æœ
(let ((lst (list 1 2 3 4 5)))
  (check (reverse (reverse lst)) => lst))

;; æµ‹è¯•åˆ—è¡¨ç»“æ„ä¿æŒ
(check (reverse '(a . (b . (c . ())))) => '(c b a))

;; æµ‹è¯•åŒ…å«ç©ºåˆ—è¡¨çš„æƒ…å†µ
(check (reverse '(() (a) ())) => '(() (a) ()))

;; éªŒè¯åˆ—è¡¨åè½¬çš„æ­£ç¡®æ€§
(check (equal? (reverse '(1 2 3)) '(3 2 1)) => #t)
(check (equal? (reverse '("hello" "world")) '("world" "hello")) => #t)

;; æµ‹è¯•è¾¹ç•Œæƒ…å†µ
(check (reverse (list)) => '())
(check (reverse (cons 'a '())) => '(a))

;; ç‰¹æ®Šå­—ç¬¦æµ‹è¯•
(check (reverse '(\u4E2D\u6587 \u5B57\u7B26)) => '(\u5B57\u7B26 \u4E2D\u6587))
(check (reverse '("foo" "bar" "baz" "" "qux")) => '("qux" "" "baz" "bar" "foo"))

;; é•¿åˆ—è¡¨æµ‹è¯•
(check (reverse (map (lambda (x) (* x x)) '(1 2 3 4 5))) => '(25 16 9 4 1))
(check (reverse (filter even? '(1 2 3 4 5 6 7 8))) => '(8 6 4 2))

#|
list-tail
è¿”å›åˆ—è¡¨ä»æŒ‡å®šç´¢å¼•ä½ç½®å¼€å§‹çš„å­åˆ—è¡¨ã€‚è¯¥å‡½æ•°æ˜¯R7RSæ ‡å‡†çš„åŸºæœ¬åˆ—è¡¨æ“ä½œå‡½æ•°ä¹‹ä¸€ã€‚

è¯­æ³•
----
(list-tail list k)

å‚æ•°
----
list : pair?
    éç©ºåˆ—è¡¨æˆ–ç‚¹ç»“æ„ã€‚å¯ä»¥æ˜¯æ™®é€šåˆ—è¡¨ã€åµŒå¥—åˆ—è¡¨ã€ç‚¹å¯¹ç»“æ„æˆ–åŒ…å«ä»»æ„ç±»å‹å…ƒç´ çš„åˆ—è¡¨ã€‚
    ç©ºåˆ—è¡¨ '() ä½œä¸ºå‚æ•°å°†æ ¹æ®ç´¢å¼•å€¼äº§ç”Ÿä¸åŒçš„å¼‚å¸¸ã€‚

k : exact?
    éè´Ÿçš„ç²¾ç¡®æ•´æ•°ï¼Œè¡¨ç¤ºå¼€å§‹æˆªå–å­åˆ—è¡¨çš„èµ·å§‹ç´¢å¼•ä½ç½®ã€‚
    å¿…é¡»æ»¡è¶³ 0 <= k <= (length list)ã€‚

è¿”å›å€¼
------
list?
    ä»åˆ—è¡¨ç¬¬kä¸ªå…ƒç´ ï¼ˆç´¢å¼•ä»0å¼€å§‹ï¼‰å¼€å§‹ç›´åˆ°åˆ—è¡¨æœ«å°¾çš„å­åˆ—è¡¨ã€‚
    å½“ k = 0 æ—¶è¿”å›æ•´ä¸ªåŸåˆ—è¡¨ã€‚
    å½“ k = length(list) æ—¶è¿”å›ç©ºåˆ—è¡¨ '()ã€‚

è¯´æ˜
----
1. list-tailè¿”å›ä»åˆ—è¡¨indexä½ç½®å¼€å§‹çš„å°¾éƒ¨å­åˆ—è¡¨
2. é€‚ç”¨äºæ‰€æœ‰ç±»å‹çš„åˆ—è¡¨ç»“æ„ï¼šæ™®é€šåˆ—è¡¨ã€åµŒå¥—åˆ—è¡¨ã€ç‚¹å¯¹ç»“æ„
3. ç´¢å¼•ä»0å¼€å§‹è®¡æ•°ï¼Œä¸list-refç­‰å…¶ä»–åˆ—è¡¨å‡½æ•°ä¿æŒä¸€è‡´
4. ä¸ä¼šä¿®æ”¹åŸå§‹åˆ—è¡¨ï¼Œå§‹ç»ˆè¿”å›æ–°çš„åˆ—è¡¨ç»“æ„
5. å¯ä»¥æ­£ç¡®å¤„ç†åµŒå¥—ç»“æ„å’Œå¤æ‚æ•°æ®ç»“æ„

è¾¹ç•Œæ¡ä»¶
--------
- k = 0: è¿”å›åŸåˆ—è¡¨æœ¬èº«
- k = length(list): è¿”å›ç©ºåˆ—è¡¨ '()
- k > length(list): æŠ›å‡ºout-of-rangeå¼‚å¸¸
- k < 0: æŠ›å‡ºout-of-rangeå¼‚å¸¸
- ç©ºåˆ—è¡¨å‚æ•°ï¼šé™¤k=0å¤–éƒ½éœ€æŠ›å‡ºå¼‚å¸¸
- ç‚¹å¯¹ç»“æ„ï¼šæ­£ç¡®å¤„ç†éæ­£è§„åˆ—è¡¨

æ€§èƒ½ç‰¹å¾
--------
- æ—¶é—´å¤æ‚åº¦ï¼šO(k)ï¼Œéœ€è¦éå†å‰kä¸ªå…ƒç´ 
- ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œç»“æœä¸åŸå§‹åˆ—è¡¨å…±äº«å°¾éƒ¨ç»“æ„
- å†…å­˜åˆ†é…ï¼šä¸åˆ›å»ºæ–°å¯¹è±¡ï¼Œç›´æ¥å…±äº«åŸå§‹ç»“æ„
- å¯¹äºé•¿åˆ—è¡¨ï¼Œæ€§èƒ½ä¸ç´¢å¼•ä½ç½®æˆæ­£æ¯”

æ•°æ®ç±»å‹å…¼å®¹æ€§
---------------
- æ”¯æŒä»»æ„ç±»å‹çš„åˆ—è¡¨å…ƒç´ ï¼šæ•°å­—ã€å­—ç¬¦ä¸²ã€å­—ç¬¦ã€ç¬¦å·ã€å¸ƒå°”å€¼ã€è¿‡ç¨‹ç­‰
- æ”¯æŒåµŒå¥—åˆ—è¡¨å’Œå¤šå±‚æ¬¡ç»“æ„
- æ”¯æŒç‚¹å¯¹ç»“æ„å’Œéæ­£è§„åˆ—è¡¨(dotted lists)
- æ”¯æŒç©ºåˆ—è¡¨ã€å•å…ƒç´ åˆ—è¡¨ã€é•¿åˆ—è¡¨

é”™è¯¯å¤„ç†
--------
out-of-range
    å½“ç´¢å¼•kä¸ºè´Ÿæ•°æˆ–è¶…å‡ºåˆ—è¡¨é•¿åº¦æ—¶æŠ›å‡ºé”™è¯¯ã€‚
wrong-type-arg
    å½“listå‚æ•°ä¸æ˜¯åˆ—è¡¨ç±»å‹æ—¶æŠ›å‡ºé”™è¯¯ã€‚

ç¤ºä¾‹
----
(list-tail '(a b c d) 0) => '(a b c d)
(list-tail '(a b c d) 2) => '(c d)
(list-tail '(a b c d) 4) => '()
(list-tail '((a b) (c d) (e f)) 1) => '((c d) (e f))
|#

;; list-tail åŸºæœ¬åŠŸèƒ½æµ‹è¯•
(check (list-tail '(a b c d) 0) => '(a b c d))
(check (list-tail '(a b c d) 1) => '(b c d))
(check (list-tail '(a b c d) 2) => '(c d))
(check (list-tail '(a b c d) 3) => '(d))
(check (list-tail '(a b c d) 4) => '())

;; è¾¹ç•Œå€¼æµ‹è¯•
(check (list-tail '(single) 0) => '(single))
(check (list-tail '(single) 1) => '())
(check (list-tail '() 0) => '())

;; å„ç§æ•°æ®ç±»å‹è¾¹ç•Œæµ‹è¯•
(check (list-tail '(42 "text" #t 'symbol) 1) => '("text" #t 'symbol))
(check (list-tail '(#	 #
 #
) 0) => '(#	 #
 #
))
(check (list-tail '(#	 #
 #
) 2) => '(#
))
(check (list-tail '(#	 #
 #
) 3) => '())

;; å­åˆ—è¡¨åŒ…å«åµŒå¥—ç»“æ„æµ‹è¯•
(check (list-tail '((a b) (c d) (e f)) 0) => '((a b) (c d) (e f)))
(check (list-tail '((a b) (c d) (e f)) 1) => '((c d) (e f)))
(check (list-tail '((a b) (c d) (e f)) 2) => '((e f)))
(check (list-tail '((a b) (c d) (e f)) 3) => '())

;; å¤æ‚æ•°æ®ç»“æ„æµ‹è¯•
(check (list-tail '(() a b 3 c) 1) => '(a b 3 c))
(check (list-tail '(#(1 2) 'symbol "string" 3.14) 1) => '('symbol "string" 3.14))
(check (list-tail '(1 "hello" (nested list) #t 3.14) 2) => '((nested list) #t 3.14))

;; é•¿åˆ—è¡¨æ€§èƒ½æµ‹è¯•
(check (list-tail '(1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20) 15) => '(16 17 18 19 20))
(check (list-tail '(1 2 3 4 5 6 7 8 9 10) 10) => '())
(check (list-tail '(1 2 3 4 5 6 7 8 9 10) 0) => '(1 2 3 4 5 6 7 8 9 10))
(check (list-tail '(a b c d e f g h i j k l m n o p q r s t) 0) => '(a b c d e f g h i j k l m n o p q r s t))

;; åˆ—è¡¨ä¸ç‚¹å¯¹ç»“æ„æµ‹è¯•
(check (list-tail '(a . (b . (c . ()))) 0) => '(a b c))
(check (list-tail '(a . (b . (c . ()))) 1) => '(b c))
(check (list-tail '(a . (b . (c . ()))) 2) => '(c))
(check (list-tail '(a . (b . (c . ()))) 3) => '())

;; å­—ç¬¦ä¸²åˆ—è¡¨æµ‹è¯•
(check (list-tail '("hello" "world" "test") 1) => '("world" "test"))
(check (list-tail '("first" "second" "third" "fourth") 3) => '("fourth"))

;; ç¬¦å·åˆ—è¡¨æµ‹è¯•
(check (list-tail '(define lambda if cond else) 2) => '(if cond else))
(check (list-tail '(car cdr cons list) 4) => '())

;; æ•°å€¼åˆ—è¡¨æµ‹è¯•
(check (list-tail '(1 2 3 4 5) 1) => '(2 3 4 5))
(check (list-tail '(1 2 3 4 5) 3) => '(4 5))
(check (list-tail '(1 2 3 4 5) 5) => '())
(check (list-tail '(1.5 2.5 3.5 4.5) 2) => '(3.5 4.5))

;; Unicodeå­—ç¬¦ä¸²åˆ—è¡¨æµ‹è¯•
(check (list-tail '("ä¸­æ–‡" "ç¾å›½" "æ—¥æœ¬" "éŸ©å›½") 2) => '("æ—¥æœ¬" "éŸ©å›½"))
(check (list-tail '("æµ‹è¯•" "éªŒè¯" "è°ƒè¯•") 0) => '("æµ‹è¯•" "éªŒè¯" "è°ƒè¯•"))

;; æ„é€ å™¨å‡½æ•°ç»“æœæµ‹è¯•
(check (list-tail (list 1 2 3 4 5) 2) => '(3 4 5))
(check (list-tail (append '(1 2) '(3 4 5)) 3) => '(4 5))
(check (list-tail (reverse '(5 4 3 2 1)) 2) => '(3 4 5))

;; é”™è¯¯å‚æ•°æµ‹è¯•
(check-catch 'wrong-type-arg (list-tail 123 0))
(check-catch 'wrong-type-arg (list-tail "string" 1))
(check-catch 'wrong-type-arg (list-tail #t 0))

;; ç´¢å¼•è¶Šç•Œæµ‹è¯•
(check-catch 'out-of-range (list-tail '(a b c) -1))
(check-catch 'out-of-range (list-tail '(a b c) 4))
(check-catch 'out-of-range (list-tail '(a) 2))
(check-catch 'out-of-range (list-tail '() 1))
(check-catch 'out-of-range (list-tail '(single) 2))

;; å‚æ•°é”™è¯¯æµ‹è¯•
(check-catch 'wrong-number-of-args (list-tail))
(check-catch 'wrong-number-of-args (list-tail '(a b c)))
(check-catch 'wrong-number-of-args (list-tail '(a b c) 1 2))
(check-catch 'wrong-number-of-args (list-tail '(a b c) 1 2 3))

#|
list-ref
è·å–åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚è¯¥å‡½æ•°æ˜¯R7RSæ ‡å‡†çš„åŸºæœ¬åˆ—è¡¨æ“ä½œå‡½æ•°ä¹‹ä¸€ã€‚

è¯­æ³•
----
(list-ref list k)

å‚æ•°
----
list : pair?
    éç©ºçš„åˆ—è¡¨æˆ–ç‚¹å¯¹ç»“æ„ã€‚ç©ºåˆ—è¡¨ '() ä¸è¢«æ¥å—ã€‚

k : exact?
    éè´Ÿçš„ç²¾ç¡®æ•´æ•°ï¼Œè¡¨ç¤ºè¦è·å–çš„å…ƒç´ çš„ç´¢å¼•ä½ç½®ã€‚ç´¢å¼•ä»0å¼€å§‹ã€‚
    å¿…é¡»æ»¡è¶³ 0 <= k < (length list)ã€‚

è¿”å›å€¼
------
ä»»æ„ç±»å‹
    è¿”å›åˆ—è¡¨ä¸­ä½ç½®kå¤„çš„å…ƒç´ ã€‚ç±»å‹å–å†³äºåˆ—è¡¨ä¸­å®é™…å­˜å‚¨çš„å¯¹è±¡ï¼Œ
    å¯ä»¥æ˜¯ç¬¦å·ã€æ•°å­—ã€å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€ç‚¹å¯¹æˆ–ä»»ä½•å…¶ä»–Schemeå¯¹è±¡ã€‚

è¯´æ˜
----
1. ç´¢å¼•ä»0å¼€å§‹ï¼Œå³(list-ref '(a b c) 0)è¿”å›'a
2. é€‚ç”¨äºæ‰€æœ‰éç©ºåˆ—è¡¨ï¼šåŒ…æ‹¬æ™®é€šåˆ—è¡¨ã€improperåˆ—è¡¨å’ŒåµŒå¥—ç»“æ„
3. å½“ç”¨äºç‚¹å¯¹ç»“æ„æ—¶ï¼Œåªèƒ½è®¿é—®0å’Œ1ä½ç½®ï¼ˆcarå’Œcdréƒ¨åˆ†ï¼‰
4. ç”¨äºåµŒå¥—ç»“æ„æ—¶ï¼Œå¯ä»¥è®¿é—®å¤æ‚åˆ—è¡¨çš„ä»»æ„åˆ†å±‚ç»“æ„

ç¤ºä¾‹
----
(list-ref '(a b c d e) 0) => 'a
(list-ref '(a b c d e) 4) => 'e
(list-ref '(1 2 3 4) 2) => 3

é”™è¯¯å¤„ç†
--------
wrong-type-arg
    å½“listå‚æ•°ä¸æ˜¯pair?ç±»å‹ï¼ˆå¦‚ç©ºåˆ—è¡¨'()ã€æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ï¼‰æ—¶æŠ›å‡ºé”™è¯¯ã€‚

out-of-range
    å½“ç´¢å¼•kä¸ºè´Ÿæ•°æˆ–è¶…å‡ºåˆ—è¡¨æœ‰æ•ˆèŒƒå›´ï¼ˆk >= é•¿åº¦ï¼‰æ—¶æŠ›å‡ºé”™è¯¯ã€‚
|#

;; åŸºç¡€æµ‹è¯•ï¼šæ™®é€šåˆ—è¡¨ç´¢å¼•è®¿é—®
(check (list-ref '(a b c d e) 0) => 'a)
(check (list-ref '(a b c d e) 1) => 'b)
(check (list-ref '(a b c d e) 4) => 'e)
(check (list-ref '(1 2 3 4 5) 0) => 1)
(check (list-ref '(1 2 3 4 5) 2) => 3)
(check (list-ref '(1 2 3 4 5) 4) => 5)

;; è¾¹ç•Œå€¼æµ‹è¯•ï¼šç´¢å¼•0ã€ä¸­é—´å€¼ã€æœ€å¤§å€¼
(check (list-ref '(single) 0) => 'single)
(check (list-ref '(x y z) 1) => 'y)
(check (list-ref '(first last) 1) => 'last)

;; å¤æ‚æ•°æ®ç±»å‹æµ‹è¯•ï¼šåŒ…å«å„ç§ç±»å‹å…ƒç´ 
(check (list-ref '("string" 42 #t symbol) 0) => "string")
(check (list-ref '("string" 42 #t symbol) 1) => 42)
(check (list-ref '("string" 42 #t symbol) 2) => #t)
(check (list-ref '("string" 42 #t symbol) 3) => 'symbol)

;; åµŒå¥—åˆ—è¡¨æµ‹è¯•ï¼šè®¿é—®åµŒå¥—ç»“æ„
(check (list-ref '((1 2 3) (4 5 6) (7 8 9)) 0) => '(1 2 3))
(check (list-ref '("hel" "lo" "wo" "rld") 2) => "wo")
(check (list-ref '(((a b) c d) e f) 0) => '((a b) c d))

;; æµ‹è¯•ç‚¹å¯¹ç»“æ„ï¼šç®€å•ç‚¹å¯¹
(check (list-ref '(a . b) 0) => 'a)
(check (list-ref (cons 'a 'b) 0) => 'a)

;; improperåˆ—è¡¨æµ‹è¯•ï¼šåŒ…å«ç‚¹å¯¹ç»“æ„çš„åˆ—è¡¨
(check (list-ref '(a b c . d) 0) => 'a)
(check (list-ref '(a b c . d) 1) => 'b)
(check (list-ref '(a b c . d) 2) => 'c)

;; å¤æ‚åµŒå¥—ç»“æ„æµ‹è¯•ï¼šæ·±å±‚åµŒå¥—
(check (list-ref '((a b) (c d) (e f)) 1) => '(c d))
(check (list-ref '((1 2) 3 4 5) 0) => '(1 2))
(check (list-ref '((1 2) 3 4 5) 3) => 5)

;; ç®€å•ç‚¹å¯¹é‡æ–°æµ‹è¯•
(check (list-ref (cons '(1 2) '(3 4)) 1) => 3)

;; åŸºç¡€ä¸‰å…ƒåˆ—è¡¨
(check (list-ref '(a b c) 0) => 'a)
(check (list-ref '(a b c) 1) => 'b)
(check (list-ref '(a b c) 2) => 'c)

;; é”™è¯¯æƒ…å†µæµ‹è¯•
(check-catch 'wrong-type-arg (list-ref '() 0))
(check-catch 'wrong-type-arg (list-ref 123 0))
(check-catch 'wrong-type-arg (list-ref "string" 1))
(check-catch 'wrong-type-arg (list-ref #t 1))

;; ç´¢å¼•è¶Šç•Œæµ‹è¯•
(check-catch 'out-of-range (list-ref '(a b c) -1))
(check-catch 'out-of-range (list-ref '(a b c) 3))
(check-catch 'out-of-range (list-ref '(x) 1))
(check-catch 'out-of-range (list-ref '(a b c d e) 5))
(check-catch 'out-of-range (list-ref '(single) 2))

;; æ„é€ å™¨å‡½æ•°åˆ›å»ºçš„åˆ—è¡¨æµ‹è¯•
(check (list-ref (list 1 2 3 4) 2) => 3)
(check (list-ref (cons 1 (cons 2 (cons 3 '()))) 1) => 2)
(check (list-ref (append '(1 2) '(3 4 5)) 3) => 4)

;; é™„åŠ çš„åˆ—è¡¨æ“ä½œåœºæ™¯æµ‹è¯•
(check (list-ref '(apple banana cherry date elderberry) 2) => 'cherry)
(check (list-ref (list 'symbol 42 #t "string" 3.14) 3) => "string")

#|
list-set!
ä¿®æ”¹åˆ—è¡¨æŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ å€¼ã€‚è¯¥å‡½æ•°ä¼šç›´æ¥ä¿®æ”¹åŸå§‹åˆ—è¡¨å¯¹è±¡ï¼Œæ˜¯R7RSæ ‡å‡†çš„åŸºæœ¬åˆ—è¡¨æ“ä½œå‡½æ•°ä¹‹ä¸€ã€‚

è¯­æ³•
----
(list-set! list k obj)

å‚æ•°
----
list : pair?
    è¦è¢«ä¿®æ”¹çš„åˆ—è¡¨å¯¹è±¡ã€‚å¯ä»¥æ˜¯æ™®é€šåˆ—è¡¨ã€åµŒå¥—åˆ—è¡¨æˆ–ç‚¹å¯¹ç»“æ„ã€‚
    å¿…é¡»æ˜¯å¯ä¿®æ”¹çš„pairç±»å‹å¯¹è±¡ï¼Œä¸èƒ½æ˜¯ç©ºåˆ—è¡¨æˆ–å…¶ä»–åŸå­ç±»å‹ã€‚

k : exact?
    éè´Ÿçš„ç²¾ç¡®æ•´æ•°ï¼Œè¡¨ç¤ºè¦ä¿®æ”¹çš„å…ƒç´ ç´¢å¼•ä½ç½®ã€‚ç´¢å¼•ä»0å¼€å§‹ã€‚
    å¿…é¡»æ»¡è¶³ 0 <= k < (length list)ã€‚

obj : any
    è¦è®¾ç½®çš„æ–°å€¼ï¼Œå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„Schemeå¯¹è±¡ï¼ŒåŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²ã€ç¬¦å·ã€å¸ƒå°”å€¼ã€è¿‡ç¨‹ç­‰ã€‚

è¿”å›å€¼
------
unspecified
    æ ¹æ®R7RSè§„èŒƒï¼Œè¿”å›æœªæŒ‡å®šçš„å€¼ã€‚

è¯´æ˜
----
1. è¿™æ˜¯ä¸€ä¸ªå˜å¼‚æ“ä½œï¼Œä¼šç›´æ¥ä¿®æ”¹åŸå§‹åˆ—è¡¨å¯¹è±¡çš„å†…å­˜å†…å®¹
2. ç´¢å¼•ä»0å¼€å§‹è®¡æ•°ï¼Œä¸list-refç­‰å…¶ä»–åˆ—è¡¨å‡½æ•°ä¿æŒä¸€è‡´
3. ä¿®æ”¹ååŸå§‹å¯¹è±¡çš„å¼•ç”¨ä»ç„¶æŒ‡å‘åŒä¸€ä¸ªå†…å­˜ä½ç½®
4. é€‚ç”¨äºæ‰€æœ‰å¯ä¿®æ”¹çš„åˆ—è¡¨ç»“æ„ï¼šæ™®é€šåˆ—è¡¨ã€åµŒå¥—åˆ—è¡¨ã€ç‚¹å¯¹ç»“æ„
5. ä¸ä¼šå½±å“åˆ—è¡¨å…¶ä»–å…ƒç´ çš„ä½ç½®æˆ–ç»“æ„

è¾¹ç•Œæ¡ä»¶
--------
- k = 0: ä¿®æ”¹åˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ 
- k = list.length - 1: ä¿®æ”¹åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ 
- k < 0: æŠ›å‡ºout-of-rangeå¼‚å¸¸
- k >= list.length: æŠ›å‡ºout-of-rangeå¼‚å¸¸
- ç©ºåˆ—è¡¨å‚æ•°ï¼šæŠ›å‡ºwrong-type-argå¼‚å¸¸
- éåˆ—è¡¨å‚æ•°ï¼šæŠ›å‡ºwrong-type-argå¼‚å¸¸

æ€§èƒ½ç‰¹å¾
--------
- æ—¶é—´å¤æ‚åº¦ï¼šO(k)ï¼Œéœ€è¦éå†å‰kä¸ªå…ƒç´ 
- ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œä¸æ¶ˆè€—é¢å¤–å†…å­˜
- å†…å­˜åˆ†é…ï¼šæ— é¢å¤–å†…å­˜åˆ†é…ï¼Œç›´æ¥ä¿®æ”¹åŸå§‹ç»“æ„
- å½±å“èŒƒå›´ï¼šä»…ä¿®æ”¹æŒ‡å®šä½ç½®çš„å…ƒç´ å€¼ï¼Œä¸å½±å“åˆ—è¡¨ç»“æ„

æ•°æ®ç±»å‹å…¼å®¹æ€§
---------------
- æ”¯æŒä»»æ„ç±»å‹çš„åˆ—è¡¨å…ƒç´ æ›¿æ¢ï¼š
  - åŸºæœ¬ç±»å‹ï¼šæ•°å­—ã€å­—ç¬¦ä¸²ã€å­—ç¬¦ã€ç¬¦å·ã€å¸ƒå°”å€¼
  - å¤æ‚ç±»å‹ï¼šåˆ—è¡¨ã€ç‚¹å¯¹ç»“æ„ã€å‘é‡ã€è¿‡ç¨‹
  - ç‰¹æ®Šç±»å‹ï¼šç©ºåˆ—è¡¨ã€åµŒå¥—ç»“æ„ã€lambdaæ„é€ å™¨
- æ”¯æŒæ·±åº¦åµŒå¥—åˆ—è¡¨çš„ç»“æ„ä¿®æ”¹

é”™è¯¯å¤„ç†
--------
wrong-type-arg
    å½“listå‚æ•°ä¸æ˜¯pair?ç±»å‹æˆ–å‚æ•°æ•°é‡é”™è¯¯æ—¶æŠ›å‡ºã€‚
out-of-range
    å½“ç´¢å¼•kä¸ºè´Ÿæ•°ã€è¶…å‡ºåˆ—è¡¨é•¿åº¦æˆ–å‚æ•°ç±»å‹é”™è¯¯æ—¶æŠ›å‡ºã€‚

å½±å“èŒƒå›´
--------
- è¯¥æ“ä½œä¼šç›´æ¥å½±å“ä½¿ç”¨åŒä¸€å¼•ç”¨çš„æ‰€æœ‰ä»£ç ä½ç½®
- ä¿®æ”¹ååŸå§‹å¯¹è±¡çš„å†…å®¹ç«‹å³å‘ç”Ÿå˜åŒ–
- åˆ—è¡¨é•¿åº¦å’Œç»“æ„ä¿æŒä¸å˜ï¼Œä»…ä¿®æ”¹ç‰¹å®šä½ç½®çš„å€¼
- è°¨æ…ä½¿ç”¨ï¼Œå¯èƒ½ç ´åç‰¹æ®Šåˆ—è¡¨çš„ä¸å˜é‡

æ³¨æ„äº‹é¡¹
--------
- åˆ—è¡¨å‚æ•°å¿…é¡»æ˜¯éç©ºåˆ—è¡¨æˆ–å¯ä¿®æ”¹çš„pairå¯¹è±¡
- ä¿®æ”¹åç›´æ¥ä½œç”¨äºåŸå§‹åˆ—è¡¨ï¼Œä¸åˆ›å»ºæ–°å¯¹è±¡
- å¯ä»¥é€šè¿‡æ ¡éªŒlist-refæ¥éªŒè¯ä¿®æ”¹çš„æ­£ç¡®æ€§
- Rust-likeå®‰å…¨æ¨¡å‹ï¼šä¸¥æ ¼çš„è¾¹ç•Œæ£€æŸ¥å’Œç±»å‹éªŒè¯
|#

;; list-set! åŸºæœ¬åŠŸèƒ½æµ‹è¯•
(let ((lst (list 'a 'b 'c)))
  (list-set! lst 1 'x)
  (check lst => '(a x c)))

;; è¾¹ç•Œå€¼æµ‹è¯•ï¼šç´¢å¼•æç«¯å€¼
(let ((lst (list 'single)))
  (list-set! lst 0 'modified)
  (check lst => '(modified)))

(let ((lst (list 'first 'middle 'last)))
  (list-set! lst 0 'start)
  (list-set! lst 2 'end)
  (check lst => '(start middle end)))

(let ((lst (list 'a 'b 'c 'd)))
  (list-set! lst 3 'last)
  (check lst => '(a b c last)))

;; ç©ºåˆ—è¡¨é¢ç•Œæµ‹è¯•
(let ((lst (list)))
  (check-catch 'wrong-type-arg (list-set! lst 0 'value)))

;; å„ç§æ•°æ®ç±»å‹æµ‹è¯•
(let ((lst (list 1 "text" #t 'symbol)))
  (list-set! lst 0 42)
  (list-set! lst 1 "modified")
  (list-set! lst 2 #f)
  (list-set! lst 3 'changed)
  (check lst => '(42 "modified" #f changed)))

;; å­—ç¬¦æ•°æ®ç±»å‹æµ‹è¯•
(let ((lst (list #\a #\b #\c #\d)))
  (list-set! lst 0 #\A)
  (list-set! lst 3 #\D)
  (check lst => '(#\A #\b #\c #\D)))

;; å­—ç¬¦ä¸²æ•°æ®ç±»å‹æµ‹è¯•
(let ((lst (list "hello" "world" "test")))
  (list-set! lst 1 "modified")
  (check lst => '("hello" "modified" "test")))

;; å¸ƒå°”æ•°æ®ç±»å‹æµ‹è¯•
(let ((lst (list #t #f #t)))
  (list-set! lst 1 #t)
  (check lst => '(#t #t #t)))

;; ç¬¦å·æ•°æ®ç±»å‹æµ‹è¯•
(let ((lst (list 'define 'lambda 'if 'cond)))
  (list-set! lst 2 'when)
  (check lst => '(define lambda when cond)))

;; è¿‡ç¨‹æ•°æ®ç±»å‹æµ‹è¯•
(let ((lst (list car cdr cons)))
  (list-set! lst 0 list)
  (check (procedure? (list-ref lst 0)) => #t))

;; åµŒå¥—å­åˆ—è¡¨ç»“æ„æµ‹è¯•
(let ((lst (list '(a b) '(c d) '(e f))))
  (list-set! lst 1 '(x y z))
  (check lst => '((a b) (x y z) (e f))))

;; åµŒå¥—ç»“æ„æ›¿æ¢æµ‹è¯•
(let ((lst (list (list 'a) (list 'b) (list 'c))))
  (list-set! lst 1 (list 'x 'y))
  (check lst => '((a) (x y) (c))))

;; æ·±åº¦åµŒå¥—ç»“æ„æµ‹è¯•
(let ((lst (list (list (list 1)) (list 2) (list (list 3)))))
  (list-set! lst 1 (list 'new 'structure))
  (check lst => '(((1)) (new structure) ((3)))))

;; å‘é‡å’Œå­—èŠ‚å‘é‡å…ƒç´ æµ‹è¯•
(let ((lst (list #(1 2 3) #u8(255 128))))
  (list-set! lst 0 #(4 5 6))
  (list-set! lst 1 #u8(100 200))
  (check lst => `(#(4 5 6) #u8(100 200))))

;; Unicodeå­—ç¬¦ä¸²å…ƒç´ æµ‹è¯•
(let ((lst (list "ä¸­æ–‡" "æµ‹è¯•" "å­—ç¬¦ä¸²")))
  (list-set! lst 1 "ä¿®æ”¹")
  (check lst => '("ä¸­æ–‡" "ä¿®æ”¹" "å­—ç¬¦ä¸²")))

;; æ„é€ å™¨å‡½æ•°åˆ—è¡¨æµ‹è¯•
(let ((lst (make-list 4 'placeholder)))
  (list-set! lst 1 'second)
  (list-set! lst 3 'last)
  (check lst => '(placeholder second placeholder last)))

;; é•¿åˆ—è¡¨æ€§èƒ½æµ‹è¯•
(let ((lst (list 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20)))
  (list-set! lst 5 'five)
  (list-set! lst 15 'fifteen)
  (check lst => '(1 2 3 4 5 five 7 8 9 10 11 12 13 14 15 fifteen 17 18 19 20)))

;; ç©ºå­—ç¬¦ä¸²å’Œç©ºåˆ—è¡¨å…ƒç´ æµ‹è¯•
(let ((lst (list "" (list) "abc")))
  (list-set! lst 1 (list 'x 'y 'z))
  (check lst => '("" (x y z) "abc")))

;; æ•°å€¼å’Œæµ®ç‚¹æ•°å…ƒç´ æµ‹è¯•
(let ((lst (list 1 2.5 3 4.0 )))
  (list-set! lst 2 99)
  (list-set! lst 3 100.0)
  (check lst => '(1 2.5 99 100.0)))

;; å‡½æ•°æ›¿æ¢æµ‹è¯•
(let ((lst (list #t #f #t #f)))
  (list-set! lst 2 42)
  (list-set! lst 3 "hello")
  (check lst => '(#t #f 42 "hello")))

;; é”™è¯¯å‚æ•°ç±»å‹æµ‹è¯•
(check-catch 'wrong-type-arg (list-set! 123 0 'value))
(check-catch 'wrong-type-arg (list-set! "string" 1 'value))
(check-catch 'wrong-type-arg (list-set! #t 0 'value))
(check-catch 'wrong-type-arg (list-set! 'symbol 1 'value))

;; ç´¢å¼•è¶Šç•Œæµ‹è¯•
(let ((lst (list 'a 'b 'c)))
  (check-catch 'out-of-range (list-set! lst -1 'value))
  (check-catch 'out-of-range (list-set! lst 3 'value))
  (check-catch 'out-of-range (list-set! lst 4 'value)))

(let ((lst (list 'single)))
  (check-catch 'out-of-range (list-set! lst 1 'value))
  (check-catch 'out-of-range (list-set! lst -1 'value)))

;; å‚æ•°æ•°é‡é”™è¯¯æµ‹è¯•
(check-catch 'wrong-number-of-args (list-set!))
(check-catch 'wrong-number-of-args (list-set! '(a b c)))
(check-catch 'wrong-number-of-args (list-set! '(a b c) 1))
(check-catch 'wrong-number-of-args (list-set! '(a b c) 1 'x 'y))

;; å¤§æ•´æ•°ç´¢å¼•è¾¹ç•Œæµ‹è¯•
(let ((lst '(a b c d e f g h i j)))
  (check-catch 'out-of-range (list-set! lst 11 'value)))

;; éªŒè¯çªå˜å½±å“ï¼ˆå…±äº«å¼•ç”¨æµ‹è¯•ï¼‰
(let ((original (list 'a 'b 'c 'd 'e)))
  (let ((shared original))
    (list-set! shared 2 'modified)
    (check original => '(a b modified d e))  ; åŸåˆ—è¡¨ä¹Ÿè¢«ä¿®æ”¹
    (check (eq? original shared) => #t)))   ; ç¡®å®æ˜¯åŒä¸€å¯¹è±¡

;; ç¡®ä¿ä¿®æ”¹æ­£ç¡®æ€§éªŒè¯ï¼ˆä¿®æ”¹ä¸ºlist-refæ£€æŸ¥ï¼‰
(let ((lst (list 'alpha 'beta 'gamma)))
  (let ((val-before (list-ref lst 1)))  ; åŸå€¼åº”ä¸º'beta
    (list-set! lst 1 'changed)
    (let ((val-after (list-ref lst 1)))
      (check val-after => 'changed))))

;; è¢«ä¿®æ”¹å¼•ç”¨å…³ç³»ä¿æŒæµ‹è¯•
(let ((lst (cons 10 (cons 20 (cons 30 '())))))
  (list-set! lst 1 200)
  (list-set! lst 2 300)
  (check lst => '(10 200 300)))

#|
memq
ä½¿ç”¨å¯¹è±¡æ ‡è¯†ï¼ˆeq?æ¯”è¾ƒï¼‰åœ¨åˆ—è¡¨ä¸­æŸ¥æ‰¾æŒ‡å®šç¬¦å·é”®ã€‚æ­¤å‡½æ•°æ˜¯R7RSæ ‡å‡†ä¸­é’ˆå¯¹ç¬¦å·çš„ç‰¹æ®ŠæŸ¥æ‰¾ä¼˜åŒ–ã€‚

è¯­æ³•
----
(memq symbol lst)

å‚æ•°
----
symbol :
    è¦æŸ¥æ‰¾çš„ç¬¦å·é”®ï¼Œç±»å‹é€šå¸¸ä¸ºç¬¦å·(symbol)ï¼Œä½†ä¹Ÿæ”¯æŒå…¶ä»–å¯eq?æ¯”è¾ƒçš„å¯¹è±¡ç±»å‹ã€‚

lst : pair?
    è¦æœç´¢çš„åˆ—è¡¨æˆ–ç‚¹å¯¹ç»“æ„ã€‚å¯ä»¥æ˜¯æ™®é€šåˆ—è¡¨ã€å…³è”åˆ—è¡¨æˆ–éç©ºåˆ—è¡¨ç»“æ„ã€‚
    ç©ºåˆ—è¡¨å¯ä½œä¸ºå‚æ•°ï¼Œä½†è¿”å›#fã€‚

è¿”å›å€¼
------
list?
    è‹¥ç¬¦å·åœ¨åˆ—è¡¨ä¸­ï¼Œè¿”å›ä»ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹å¼€å§‹çš„å­åˆ—è¡¨ï¼ˆä¿ç•™åŸå§‹å†…å­˜ç»“æ„ï¼‰ã€‚
#f
    è‹¥æœªæ‰¾åˆ°æŒ‡å®šç¬¦å·æˆ–åˆ—è¡¨ä¸ºç©ºã€‚

è¡Œä¸ºç‰¹å¾
--------
1. é‡‡ç”¨eq?è¿›è¡Œä¸¥æ ¼å¯¹è±¡æ ‡è¯†æ¯”è¾ƒï¼ˆåŒºåˆ«äºmemvçš„eqv?æ¯”è¾ƒå’Œmemberçš„equal?æ¯”è¾ƒï¼‰
2. ä¸“é—¨ä¸ºç¬¦å·é”®è®¾è®¡çš„æœ€ä¼˜åŒ–æŸ¥æ‰¾è·¯å¾„ï¼ˆSymbol Key Desing-Oriented Lookup Pathwayï¼‰
3. æˆåŠŸåŒ¹é…æ—¶è¿”å›åŸå§‹åˆ—è¡¨çš„å°¾éƒ¨å­åˆ—è¡¨ï¼Œä¸æ˜¯å¤åˆ¶çš„æ–°å¯¹è±¡
4. å¤±è´¥æ—¶è¿”å›#fï¼Œæ— ä»»ä½•ç³»ç»Ÿå¼€é”€
5. ä¿æŒè¾“å…¥è¾“å‡ºç»“æ„ä¸€è‡´æ€§ï¼Œé€‚ç”¨äºå…³è”åˆ—è¡¨æ“ä½œ

è¾¹ç•Œæ¡ä»¶
--------
- ç©ºåˆ—è¡¨å‚æ•°ï¼šå§‹ç»ˆè¿”å›#f
- å•å…ƒç´ åˆ—è¡¨è¾¹ç•Œï¼šæˆåŠŸåŒ¹é…è¿”å›å•å…ƒç´ åˆ—è¡¨
- é‡å¤é”®å¤„ç†ï¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„å°¾éƒ¨å­åˆ—è¡¨
- éç¬¦å·ç±»å‹å…¼å®¹æ€§ï¼šä»»ä½•å¯eq?æ¯”è¾ƒå¯¹è±¡å‡æ”¯æŒ
- åµŒå¥—ç»“æ„è¾¹ç•Œï¼šæ­£ç¡®å¤„ç†æ·±å±‚åµŒå¥—å’Œå…³è”åˆ—è¡¨

æ€§èƒ½ç‰¹å¾
--------
- æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­nä¸ºåˆ—è¡¨é•¿åº¦ï¼Œçº¿æ€§éå†
- ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œæ— é¢å¤–å†…å­˜æ¶ˆè€—
- å†…å­˜å…±äº«ï¼šæˆåŠŸæ—¶å…±äº«åŸå§‹åˆ—è¡¨å†…å­˜ç»“æ„
- å¿«é€Ÿè·¯å¾„ï¼šç¬¦å·é”®çš„ä¸“ç”¨ä¼˜åŒ–æ¯”è¾ƒå™¨
- é€’å½’æ·±åº¦ï¼šåŸºäºåˆ—è¡¨é•¿åº¦çš„çº¿æ€§é€’å½’ï¼Œåˆç†æ·±åº¦å®‰å…¨å¤„ç†

æ•°æ®ç±»å‹å…¼å®¹æ€§
---------------
- **ç¬¦å·ç±»å‹**ï¼šæ™®é€šç¬¦å·ã€ç‰¹æ®Šç¬¦å·ã€å…³é”®å­—ç¬¦å·
- **æ•°å­—ç±»å‹**ï¼šæ•´æ•°ã€æµ®ç‚¹æ•°å‡æ”¯æŒeq?æ¯”è¾ƒ
- **å­—ç¬¦ç±»å‹**ï¼šæ‰€æœ‰å­—ç¬¦ç±»å‹ç»Ÿä¸€æ”¯æŒ
- **å¸ƒå°”ç±»å‹**ï¼š#tå’Œ#fçš„æ ‡å‡†æ”¯æŒ
- **è¿‡ç¨‹ç±»å‹**ï¼šå†…ç½®è¿‡ç¨‹å’Œè‡ªå®šä¹‰è¿‡ç¨‹æ­£ç¡®è¯†åˆ«
- **ç‰¹æ®Šå¯¹è±¡**ï¼šç‚¹å¯¹ç»“æ„ã€åµŒå¥—åˆ—è¡¨ã€æ„é€ å™¨ç»“æœ
- **å¤åˆç»“æ„**ï¼šå‘é‡ã€å­—èŠ‚å‘é‡ã€åµŒå¥—è¿‡ç¨‹ç»“æ„

é”™è¯¯å¤„ç†
--------
wrong-type-arg
    å½“å‚æ•°ç±»å‹ä¸åŒ¹é…æˆ–æ•°é‡é”™è¯¯æ—¶æŠ›å‡ºã€‚

åº”ç”¨æ³¨æ„
--------
- è®¾è®¡ç”¨äºç¬¦å·é”®çš„ä¼˜åŒ–åœºæ™¯ï¼Œæ¯”memberå’Œmemvæ›´é«˜æ•ˆç‡
- ä¿æŒå†…å­˜ç»“æ„å®Œå…¨ä¸€è‡´ï¼Œé€‚åˆè¿é”æ“ä½œå’ŒçŠ¶æ€ç®¡ç†
- é€‚ç”¨äºå…³è”åˆ—è¡¨ã€è°“è¯åˆ—è¡¨å’Œç¯å¢ƒå˜é‡æŸ¥æ‰¾
- è¿”å›ç»“æ„æ”¯æŒç»§ç»­é“¾å¼æ“ä½œï¼ˆcadrã€cddrç­‰ï¼‰
- åœ¨éœ€è¦ä¸¥æ ¼å¯¹è±¡æ ‡è¯†çš„åœºæ™¯ä¸­ä¼˜å…ˆé€‰æ‹©memq

é™åˆ¶è¯´æ˜
--------
- eq?æ¯”è¾ƒä¸¥æ ¼ï¼Œç­‰ä»·æ•°å€¼ä¾‹å¦‚æ•´æ•°å’Œæµ®ç‚¹æ•°å€¼éœ€è¦å®Œå…¨ç›¸åŒçš„å¯¹è±¡
- ä¸é€‚ç”¨äºå­—ç¬¦ä¸²ã€æ•°å­—ç­‰éœ€è¦é€šè¿‡å€¼æ¯”è¾ƒçš„åœºæ™¯
- ä¸memvå’Œmemberå½¢æˆäº’è¡¥å…³ç³»ï¼ŒæŒ‰éœ€æ±‚é€‰æ‹©
- ä¸èƒ½ç”¨äºé”®å€¼å¯¹æŸ¥æ‰¾ï¼ˆéœ€è¦assocç­‰æ›´é«˜çº§å‡½æ•°ï¼‰
- è¿”å›çš„æ˜¯å­åˆ—è¡¨ï¼Œä¸æ˜¯ç‰¹å®šä½ç½®çš„å€¼
|#

;; memq åŸºæœ¬åŠŸèƒ½æµ‹è¯•
(check (memq 'a '(a b c)) => '(a b c))
(check (memq 'b '(a b c)) => '(b c))
(check (memq 'c '(a b c)) => '(c))
(check (memq 'd '(a b c)) => #f)

;; è¾¹ç•Œå€¼æµ‹è¯•
(check (memq '? '()) => #f)
(check (memq 'only '(only)) => '(only))
(check (memq 'single '(single)) => '(single))
(check (memq 'first '(first second third)) => '(first second third))
(check (memq 'last '(first second last)) => '(last))

;; ç¬¦å·é”®æŸ¥æ‰¾ä¼˜åŒ–æµ‹è¯•
(check (memq 'define '(define lambda if)) => '(define lambda if))
(check (memq 'cond '(if else when unless)) => #f)
(check (memq 'car '(cdr cons car)) => '(car))
(check (memq 'procedure '(symbol list number string)) => #f)

;; é‡å¤é”®è¾¹ç•Œæµ‹è¯•
(check (memq 'repeat '(a b repeat c repeat d)) => '(repeat c repeat d))
(check (memq 'same '(same same same)) => '(same same same))

;; å¸ƒå°”å€¼è¾¹ç•Œæµ‹è¯•
(check (memq #t '(#t #f #t)) => '(#t #f #t))
(check (memq #f '(#t #f #t)) => '(#f #t))
(check (memq #t '(#f only)) => #f)

;; å­—ç¬¦é”®æµ‹è¯•
(check (memq #\a '(#\b #\a #\c)) => '(#\a #\c))
(check (memq #\x '(#\a #\b #\c)) => #f)
(check (memq #\newline '(a #\newline b)) => '(#\newline b))

;; æ•°å­—è¾¹ç•Œæµ‹è¯•
(check (memq 42 '(1 42 3)) => '(42 3))
(check (memq 0 '(0 1 2)) => '(0 1 2))
(check (memq -1 '(0 1 2)) => #f)
(check (memq 100 '(100 200 300)) => '(100 200 300))

;; ç‰¹æ®Šç¬¦å·å­—ç¬¦æµ‹è¯•
(check (memq 'Î» '(Î» Î± Î²)) => '(Î» Î± Î²))
(check (memq '$ '(symbol $ delta)) => '($ delta))

;; è¿‡ç¨‹å¯¹è±¡è¾¹ç•Œæµ‹è¯•
(let ((start car) (next cdr) (last cons))
  (check (memq start (list car cdr start)) => (list car cdr start))
  (check (memq next (list cons list)) => #f))

;; å¤åˆç»“æ„æµ‹è¯•
(let ((test-list '(cons list append)))
  (check (memq 'list test-list) => '(list append))
  (check (memq 'other-symbol test-list) => #f))

;; ç‚¹å¯¹ç»“æ„æµ‹è¯•
(check (memq 'center '(left center right top)) => '(center right top))
(check (memq 'middle '(begin middle end)) => '(middle end))

#|
memv
ä½¿ç”¨å¯¹è±¡å€¼æ¯”è¾ƒï¼ˆeqv?æ¯”è¾ƒï¼‰åœ¨åˆ—è¡¨ä¸­æŸ¥æ‰¾æŒ‡å®šå…ƒç´ ã€‚æ­¤å‡½æ•°æ˜¯R7RSæ ‡å‡†ä¸­ä¸“é—¨é’ˆå¯¹æ•°å€¼ã€å­—ç¬¦ç­‰åŸºç¡€æ•°æ®ç±»å‹çš„ä¼˜åŒ–æŸ¥æ‰¾å‡½æ•°ã€‚

è¯­æ³•
----
(memv element lst)

å‚æ•°
----
element : any
    è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œå¯ä»¥æ˜¯ç¬¦å·ã€å­—ç¬¦ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰åŸºç¡€ç±»å‹æ•°æ®ã€‚ç‰¹åˆ«é€‚åˆç”¨ä½œæ ‡å‡†æ•°å€¼å’Œå­—ç¬¦çš„æŸ¥æ‰¾ã€‚

lst : pair?
    è¦æœç´¢çš„åˆ—è¡¨æˆ–ç‚¹å¯¹ç»“æ„ã€‚å¯ä»¥æ˜¯æ™®é€šåˆ—è¡¨ã€æ•°å€¼åˆ—è¡¨ã€å­—ç¬¦åˆ—è¡¨ç­‰ï¼Œç©ºåˆ—è¡¨å¯ä½œä¸ºå‚æ•°ä½†è¿”å›#fã€‚

è¿”å›å€¼
------
list?
    è‹¥å…ƒç´ åœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°ï¼Œè¿”å›ä»ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹å¼€å§‹çš„å­åˆ—è¡¨ï¼ˆä¿ç•™åŸå§‹å†…å­˜ç»“æ„ï¼Œé€šå¸¸ç§°ä¸ºæŸ¥æ‰¾ç»“æœçš„"å°¾éƒ¨"ï¼‰ã€‚
#f
    è‹¥æœªæ‰¾åˆ°æŒ‡å®šå…ƒç´ æˆ–åˆ—è¡¨ä¸ºç©ºã€‚

è¡Œä¸ºç‰¹å¾
--------
1. é‡‡ç”¨eqv?è¿›è¡Œç²¾ç¡®å€¼æ¯”è¾ƒï¼ˆåŒºåˆ«äºmemqçš„eq?æ¯”è¾ƒå’Œmemberçš„equal?æ¯”è¾ƒï¼‰ã€‚equ?èƒ½å¤Ÿæ­£ç¡®å¤„ç†æ•°å€¼çš„ç­‰ä»·æ€§ï¼ˆä¾‹å¦‚æ•´æ•°42å’Œæµ®ç‚¹42.0çš„ç­‰ä»·æ€§ï¼‰ã€‚
2. ä¸“é—¨ä¸ºæ•°å€¼ã€å­—ç¬¦ç­‰åŸºç¡€æ•°æ®ç±»å‹è®¾è®¡çš„ä¼˜åŒ–æŸ¥æ‰¾è·¯å¾„ï¼Œåœ¨æ•°å€¼åˆ—è¡¨åº”ç”¨ä¸­æœ‰æ€§èƒ½ä¼˜åŠ¿
3. æˆåŠŸåŒ¹é…æ—¶è¿”å›åŸå§‹åˆ—è¡¨çš„å°¾éƒ¨å­åˆ—è¡¨ï¼Œä¸ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œä¿æŒå†…å­˜ç»“æ„å®Œå…¨ä¸€è‡´
4. å¤±è´¥æ—¶è¿”å›#fï¼Œæ— ä»»ä½•ç³»ç»Ÿå¼€é”€
5. ä¿æŒè¾“å…¥è¾“å‡ºç»“æ„ä¸€è‡´æ€§ï¼Œé€‚ç”¨äºåŸºç¡€æ•°æ®ç±»å‹åˆ—è¡¨çš„ç­›é€‰å’Œæ“ä½œ

è¾¹ç•Œæ¡ä»¶
--------
- ç©ºåˆ—è¡¨å‚æ•°ï¼šå§‹ç»ˆè¿”å›#f
- å•å…ƒç´ åˆ—è¡¨è¾¹ç•Œï¼šå­˜åœ¨åŒ¹é…æ—¶è¿”å›å•å…ƒç´ åˆ—è¡¨
- é‡å¤å…ƒç´ å¤„ç†ï¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…å€¼çš„å°¾éƒ¨å­åˆ—è¡¨ï¼ˆç´¢å¼•æœ€å°å€¼ï¼‰
- ç²¾ç¡®åŒ¹é…åŸåˆ™ï¼šåŸºäºeqv?çš„ç²¾ç¡®æ•°å€¼æ¯”è¾ƒï¼Œç¡®ä¿æ•°å€¼ç±»å‹ä¸€è‡´æ€§
- å­—ç¬¦å’Œå¸ƒå°”ç±»å‹ï¼šç»Ÿä¸€å¤„ç†æ‰€æœ‰Unicodeå­—ç¬¦æ ‡å‡†ç±»å‹
- åµŒå¥—åˆ—è¡¨ç»“æ„ï¼šæ­£ç¡®å¤„ç†æ•°å€¼å­åˆ—è¡¨ã€å­—ç¬¦å­åˆ—è¡¨ç­‰ç›¸å…³ç»“æ„
- éæ­£è§„åˆ—è¡¨ï¼šæ”¯æŒç‚¹å¯¹ç»“æ„å’Œimproper listsæŸ¥æ‰¾æ“ä½œ

æ€§èƒ½ç‰¹å¾
--------
- æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­nä¸ºåˆ—è¡¨é•¿åº¦ï¼Œçº¿æ€§éå†æ•´ä¸ªåˆ—è¡¨
- ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œæ— é¢å¤–å†…å­˜æ¶ˆè€—ï¼Œè¿”å›ç»“æ„ç›´æ¥å…±äº«åŸå§‹æ•°æ®
- å†…å­˜å…±äº«ï¼šæˆåŠŸæ—¶å®Œå…¨å…±äº«åŸå§‹åˆ—è¡¨å†…å­˜ç»“æ„
- å¿«é€Ÿè·¯å¾„ï¼šæ•°å€¼å’Œå­—ç¬¦ç±»å‹çš„ä¸“ç”¨eqv?ä¼˜åŒ–æ¯”è¾ƒå™¨
- é€’å½’æ·±åº¦ï¼šåŸºäºåˆ—è¡¨é•¿åº¦çš„çº¿æ€§é€’å½’ï¼Œåˆç†æ·±åº¦å®‰å…¨å¤„ç†

æ•°æ®ç±»å‹å…¼å®¹æ€§
---------------
- **æ•°å€¼ç±»å‹æ”¯æŒ**ï¼š
  - æ•´æ•°ç±»å‹ï¼šæ­£æ•´æ•°ã€è´Ÿæ•´æ•°ã€0å‡ç»Ÿä¸€æ”¯æŒ
  - æµ®ç‚¹æ•°ç±»å‹ï¼šæ ‡å‡†IEEEæµ®ç‚¹æ ¼å¼ï¼ŒåŒ…æ‹¬ç§‘å­¦è®¡æ•°æ³•
  - å¤æ•°ç±»å‹ï¼šæ ‡å‡†å¤æ•°è¡¨ç¤ºï¼Œå€¼æ¯”è¾ƒå‹åŒ¹é…
  - æœ‰ç†æ•°ç±»å‹ï¼šä»»æ„è¿›åˆ¶æœ‰ç†æ•°è¡¨ç¤ºï¼Œä¿ç•™ç²¾åº¦æ¯”è¾ƒ
- **å­—ç¬¦ç±»å‹å…¨å…¼å®¹**ï¼š
  - ASCIIå­—ç¬¦é›†ï¼šæ‰€æœ‰æ ‡å‡†ASCIIå­—ç¬¦
  - Unicodeå­—ç¬¦ï¼šæ”¯æŒå®Œæ•´Unicodeå­—ç¬¦é›†ï¼ŒåŒ…æ‹¬ä¸­æ–‡ã€è¡¨æƒ…ç¬¦å·ç­‰
  - ç‰¹æ®Šæ§åˆ¶å­—ç¬¦ï¼šæ¢è¡Œç¬¦ã€å›è½¦ç¬¦ã€åˆ¶è¡¨ç¬¦ç­‰ç»Ÿä¸€æ”¯æŒ
- **å¸ƒå°”ç±»å‹**ï¼šå®Œå…¨æ”¯æŒ#tå’Œ#fçš„ç²¾ç¡®åŒ¹é…
- **ç¬¦å·ç±»å‹æ”¯æŒ**ï¼šæ™®é€šç¬¦å·ã€å…³é”®å­—ç¬¦å·ã€å¤åˆç¬¦å·
- **ç‰¹æ®Šå¯¹è±¡æ”¯æŒ**ï¼šç‚¹å¯¹ç»“æ„ã€åµŒå¥—åˆ—è¡¨ã€æ„é€ å™¨ç»“æœ
- **æ•ˆç‡æƒè¡¡**ï¼šåœ¨æ•°å€¼å’Œå­—ç¬¦æŸ¥æ‰¾ä¸­æ¯”memqå’Œmemberæ•ˆç‡æ›´é«˜

é”™è¯¯å¤„ç†
--------
wrong-type-arg
    å½“å‚æ•°ç±»å‹ä¸åŒ¹é…æˆ–å‚æ•°æ•°é‡é”™è¯¯æ—¶æŠ›å‡ºã€‚

ä¸memqã€memberçš„ç²¾ç¡®åˆ†å·¥
------------------------
- **memv vs memq**ï¼šmemvä½¿ç”¨eqv?æ¯”è¾ƒï¼ˆæ•°å€¼å’Œå­—ç¬¦æœ€ä¼˜ï¼‰ï¼Œmemqä½¿ç”¨eq?æ¯”è¾ƒï¼ˆç¬¦å·æœ€ä¼˜ï¼‰
- **memv vs member**ï¼šmemvä½¿ç”¨eqv?æ¯”è¾ƒï¼ˆåŸºç¡€ç±»å‹æœ€ä¼˜ï¼‰ï¼Œmemberä½¿ç”¨equal?æ¯”è¾ƒï¼ˆå¤åˆå¯¹è±¡æœ€ä¼˜ï¼‰
- **åº”ç”¨çŸ©é˜µ**ï¼š
  - æ•°å€¼/å­—ç¬¦æŸ¥æ‰¾ â†’ ä¼˜å…ˆ memv
  - ç¬¦å·æŸ¥æ‰¾ â†’ ä¼˜å…ˆ memq
  - å­—ç¬¦ä¸²/å¤åˆå¯¹è±¡ â†’ ä¼˜å…ˆ member

åº”ç”¨æ³¨æ„
--------
- æŸ¥æ‰¾çš„æ ¸å¿ƒä»·å€¼åœ¨äºæ•°å€¼å’Œå­—ç¬¦ç±»å‹çš„é«˜æ•ˆå¤„ç†ï¼Œæ˜¯è¿™ç±»åœºæ™¯ä¸­çš„é¦–é€‰æ–¹æ¡ˆ
- é’ˆå¯¹æ•°å€¼åˆ—è¡¨æŸ¥æ‰¾ã€å­—ç¬¦æ•°æ®ç­›é€‰ã€åŸºç¡€ç±»å‹è¿‡æ»¤ç­‰åœºæ™¯è¿›è¡Œå…³é”®ä¼˜åŒ–
- è°ƒç”¨ç»“æœçš„å­åˆ—è¡¨å½¢å¼ä¸ºåç»­åˆ—è¡¨æ“ä½œæä¾›ä¾¿æ·çš„é“¾å¼è°ƒç”¨æ¥å£
- å¯¹äºæ•°å€¼è¿ç®—äº§ç”Ÿçš„åŠ¨æ€æ•°æ®éå¸¸æœ‰ç”¨ï¼ˆä¾‹å¦‚é€šè¿‡mapç”Ÿæˆçš„æ•°å€¼åˆ—è¡¨æŸ¥æ‰¾ï¼‰
- åœ¨å¤„ç†å¤§è§„æ¨¡æ•°å€¼å’Œå­—ç¬¦æ•°æ®æ—¶ï¼Œç›¸æ¯”å…¶ä»–æ–¹æ¡ˆæœ‰æ˜¾è‘—çš„æ€§èƒ½ä¼˜åŠ¿

é™åˆ¶è¯´æ˜
--------
- ä¸èƒ½æŸ¥æ‰¾åµŒå¥—åˆ—è¡¨å†…éƒ¨çš„æ•°å€¼æˆ–å­—ç¬¦å…ƒç´ 
- ä¸æ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œéœ€è¦ç²¾ç¡®å€¼åŒ¹é…
- ä¸memqå’Œmemberå…±åŒç»„æˆR7RSçš„ä¸‰ä¸ªæ ‡å‡†æŸ¥æ‰¾å‡½æ•°çš„ä¸‰ä½ä¸€ä½“æ¶æ„
- æŸ¥æ‰¾åŠŸèƒ½ä¸¥æ ¼é™å®šåœ¨é¡¶å±‚åˆ—è¡¨ç»“æ„ï¼Œä¸æ·±å…¥åµŒå¥—å±‚çº§
- è‹¥éœ€è¦å¤æ‚æ¡ä»¶æŸ¥æ‰¾ï¼Œéœ€è¦é…åˆfilterç­‰å‡½æ•°ç»„åˆä½¿ç”¨
|#

;; memv åŸºæœ¬åŠŸèƒ½æµ‹è¯•
(check (memv 1 '(1 2 3)) => '(1 2 3))
(check (memv 2 '(1 2 3)) => '(2 3))
(check (memv 3 '(1 2 3)) => '(3))
(check (memv 4 '(1 2 3)) => #f)

;; ç©ºåˆ—è¡¨è¾¹ç•Œæµ‹è¯•
(check (memv 0 '()) => #f)
(check (memv #\a '()) => #f)
(check (memv #t '()) => #f)

;; å•å…ƒç´ åˆ—è¡¨è¾¹ç•Œæµ‹è¯•
(check (memv 42 '(42)) => '(42))
(check (memv 100 '(single)) => #f)
(check (memv 3.14 '(3.14)) => '(3.14))

;; æ•°å€¼ç±»å‹è¾¹ç•Œæµ‹è¯•
(check (memv 0 '(0 1 2 3)) => '(0 1 2 3))
(check (memv -42 '(-42 0 42)) => '(-42 0 42))
(check (memv 42 '(-42 0 42)) => '(42))
(check (memv 3.14159 '(2.71 3.14159 1.414)) => '(3.14159 1.414))
(check (memv 1.5 '(1.0 1.5 2.0)) => '(1.5 2.0))

;; å­—ç¬¦ç±»å‹è¾¹ç•Œæµ‹è¯•
(check (memv #\a '(#\b #\a #\c)) => '(#\a #\c))
(check (memv #\b '(#\c #\b #\a)) => '(#\b #\a))
(check (memv #\newline '(a b c)) => #f)
(check (memv #\space '(#\tab #\space #\newline)) => '(#\space #\newline))

;; åŸºæœ¬å­—ç¬¦æµ‹è¯•
(check (memv #\a '(#\b #\a #\c)) => '(#\a #\c))
(check (memv #\A '(#\A #\B #\C)) => '(#\A #\B #\C))

;; å¸ƒå°”å€¼è¾¹ç•Œæµ‹è¯•
(check (memv #t '(#f #t #f)) => '(#t #f))
(check (memv #f '(#t #f #t)) => '(#f #t))
(check (memv #t '(#f only)) => #f)

;; ç¬¦å·ç±»å‹æµ‹è¯•ï¼ˆç¡®ä¿eqv?æ­£ç¡®å¤„ç†ç¬¦å·ï¼‰
(check (memv 'symbol '(other symbol test)) => '(symbol test))
(check (memv 'ä¸­æ–‡ç¬¦å· '(å…³é”®å­— ä¸­æ–‡ç¬¦å· æµ‹è¯•)) => '(ä¸­æ–‡ç¬¦å· æµ‹è¯•))

;; é‡å¤å€¼å¤„ç†æµ‹è¯•
(check (memv 42 '(10 20 42 42 42)) => '(42 42 42))
(check (memv #\a '(x y z #\a #\a)) => '(#\a #\a))

;; å¤æ•°ç±»å‹è¾¹ç•Œæµ‹è¯•
(check (memv 1+2i '(0+1i 1+2i 3+4i)) => '(1+2i 3+4i))
(check (memv 0+0i '(1+1i 2+2i)) => #f)

;; æœ‰ç†æ•°è¾¹ç•Œæµ‹è¯•
(check (memv 1/2 '(1/3 1/2 2/3)) => '(1/2 2/3))
(check (memv 3/4 '(1/2 1/4)) => #f)

;; æç«¯è¾¹ç•Œå€¼æµ‹è¯•
(check (memv 2147483647 '(2147483646 2147483647 2147483648)) => '(2147483647 2147483648))
(check (memv -2147483648 '(-2147483649 -2147483648 -2147483647)) => '(-2147483648 -2147483647))

;; æµ®ç‚¹æ•°ç²¾åº¦æµ‹è¯•
(check (memv 0.0001 '(0.0000 0.0001 0.0002)) => '(0.0001 0.0002))
(check (memv 9999.999 '(9999.998 9999.999 10000.000)) => '(9999.999 10000.000))

;; æ··åˆç±»å‹åˆ—è¡¨æµ‹è¯•
(check (memv 42 '("string" 42 #\a #t)) => '(42 #\a #t))
(check (memv #\x '(x y z #\x symbol 3.14)) => '(#\x symbol 3.14))

;; åµŒå¥—ç»“æ„ä¸­çš„é¡¶å±‚æŸ¥æ‰¾
(check (memv 1 '((1 2) 3 4)) => #f)  ; ä¸èƒ½æŸ¥æ‰¾åµŒå¥—åˆ—è¡¨å†…éƒ¨
(check (memv 3 '((1 2) 3 4)) => '(3 4))

;; å¤§åˆ—è¡¨æ€§èƒ½éªŒè¯
(check (memv 15 '(0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20)) => '(15 16 17 18 19 20))
(check (memv 999 (make-list 5 999)) => '(999 999 999 999 999))
(check (memv 20 (append '(0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19) '(20))) => '(20))

;; æ„é€ å™¨å‡½æ•°ç»“æœæµ‹è¯•
(check (memv 2 (list 1 2 3 4 5)) => '(2 3 4 5))
(check (memv 2.5 (cons 1.0 (cons 2.5 (cons 3.0 '())))) => '(2.5 3.0))

;; å‘é‡ä¸å­—ç¬¦æ··åˆæµ‹è¯•
(check (memv 3.14 '(#(1 2) 3.14 #\a "test")) => '(3.14 #\a "test"))

;; é”™è¯¯å‚æ•°ç±»å‹æµ‹è¯•
(check-catch 'wrong-type-arg (memv 0 "not a list"))
(check-catch 'wrong-type-arg (memv 0 123))
(check-catch 'wrong-type-arg (memv 0 #t))

;; å‚æ•°æ•°é‡é”™è¯¯æµ‹è¯•
(check-catch 'wrong-number-of-args (memv))
(check-catch 'wrong-number-of-args (memv 1))
(check-catch 'wrong-number-of-args (memv 1 '(1 2 3) "extra argument"))

#|
member
åœ¨åˆ—è¡¨ä¸­æœç´¢æŒ‡å®šå…ƒç´ ï¼Œè‹¥å­˜åœ¨åˆ™è¿”å›ä»è¯¥å…ƒç´ å¼€å§‹çš„å­åˆ—è¡¨ï¼Œå¦åˆ™è¿”å› #f

è¯­æ³•
----
(member item list)

å‚æ•°
----
item:any
å¾…æŸ¥æ‰¾çš„å…ƒç´ ï¼ˆæ”¯æŒä»»æ„ç±»å‹ï¼ŒåŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²ã€ç‚¹å¯¹ã€åˆ—è¡¨ç­‰ï¼‰ã€‚
list:list
è¢«æœç´¢çš„åˆ—è¡¨ï¼ˆå¯ä¸ºç©ºåˆ—è¡¨ï¼‰ã€‚

è¿”å›å€¼
-----
list
è‹¥ item åœ¨ list ä¸­ï¼Œè¿”å›ä»ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹å¼€å§‹ç›´åˆ°åˆ—è¡¨æœ«å°¾çš„å­åˆ—è¡¨ã€‚
#f
è‹¥æœªæ‰¾åˆ°æˆ– list ä¸ºç©ºï¼Œè¿”å› #fã€‚

é”™è¯¯
----
wrong-type-arg
è‹¥ list ä¸æ˜¯æœ‰æ•ˆåˆ—è¡¨ï¼ˆå¦‚éåˆ—è¡¨ç»“æ„ï¼‰ï¼Œå¯èƒ½å¼•å‘ç±»å‹é”™è¯¯ã€‚

é¢å¤–ä¿¡æ¯
----
ä½¿ç”¨ equal? è¿›è¡Œå…ƒç´ æ¯”è¾ƒï¼ˆæ”¯æŒå¤æ‚ç±»å‹å¦‚å­—ç¬¦ä¸² "1"ã€ç‚¹å¯¹ (1 . 2) å’Œåˆ—è¡¨ (1 2)ï¼‰ã€‚
åŒ¹é…æ—¶è¿”å› åŸå§‹åˆ—è¡¨çš„å°¾éƒ¨ç‰‡æ®µï¼ˆä¿ç•™åŸå†…å­˜ç»“æ„ï¼‰ï¼Œè€Œéå¤åˆ¶æ–°åˆ—è¡¨ã€‚

|#

(check-catch 'wrong-type-arg (member 0 "text"))

(check (member 2 '(1 2 3)) => '(2 3))

(check (member 0 '(1 2 3)) => #f)
(check (member 0 '()) => #f)
 
(check (member "1" '(0 "1" 2 3)) => '("1" 2 3))
(check (member '(1 . 2) '(0 (1 . 2) 3)) => '((1 . 2) 3))
(check (member '(1 2) '(0 (1 2) 3)) => '((1 2) 3))

#|
assq
åœ¨å…³è”åˆ—è¡¨ä¸­æŸ¥æ‰¾é”®ï¼Œä½¿ç”¨ eq? è¿›è¡Œæ¯”è¾ƒã€‚

è¯­æ³•
----
(assq key alist)

å‚æ•°
----
key : any
è¦æŸ¥æ‰¾çš„é”®å€¼ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç¬¦å·ã€‚
alist : list
å…³è”åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªé…å¯¹ï¼ˆpairï¼‰ï¼Œå…¶ä¸­ car æ˜¯é”®ï¼Œcdr æ˜¯å€¼ã€‚

è¿”å›å€¼
----
alist-element | #f
å¦‚æœåœ¨å…³è”åˆ—è¡¨ä¸­æ‰¾åˆ°åŒ¹é…çš„é”®ï¼Œè¿”å›å¯¹åº”çš„é…å¯¹ï¼›å¦‚æœæœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œè¿”å› #fã€‚

æè¿°
----
assq åœ¨å…³è”åˆ—è¡¨ä¸­æŸ¥æ‰¾ç¬¬ä¸€ä¸ªé”®ä¸ç»™å®š key åŒ¹é…çš„é…å¯¹ã€‚é”®çš„æ¯”è¾ƒä½¿ç”¨ eq? æ“ä½œç¬¦ï¼Œ
è¿™æ„å‘³ç€é”®å¿…é¡»æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼ˆé€šå¸¸ç”¨äºç¬¦å·ã€æ•°å­—æˆ–å…¶ä»–ä¸å¯å˜å¯¹è±¡ï¼‰ã€‚

assq æ˜¯ SRFI-1 è§„èŒƒä¸­å®šä¹‰çš„å…³è”åˆ—è¡¨æ“ä½œå‡½æ•°ï¼Œé€‚ç”¨äºç¬¦å·é”®æˆ–å…¶ä»–.eq? å¯æ¯”è¾ƒçš„å¯¹è±¡ã€‚

æ³¨æ„
----
- è¿”å›çš„æ˜¯æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªé…å¯¹ï¼Œä¸æ˜¯å€¼æœ¬èº«
- ä½¿ç”¨ eq? è¿›è¡Œæ¯”è¾ƒï¼Œå› æ­¤æœ€é€‚åˆç¬¦å·é”®
- å¯¹äºå­—ç¬¦ä¸²é”®ç­‰éœ€è¦ä½¿ç”¨ equal? çš„æƒ…å†µï¼Œè¯·ä½¿ç”¨ assoc
|#

(let ((l '((a 1) (b 2) (c . 3))))
  (check (assq 'a l) => '(a 1))
  (check-true (eq? (assq 'a l) (list-ref l 0)))
  (check (assq 'b l) => '(b 2))
  (check (assq 'c l) => '(c . 3))
  (check (assq 'd l) => #f))

; Additional comprehensive assq tests
(check (assq 'a '()) => #f)
(check (assq 'a '((a . 1))) => '(a . 1))
(check (assq 'a '((a) (b))) => '(a))
(check (assq 'b '((a 1) (b 2) (a 3))) => '(b 2))
(check (assq 'a '((a 1) (b 2) (a 3))) => '(a 1))
(check (assq 1 '((1 "one") (2 "two"))) => '(1 "one"))
(check (assq 3 '((1 "one") (2 "two"))) => #f)

; Test with different value types
(check (assq 'x '((x . 10) (y . 20))) => '(x . 10))
(check (assq 'vector '((symbol . 1) (vector . #(1 2 3)) (list . (a b c)))) => '(vector . #(1 2 3)))
(check (assq 'list '((symbol . 1) (vector . #(1 2 3)) (list . (a b c)))) => '(list a b c))

; Test with dotted pairs as values
(check (assq 'key '((key . value) (other . something))) => '(key . value))
(check (assq 'missing '((key . value) (other . something))) => #f)

(let ((l '((a 1) (b 2) (c . 3))))
  (check (assq 'a l) => '(a 1))
  (check-true (eq? (assq 'a l) (list-ref l 0)))
  (check (assq 'b l) => '(b 2))
  (check (assq 'c l) => '(c . 3))
  (check (assq 'd l) => #f))

(let ((l '((2 3) (5 7) (11 . 13))))
  (check (assv 5 l) => '(5 7))
  (check (assv 11 l) => '(11 . 13)))

(let ((l '(((a)) ((b)) ((c)))))
  (check (assoc '(a) l) => '((a)))
  (check (assq '(a) l) => #f)
  (check (assv '(a) l) => #f))

#|
assv
åœ¨å…³è”åˆ—è¡¨ä¸­æŸ¥æ‰¾é”®ï¼Œä½¿ç”¨ eqv? è¿›è¡Œæ¯”è¾ƒã€‚

è¯­æ³•
----
(assv key alist)

å‚æ•°
----
key : any
    è¦æŸ¥æ‰¾çš„é”®å€¼ï¼Œå¯ä»¥æ˜¯ç¬¦å·ã€æ•°å­—ã€å­—ç¬¦ã€å¸ƒå°”å€¼ç­‰åŸºæœ¬ç±»å‹å¯¹è±¡ã€‚

alist : list
    å…³è”åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªé…å¯¹ï¼ˆpairï¼‰ï¼Œå…¶ä¸­ car æ˜¯é”®ï¼Œcdr æ˜¯å€¼ã€‚

è¿”å›å€¼
----
list | #f
    å¦‚æœåœ¨å…³è”åˆ—è¡¨ä¸­æ‰¾åˆ°åŒ¹é…çš„é”®ï¼Œè¿”å›å¯¹åº”çš„é…å¯¹ï¼›å¦‚æœæœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œè¿”å› #fã€‚

æè¿°
----
assv åœ¨å…³è”åˆ—è¡¨ä¸­æŸ¥æ‰¾ç¬¬ä¸€ä¸ªé”®ä¸ç»™å®š key åŒ¹é…çš„é…å¯¹ã€‚é”®çš„æ¯”è¾ƒä½¿ç”¨ eqv? æ“ä½œç¬¦ï¼Œ
è¿™æ„å‘³ç€å¯ä»¥æ­£ç¡®å¤„ç†æ•°å€¼çš„ç­‰ä»·æ€§ï¼ˆä¾‹å¦‚æ•´æ•°å’Œæµ®ç‚¹æ•°çš„ç­‰ä»·æ¯”è¾ƒï¼‰ä»¥åŠå­—ç¬¦çš„ç²¾ç¡®åŒ¹é…ã€‚

assv æ˜¯ R7RS æ ‡å‡†ä¸­å®šä¹‰çš„å…³è”åˆ—è¡¨æ“ä½œå‡½æ•°ï¼Œé€‚ç”¨äºæ•°å€¼é”®ã€å­—ç¬¦é”®æˆ–å…¶ä»–.eqv? å¯æ¯”è¾ƒçš„å¯¹è±¡ã€‚

è¾¹ç•Œæ¡ä»¶
--------
- ç©ºåˆ—è¡¨å‚æ•°ï¼šå§‹ç»ˆè¿”å› #f
- å•å…ƒç´ åˆ—è¡¨è¾¹ç•Œï¼šå­˜åœ¨åŒ¹é…æ—¶è¿”å›å•å…ƒç´ é…å¯¹
- é‡å¤é”®å¤„ç†ï¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…å€¼çš„é…å¯¹ï¼ˆç´¢å¼•æœ€å°å€¼ï¼‰
- æ•°å€¼ç­‰ä»·æ€§ï¼šæ•´æ•° 42 å’Œæµ®ç‚¹æ•° 42.0 ä¼šè¢«è®¤ä¸ºæ˜¯ç›¸åŒçš„é”®
- å­—ç¬¦åŒ¹é…ï¼šä¸åŒå­—ç¬¦ä¹‹é—´ä¸ä¼šåŒ¹é…ï¼ŒåŒ…æ‹¬å¤§å°å†™æ•æ„Ÿ
- å¸ƒå°”å€¼åŒ¹é…ï¼š#t å’Œ #f åˆ†åˆ«åŒ¹é…
- åµŒå¥—ç»“æ„è¾¹ç•Œï¼šæ­£ç¡®å¤„ç†åµŒå¥—åˆ—è¡¨ä½œä¸ºå€¼çš„æƒ…å†µ

æ€§èƒ½ç‰¹å¾
--------
- æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­ n ä¸ºå…³è”åˆ—è¡¨é•¿åº¦ï¼Œçº¿æ€§éå†
- ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œæ— é¢å¤–å†…å­˜æ¶ˆè€—
- å†…å­˜å…±äº«ï¼šæˆåŠŸåŒ¹é…æ—¶å…±äº«åŸå§‹åˆ—è¡¨å†…å­˜ç»“æ„
- æ•°å€¼ä¼˜åŒ–ï¼šä¸“é—¨ä¼˜åŒ–çš„æ•°å€¼æ¯”è¾ƒå™¨
- å­—ç¬¦ä¼˜åŒ–ï¼šUnicodeå­—ç¬¦çš„ä¸“ç”¨æ¯”è¾ƒå™¨

æ•°æ®ç±»å‹å…¼å®¹æ€§
-------------
- **æ•°å€¼ç±»å‹æ”¯æŒ**ï¼š
  - æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¤æ•°ã€æœ‰ç†æ•°çš„ç²¾ç¡®å€¼æ¯”è¾ƒ
  - è·¨ç±»å‹æ•°å€¼æ¯”è¾ƒï¼ˆæ•´æ•° 42 == æµ®ç‚¹æ•° 42.0ï¼‰
  - è¾¹ç•Œæ•°å€¼å’Œå¤§æ•´æ•°å¤„ç†
- **å­—ç¬¦ç±»å‹å…¨å…¼å®¹**ï¼š
  - ASCIIå’ŒUnicodeå­—ç¬¦çš„ç²¾ç¡®åŒ¹é…
  - ç‰¹æ®Šå­—ç¬¦å’Œæ§åˆ¶å­—ç¬¦æ”¯æŒ
- **å¸ƒå°”ç±»å‹**ï¼šå®Œå…¨æ”¯æŒ #t å’Œ #f çš„ç²¾ç¡®åŒ¹é…
- **ç¬¦å·ç±»å‹**ï¼šæ”¯æŒæ™®é€šç¬¦å·å’Œå…³é”®å­—ç¬¦å·
- **å¤åˆå¯¹è±¡**ï¼šæ”¯æŒåˆ—è¡¨ã€å‘é‡ç­‰ä½œä¸ºå€¼å­˜å‚¨

ä¸å…¶ä»–å…³è”å‡½æ•°çš„æ¯”è¾ƒ
--------------------
- **assv vs assq**ï¼šassv ä½¿ç”¨ eqv?ï¼ˆæ•°å€¼å’Œå­—ç¬¦æœ€ä¼˜ï¼‰ï¼Œassq ä½¿ç”¨ eq?ï¼ˆç¬¦å·æœ€ä¼˜ï¼‰
- **assv vs assoc**ï¼šassv ä½¿ç”¨ eqv?ï¼ˆåŸºç¡€ç±»å‹æœ€ä¼˜ï¼‰ï¼Œassoc ä½¿ç”¨ equal?ï¼ˆå¤åˆå¯¹è±¡æœ€ä¼˜ï¼‰

åº”ç”¨æ³¨æ„
--------
- åœ¨æ•°å€¼é”®æŸ¥æ‰¾å’Œå­—ç¬¦é”®æŸ¥æ‰¾åœºæ™¯ä¸­å…·æœ‰æ˜¾è‘—æ€§èƒ½ä¼˜åŠ¿
- èƒ½å¤Ÿæ­£ç¡®å¤„ç†è·¨ç±»å‹çš„æ•°å€¼åŒ¹é…ï¼ˆæ•´æ•° == æµ®ç‚¹æ•°ï¼‰
- é€‚ç”¨äºé…ç½®æ•°æ®ã€æ˜ å°„è¡¨ã€ç¯å¢ƒå˜é‡ç­‰åŸºç¡€ç±»å‹é”®å€¼å­˜å‚¨
- è¿”å›ç»“æ„æ”¯æŒç»§ç»­é“¾å¼æ“ä½œï¼ˆcdrã€cadrã€cdrç­‰ï¼‰

é™åˆ¶è¯´æ˜
--------
- ä¸èƒ½ç”¨äºå­—ç¬¦ä¸²ç­‰å¤æ‚ç±»å‹çš„å€¼æ¯”è¾ƒ
- ä¸æ”¯æŒåµŒå¥—è·¯å¾„æŸ¥æ‰¾ï¼Œä»…é™äºé¡¶å±‚é”®å€¼åŒ¹é…
- ä¸ assq å’Œ assoc å…±åŒç»„æˆ R7RS å…³è”æŸ¥è¯¢çš„ä¸‰ä½ä¸€ä½“æ¶æ„
|#

;; assv åŸºæœ¬åŠŸèƒ½æµ‹è¯•
(check (assv 'a '((a . 1) (b . 2))) => '(a . 1))
(check (assv 'b '((a . 1) (b . 2))) => '(b . 2))
(check (assv 'c '((a . 1) (b . 2))) => #f)

;; è¾¹ç•Œ1ï¼šç©ºåˆ—è¡¨è¾¹ç•Œ
(check (assv 'key '()) => #f)

;; è¾¹ç•Œ2ï¼šå•å…ƒç´ åˆ—è¡¨è¾¹ç•Œ
(check (assv 'k '((k . v))) => '(k . v))
(check (assv 'missing '((k . v))) => #f)

;; è¾¹ç•Œ3ï¼šæ•°å€¼ç­‰ä»·æ€§è¾¹ç•Œæµ‹è¯•
(check (assv 42 '((42 . "int") (42.0 . "float"))) => '(42 . "int"))
(check (assv 42.0 '((42 . "int") (42.0 . "float"))) => '(42.0 . "float"))
(check (assv 3.14 '((1 . a) (3.14 . b) (5 . c))) => '(3.14 . b))

;; è¾¹ç•Œ4ï¼šå­—ç¬¦ç²¾ç¡®åŒ¹é…è¾¹ç•Œ
(check (assv #\a '((#\a . "lowercase") (#\A . "uppercase"))) => '(#\a . "lowercase"))
(check (assv #\A '((#\a . "lowercase") (#\A . "uppercase"))) => '(#\A . "uppercase")) 
(check (assv #\0 '((#\0 . "zero") (#\1 . "one"))) => '(#\0 . "zero"))

;; è¾¹ç•Œ5ï¼šå¸ƒå°”å€¼è¾¹ç•Œæµ‹è¯•
(check (assv #t '((#t . true) (#f . false))) => '(#t . true))
(check (assv #f '((#f . false) (#t . true))) => '(#f . false))

;; è¾¹ç•Œ6ï¼šé‡å¤é”®å¤„ç†è¾¹ç•Œ
(check (assv 42 '((42 . first) (42 . second) (42 . third))) => '(42 . first))
(check (assv 'sym '((a . 1) (sym . found) (sym . ignored))) => '(sym . found))

;; è¾¹ç•Œ7ï¼šåµŒå¥—ç»“æ„ä½œä¸ºå€¼è¾¹ç•Œ
(check (assv 'key '((key (1 2 3)) (other . "val"))) => '(key (1 2 3)))
(check (assv 'list '((key . "val") (list "item") (other . 123))) => '(list "item"))

;; è¾¹ç•Œ8ï¼šå¤æ‚æ•°æ®ç±»å‹è¾¹ç•Œ
(check (assv #t '((#t enabled #t #f) (#f disabled))) => '(#t enabled #t #f))
(check (assv 99.9 '((42 . "answer") (99.9 . 100.0) (0 . "zero"))) => '(99.9 . 100.0))

;; æ•°å€¼è¾¹ç•Œæµ‹è¯•
(check (assv 0 '((0 . zero) (1 . one) (-1 . negative))) => '(0 . zero))
(check (assv -1 '((0 . zero) (-1 . negative) (1 . one))) => '(-1 . negative))
(check (assv 2147483647 '((2147483647 . int-max) (-2147483648 . int-min))) => '(2147483647 . int-max))

;; æµ®ç‚¹æ•°è¾¹ç•Œæµ‹è¯•
(check (assv 1.0 '((1 "integer") (1.0 "float") (1.1 "larger"))) => '(1.0 "float"))
(check (assv 0.5 '((0.5 . "exact") (0.51 . "approx"))) => '(0.5 . "exact"))

;; å­—ç¬¦é›†åˆè¾¹ç•Œæµ‹è¯•
(check (assv #\newline '((#\newline . "return") (#\tab . "indent"))) => '(#\newline . "return"))
(check (assv #\space '((#\space . "space") (#\a . "char") (#\z . "last"))) => '(#\space . "space"))

;; è¿‡ç¨‹å¯¹è±¡è¾¹ç•Œæµ‹è¯• - è¿‡ç¨‹å¯¹è±¡éœ€è¦ä½¿ç”¨eq?æ¯”è¾ƒï¼Œè€Œä¸æ˜¯eqv?
(let ((proc car))
  (check (assv proc (list (cons car "first") (cons cdr "second"))) => (cons car "first")))

;; ç‰¹æ®Šç¬¦å·è¾¹ç•Œæµ‹è¯•
(check (assv :keyword '((:keyword . "special") (sym . "normal"))) => '(:keyword . "special"))

;; é”™è¯¯å¤„ç†æµ‹è¯•
(check-catch 'wrong-type-arg (assv 'key "not-association-list"))
(check-catch 'wrong-type-arg (assv 'key 123))
(check-catch 'wrong-type-arg (assv 'key #t))

;; å‚æ•°æ•°é‡é”™è¯¯æµ‹è¯•
(check-catch 'wrong-number-of-args (assv))
(check-catch 'wrong-number-of-args (assv 'key))
(check-catch 'wrong-number-of-args (assv 'key 'list "extra"))

;; éé…å¯¹ç»“æ„è¾¹ç•Œæµ‹è¯•
(check (assv 'a '((a) (b) (c))) => '(a))
(check (assv 'b '((a) (b) (c))) => '(b))

;; åµŒå¥—å…³è”åˆ—è¡¨è¾¹ç•Œ
(check (assv 42 '((42 a b c) (foo . bar))) => '(42 a b c))
(check (assv 'x '((x 1 2 3) (y 4 5 6))) => '(x 1 2 3))

#|
assoc
åœ¨å…³è”åˆ—è¡¨ä¸­æŸ¥æ‰¾é”®ï¼Œä½¿ç”¨ equal? è¿›è¡Œæ¯”è¾ƒã€‚è¿™æ˜¯R7RSæ ‡å‡†ä¸­æœ€é€šç”¨çš„å…³è”åˆ—è¡¨æ“ä½œå‡½æ•°ã€‚

è¯­æ³•
----
(assoc key alist)

å‚æ•°
----
key : any
    è¦æŸ¥æ‰¾çš„é”®å€¼ï¼Œå¯ä»¥æ˜¯ç¬¦å·ã€å­—ç¬¦ä¸²ã€æ•°å­—ã€åˆ—è¡¨ã€ç‚¹å¯¹æˆ–å…¶ä»–ä»»æ„ç±»å‹å¯¹è±¡ã€‚

alist : list
    å…³è”åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªé…å¯¹ï¼ˆpairï¼‰æˆ–åˆ—è¡¨ï¼Œå…¶ä¸­ car æ˜¯é”®ï¼Œcdr æ˜¯å€¼ã€‚

è¿”å›å€¼
----
list | #f
    å¦‚æœåœ¨å…³è”åˆ—è¡¨ä¸­æ‰¾åˆ°åŒ¹é…çš„é”®ï¼Œè¿”å›å¯¹åº”çš„é…å¯¹ï¼›å¦‚æœæœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œè¿”å› #fã€‚

æè¿°
----
assoc æ˜¯R7RSæ ‡å‡†ä¸­æœ€é€šç”¨çš„å…³è”åˆ—è¡¨æ“ä½œå‡½æ•°ï¼Œä½¿ç”¨ equal? è¿›è¡Œé”®æ¯”è¾ƒï¼Œæ”¯æŒæ‰€æœ‰ç±»å‹çš„å¯¹è±¡ä½œä¸ºé”®ã€‚
ä¸ assq (ä½¿ç”¨ eq? æ¯”è¾ƒ) å’Œ assv (ä½¿ç”¨ eqv? æ¯”è¾ƒ) ç›¸æ¯”ï¼Œassoc èƒ½å¤Ÿå®Œæˆæœ€å¤æ‚çš„å¯¹è±¡åŒ¹é…ã€‚

è¾¹ç•Œæ¡ä»¶
--------
- ç©ºåˆ—è¡¨å‚æ•°ï¼šå§‹ç»ˆè¿”å› #f
- å•å…ƒç´ åˆ—è¡¨è¾¹ç•Œï¼šå­˜åœ¨åŒ¹é…æ—¶è¿”å›å•å…ƒç´ é…å¯¹
- é‡å¤é”®å¤„ç†ï¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…å€¼çš„é…å¯¹ï¼ˆç´¢å¼•æœ€å°å€¼ï¼‰
- å­—ç¬¦ä¸²åŒ¹é…ï¼šåŒºåˆ†å¤§å°å†™ï¼Œå®Œå…¨åŒ¹é…å­—ç¬¦ä¸²å†…å®¹
- åˆ—è¡¨åŒ¹é…ï¼šå…¨ç»“æ„æ¯”è¾ƒï¼Œå­åˆ—è¡¨åµŒå¥—ä¹Ÿç²¾ç¡®åŒ¹é…
- ç‰¹æ®Šå¯¹è±¡åŒ¹é…ï¼šè¿‡ç¨‹å¯¹è±¡ã€å¸ƒå°”å€¼ã€å­—ç¬¦ç­‰ç»Ÿä¸€æ”¯æŒ
- å¤åˆå¯¹è±¡è¾¹ç•Œï¼šæ”¯æŒå¤æ‚åµŒå¥—ç»“æ„ä½œä¸ºé”®å’Œå€¼

æ€§èƒ½ç‰¹å¾
--------
- æ—¶é—´å¤æ‚åº¦ï¼šO(n*m)ï¼Œå…¶ä¸­ n ä¸ºåˆ—è¡¨é•¿åº¦ï¼Œm ä¸ºé”®æ¯”è¾ƒå¤æ‚åº¦
- ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼Œæ— é¢å¤–å†…å­˜æ¶ˆè€—
- å†…å­˜å…±äº«ï¼šæˆåŠŸåŒ¹é…æ—¶å…±äº«åŸå§‹åˆ—è¡¨å†…å­˜ç»“æ„
- é€šç”¨æ€§ï¼šæ”¯æŒæ‰€æœ‰ç±»å‹çš„é”®å€¼æ¯”è¾ƒ
- æ·±å±‚æ¯”è¾ƒï¼šæ”¯æŒå¤æ‚åµŒå¥—ç»“æ„çš„å®Œæ•´åŒ¹é…

æ•°æ®ç±»å‹å…¼å®¹æ€§
-------------
- **å­—ç¬¦ä¸²ç±»å‹**ï¼šæ”¯æŒå¤§å°å†™æ•æ„Ÿçš„å…¨å­—ç¬¦åŒ¹é…
- **åˆ—è¡¨ç±»å‹**ï¼šæ”¯æŒåµŒå¥—åˆ—è¡¨çš„å®Œæ•´ç»“æ„åŒ¹é…
- **æ•°å€¼ç±»å‹**ï¼šæ”¯æŒæ‰€æœ‰æ•°å€¼ç±»å‹çš„ç­‰ä»·æ€§æ¯”è¾ƒ
- **å­—ç¬¦ç±»å‹**ï¼šæ”¯æŒASCIIå’ŒUnicodeå­—ç¬¦çš„ç²¾ç¡®åŒ¹é…
- **å¸ƒå°”ç±»å‹**ï¼šå®Œå…¨æ”¯æŒ #t å’Œ #f çš„ç²¾ç¡®åŒ¹é…
- **ç¬¦å·ç±»å‹**ï¼šæ”¯æŒæ™®é€šç¬¦å·å’Œå…³é”®å­—ç¬¦å·
- **å¤åˆå¯¹è±¡**ï¼šæ”¯æŒä»»ä½•å¤æ‚å¯¹è±¡ä½œä¸ºé”®å’Œå€¼

ä¸å…¶ä»–å…³è”å‡½æ•°çš„æ¯”è¾ƒ
--------------------
- **assoc vs assq**ï¼šassoc ä½¿ç”¨ equal?ï¼ˆé€šç”¨æœ€å¼·ï¼‰ï¼Œassq ä½¿ç”¨ eq?ï¼ˆç¬¦å·æœ€ä¼˜ï¼‰
- **assoc vs assv**ï¼šassoc ä½¿ç”¨ equal?ï¼ˆå¤åˆå¯¹è±¡æœ€ä¼˜ï¼‰ï¼Œassv ä½¿ç”¨ eqv?ï¼ˆåŸºç¡€ç±»å‹æœ€ä¼˜ï¼‰
- **åº”ç”¨çŸ©é˜µ**ï¼š
  - ç¬¦å·é”® â†’ ä¼˜å…ˆ assq
  - æ•°å€¼/å­—ç¬¦é”® â†’ ä¼˜å…ˆ assv
  - å­—ç¬¦ä¸²/åˆ—è¡¨/å¤åˆé”® â†’ ä¼˜å…ˆ assoc

åº”ç”¨æ³¨æ„
--------
- æ˜¯å¤„ç†å­—ç¬¦ä¸²é”®ã€åˆ—è¡¨é”®ç­‰å¤æ‚ç±»å‹é”®å€¼çš„å”¯ä¸€é€‰æ‹©
- èƒ½å¤Ÿæ­£ç¡®å¤„ç†åµŒå¥—æ•°æ®ç»“æ„ä½œä¸ºé”®å€¼
- é€‚ç”¨äºé…ç½®ç®¡ç†ã€JSON-likeæ•°æ®ç»“æ„ã€åºåˆ—åŒ–å¤„ç†ç­‰åœºæ™¯
- è¿”å›ç»“æ„æ”¯æŒç»§ç»­é“¾å¼æ“ä½œå’ŒçŠ¶æ€å¤„ç†
- æ”¯æŒæœ€æ·±/æœ€å¤æ‚çš„æ•°æ®ç»“æ„åŒ¹é…

é™åˆ¶è¯´æ˜
--------
- æ€§èƒ½å¯èƒ½ä¸å¦‚ assq å’Œ assv å¯¹äºç®€å•ç±»å‹é”®
- ä¸æ”¯æŒæ¨¡ç³ŠåŒ¹é…å’Œé€šé…ç¬¦åŒ¹é…
- ä¸ assq å’Œ assv å…±åŒç»„æˆ R7RS çš„æ ‡å‡†å…³è”æŸ¥è¯¢æ¶æ„
- éœ€è¦æ³¨æ„çš„æ˜¯ä¼šå®ä¾‹åŒ–æ·±å±‚ç»“æ„æ¯”è¾ƒ
|#

;; assoc åŸºæœ¬åŠŸèƒ½æµ‹è¯•
(check (assoc 'a '((a . 1) (b . 2))) => '(a . 1))
(check (assoc 'b '((a . 1) (b . 2))) => '(b . 2))
(check (assoc 'c '((a . 1) (b . 2))) => #f)

;; è¾¹ç•Œ1ï¼šç©ºåˆ—è¡¨è¾¹ç•Œ
(check (assoc 'key '()) => #f)

;; è¾¹ç•Œ2ï¼šå•å…ƒç´ åˆ—è¡¨è¾¹ç•Œ
(check (assoc 'k '((k . v))) => '(k . v))
(check (assoc 'missing '((k . v))) => #f)

;; è¾¹ç•Œ3ï¼šå­—ç¬¦ä¸²é”®ç²¾ç¡®åŒ¹é…è¾¹ç•Œ
(check (assoc "apple" '(("apple" . 1) ("banana" . 2))) => '("apple" . 1))
(check (assoc "APPLE" '(("apple" . 1) ("banana" . 2))) => #f)
(check (assoc "" '(("" . empty) ("a" . not-empty))) => '("" . empty))

;; è¾¹ç•Œ4ï¼šåˆ—è¡¨é”®ç²¾ç¡®åŒ¹é…è¾¹ç•Œ
(check (assoc '(1 2) '(((1 2) . "list-key-1") ((3 4) . "list-key-2"))) => '((1 2) . "list-key-1"))
(check (assoc '(list 1 2) '(((list 1 2) . quoted) ((1 2) . unquoted))) => '((list 1 2) . quoted))

;; è¾¹ç•Œ5ï¼šåµŒå¥—ç»“æ„ä½œä¸ºé”®è¾¹ç•Œ
(check (assoc 'key '((key . (deep nested structure)) (other . simple))) => '(key deep nested structure))
(check (assoc 'nested '((("key" . val) ((key) . "the key")) (missing . other))) => #f)

;; è¾¹ç•Œ6ï¼šé‡å¤é”®å¤„ç†è¾¹ç•Œ
(check (assoc "test" '(("test" . first) ("test" . second) ("test" . third))) => '("test" . first))
(check (assoc '(a b) '(((a b) . one) ((a b) . two) ((c d) . three))) => '((a b) . one))

;; è¾¹ç•Œ7ï¼šæ•°å€¼ç­‰ä»·æ€§è¾¹ç•Œæµ‹è¯•
(check (assoc 42 '((42 . "int") (42.0 . "float"))) => '(42 . "int"))
(check (assoc 42.0 '((42 . "int") (42.0 . "float"))) => '(42.0 . "float"))
(check (assoc 3.14 '((1 . a) (3.14 . b) (5 . c))) => '(3.14 . b))

;; è¾¹ç•Œ8ï¼šå¤æ‚å¤åˆå¯¹è±¡ä½œä¸ºé”®è¾¹ç•Œ
(check (assoc '((a b) c) '(("((a b) c)" . string) (((a b) c) . list) ((()) . empty))) => '(((a b) c) . list))
(check (assoc #(1 2 3) '((#(1 2 3) . vector-value) (#(3 4 5) . another))) => '(#(1 2 3) . vector-value))

;; å­—ç¬¦ä¸²è¯¦ç»†è¾¹ç•Œæµ‹è¯•
(check (assoc "" '(("" . empty-string))) => '("" . empty-string))
(check (assoc "ç‰¹æ®Šå­—ç¬¦" '(("ç‰¹æ®Šå­—ç¬¦" . "unicode string"))) => '("ç‰¹æ®Šå­—ç¬¦" . "unicode string"))

;; è¡¥å……assocå®Œæ•´è¾¹ç•Œæµ‹è¯•
;; è¾¹ç•Œï¼šç©ºåˆ—è¡¨å’Œå•å…ƒç´ è¾¹ç•Œ
(check (assoc 'missing '()) => #f)
(check (assoc 'singleton '((singleton . value))) => '(singleton . value))

;; è¾¹ç•Œï¼šUnicodeå­—ç¬¦ä¸²ç²¾ç¡®åŒ¹é…
(check (assoc "ä¸­æ–‡" '(("ä¸­æ–‡" . "ä¸­æ–‡å€¼") ("english" . "è‹±æ–‡å€¼"))) => '("ä¸­æ–‡" . "ä¸­æ–‡å€¼"))
(check (assoc "ğŸš€" '(("ğŸš€" . "rocket") ("ğŸŒ" . "globe"))) => '("ğŸš€" . "rocket"))

;; è¾¹ç•Œï¼šç©ºå­—ç¬¦ä¸²å’Œç‰¹æ®Šå­—ç¬¦
(check (assoc "" '(("" . empty-string))) => '("" . empty-string))
(check (assoc "TeSt" '(("test" . lowercase) ("TeSt" . mixed) ("TEST" . uppercase))) => '("TeSt" . mixed))

;; è¾¹ç•Œï¼šåˆ—è¡¨ç»“æ„ä½œä¸ºé”®
(check (assoc '() '((() . empty-list) ((a) . single))) => '(() . empty-list))
(check (assoc '(nested list) '(((nested list) . "complex key") ((simple) . "basic key"))) => '((nested list) . "complex key"))

;; æ‰©å±•assocè¾¹ç•Œæµ‹è¯•ï¼Œæ»¡è¶³è‡³å°‘8ä¸ªè¾¹ç•Œæµ‹è¯•ç”¨ä¾‹è¦æ±‚
;; è¾¹ç•Œ9ï¼šæå¤§å…³è”åˆ—è¡¨æ€§èƒ½æµ‹è¯•
(check (assoc 'key50 '((key1 . val1) (key2 . val2) (key3 . val3) (key4 . val4) (key5 . val5)
                         (key6 . val6) (key7 . val7) (key8 . val8) (key9 . val9) (key10 . val10)
                         (key11 . val11) (key12 . val12) (key13 . val13) (key14 . val14) (key15 . val15)
                         (key16 . val16) (key17 . val17) (key18 . val18) (key19 . val19) (key20 . val20)
                         (key21 . val21) (key22 . val22) (key23 . val23) (key24 . val24) (key25 . val25)
                         (key26 . val26) (key27 . val27) (key28 . val28) (key29 . val29) (key30 . val30)
                         (key31 . val31) (key32 . val32) (key33 . val33) (key34 . val34) (key35 . val35)
                         (key36 . val36) (key37 . val37) (key38 . val38) (key39 . val39) (key40 . val40)
                         (key41 . val41) (key42 . val42) (key43 . val43) (key44 . val44) (key45 . val45)
                         (key46 . val46) (key47 . val47) (key48 . val48) (key49 . val49) (key50 . val50))) 
      => '(key50 . val50))

;; è¾¹ç•Œ10ï¼šæ·±å±‚åµŒå¥—ç»“æ„é”®å€¼åŒ¹é…æµ‹è¯•
(check (assoc '((a b) (c d)) '((((a b) (c d)) . "nested keys") (((x y) (z w)) . "other"))) 
      => '(((a b) (c d)) . "nested keys"))

;; è¾¹ç•Œ11ï¼šæ··åˆæ•°æ®ç±»å‹çš„é”®æµ‹è¯•
(check (assoc 3.14159 '((1 . "one") (3.14159 . "pi") (2.71828 . "e"))) => '(3.14159 . "pi"))
(check (assoc #f '((#t . "true") (#f . "false") (maybe . "unknown"))) => '(#f . "false"))

;; è¾¹ç•Œ12ï¼šç‰¹æ®Šå­—ç¬¦å’ŒUnicodeå­—ç¬¦ä¸²é”®æµ‹è¯•
(check (assoc "æµ‹è¯•" '(("ä¸­æ–‡" . "ä¸­æ–‡å€¼") ("æµ‹è¯•" . "æµ‹è¯•å€¼") ("è‹±æ–‡" . "english"))) => '("æµ‹è¯•" . "æµ‹è¯•å€¼"))
(check (assoc "ç‰¹æ®Šå­—ç¬¦@#$%" '(("normal" . "æ™®é€š") ("ç‰¹æ®Šå­—ç¬¦@#$%" . "special") ("unicodeğŸ‰" . "emoji"))) 
      => '("ç‰¹æ®Šå­—ç¬¦@#$%" . "special"))

;; è¾¹ç•Œ13ï¼šè¿‡ç¨‹å¯¹è±¡å’Œå¸ƒå°”å€¼ä½œä¸ºé”®æµ‹è¯•
(let ((test-proc (lambda (x) x)))
  (check (assoc test-proc (list (cons test-proc "procedure") (cons 'not-this "symbol"))) 
        => (cons test-proc "procedure")))

;; è¾¹ç•Œ14ï¼šç©ºåˆ—è¡¨å’ŒåŸå­å€¼è¾¹ç•Œæµ‹è¯•
(check (assoc 'missing '()) => #f)
(check (assoc 'key '((key))) => '(key))
(check (assoc 'symbol '((symbol . #t) (number . 42) (string . "test"))) => '(symbol . #t))

;; è¾¹ç•Œ15ï¼šå­˜å‚¨è¿‡ç¨‹å’Œå¤æ‚å¯¹è±¡çš„å€¼æµ‹è¯•
(check (assoc 'data '((data . #("a" "b" "c")) (list . (1 2 3)))) => '(data . #("a" "b" "c")))

;; è¾¹ç•Œ16ï¼šé‡å¤å‰ç¼€åŒ¹é…æµ‹è¯•
(check (assoc "prefix" '(("prefix-match" . 1) ("prefix" . 2) ("prefix-long" . 3))) => '("prefix" . 2))
(check (assoc 'partial '((partial . 1) (partial-match . 2) (partially . 3))) => '(partial . 1))

#|
list-copy

åˆ›å»ºä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œå®ƒæ˜¯è¾“å…¥åˆ—è¡¨çš„æµ…æ‹·è´ã€‚

è¯­æ³•
----
(list-copy list)

å‚æ•°
----
list - è¦å¤åˆ¶çš„åˆ—è¡¨

è¿”å›å€¼
------
è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œå…·æœ‰ä¸è¾“å…¥åˆ—è¡¨ç›¸åŒçš„å…ƒç´ ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªä¸åŒçš„å¯¹è±¡ã€‚

æè¿°
----
list-copy å‡½æ•°åˆ›å»ºè¾“å…¥åˆ—è¡¨çš„ä¸€ä¸ªæµ…æ‹·è´ã€‚æ–°åˆ—è¡¨çš„é¡¶å±‚èŠ‚ç‚¹æ˜¯æ–°çš„ï¼Œ
ä½†åˆ—è¡¨ä¸­çš„å…ƒç´ æœ¬èº«ä¸ä¼šè¢«å¤åˆ¶ï¼ˆæµ…æ‹·è´ï¼‰ã€‚è¿™ä½¿å¾—ä¿®æ”¹åŸå§‹åˆ—è¡¨ä¸ä¼šå½±å“æ‹·è´çš„åˆ—è¡¨ï¼Œ
ä½†éœ€è¦æ³¨æ„åµŒå¥—åˆ—è¡¨çš„æ·±å±‚ç»“æ„ä¸ä¼šè¢«å¤åˆ¶ã€‚

è¯¥å‡½æ•°åœ¨ (srfi srfi-1) æ¨¡å—ä¸­å®ç°ï¼Œå¹¶ç”± (liii list) é‡æ–°å¯¼å‡ºã€‚

ç¤ºä¾‹
----
; åŸºæœ¬åˆ—è¡¨å¤åˆ¶
(list-copy '(1 2 3))      => (1 2 3)
(list-copy '())           => ()

è¾¹ç•Œæ¡ä»¶
--------
- ç©ºåˆ—è¡¨å‚æ•°è¿”å›ç©ºåˆ—è¡¨
- éåˆ—è¡¨å‚æ•°ä¼šè§¦å‘ç±»å‹é”™è¯¯å¼‚å¸¸
- åµŒå¥—åˆ—è¡¨çš„å­åˆ—è¡¨ä¸ºåŒä¸€å¼•ç”¨ï¼ˆæµ…æ‹·è´ç‰¹æ€§ï¼‰

æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦
----------------
- æ—¶é—´å¤æ‚åº¦ï¼šO(n)ï¼Œå…¶ä¸­ n æ˜¯åˆ—è¡¨é•¿åº¦
- ç©ºé—´å¤æ‚åº¦ï¼šO(n)ï¼Œéœ€è¦åˆ›å»ºæ–°çš„åˆ—è¡¨èŠ‚ç‚¹

|#

;; list-copy tests

;; åŸºæœ¬åŠŸèƒ½æµ‹è¯•
(check (list-copy '()) => '())
(check (list-copy '(1 2 3 4 5)) => '(1 2 3 4 5))
(check (list-copy '(a b c d)) => '(a b c d))
(check (list-copy '((1 2) (3 4) (5 6))) => '((1 2) (3 4) (5 6)))

;; ç©ºåˆ—è¡¨è¾¹ç•Œæ¡ä»¶
(check (list-copy '()) => '())

;; å¯¹è±¡ç‹¬ç«‹æ€§éªŒè¯ - ç¡®ä¿æ˜¯æµ…æ‹·è´
(check-false (eq? (list-copy '(1 2 3)) '(1 2 3)))

;; çªå˜éš”ç¦»æµ‹è¯• - éªŒè¯åˆ—è¡¨èŠ‚ç‚¹ç‹¬ç«‹æ€§
(let ((orig '(a b c))
      (copy (list-copy '(a b c))))
  (check orig => copy)
  (check-false (eq? orig copy))
  ;; éªŒè¯æµ…æ‹·è´ç‰¹æ€§
  (let ((mut-copy (list-copy orig)))
    (set-car! mut-copy 'x)
    (check orig => '(a b c))      ; åŸå§‹åˆ—è¡¨ä¸å—å½±å“
    (check mut-copy => '(x b c)))) ; æ‹·è´åˆ—è¡¨å·²æ”¹å˜

(check-report)
